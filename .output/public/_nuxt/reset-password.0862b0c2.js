import{E as N}from"./el-input.1e6b9b8d.js";import{E as A,a as F,_ as O}from"./el-form.3e187d86.js";import{f as W,g as M,r as k,h as $,i as U,o as u,j as x,w as a,b as o,n as j,k as e,c as w,a as d,t as C,l as g,d as h,E as m,m as z,q as D,s as H,v as G,x as J,y as K,z as Q}from"./entry.1024d92c.js";import{E as X,a as Y}from"./el-text.153bfc42.js";import{E as Z}from"./el-button.d23d9ba3.js";import{_ as ee}from"./nuxt-link.9eae61c7.js";import{_ as te}from"./client-only.a22efd39.js";/* empty css                */import{E as se}from"./useChat.7ba42b41.js";import{u as oe}from"./useAuth.8032df2e.js";import{u as ae}from"./useTitle.7e1ece39.js";import"./isEqual.745258fe.js";import"./el-scrollbar.a243a673.js";import"./el-popper.d0f3eda4.js";import"./str.2229b459.js";import"./scroll.62441652.js";const le=d("h1",{class:"mt-0 mb-6"},"Reset Password",-1),re={key:0,class:"-mt-1 mb-2 w-full text-right"},ne={key:3,class:"flex-center flex-col gap-1 w-full"},ie={class:"flex justify-end gap-1 w-full"},ce=d("div",{class:"p-6"},null,-1),me={key:4,class:"flex-center"},de={key:5,class:"flex-center"},pe=d("div",{class:"p-2"},null,-1),ue={class:"flex-center flex-col gap-1"},fe={class:"flex-center flex-wrap gap-1",style:{"line-height":"1rem"}},_e=d("div",{class:"p-8"},null,-1),ge={class:"absolute w-screen flex-center gap-2 p-3",style:{bottom:"0"}},he={style:{width:"120px"}},Le=W({__name:"reset-password",setup(ye){oe();const t=M().t,E=k(!1),r=k(0),v=k(),l=$({email:"",password:"",veriCode:""}),S=$({email:[{required:!0,message:t("auth.emailRequired"),trigger:"change"},{type:"email",message:t("auth.emailInvalid"),trigger:"change"}],password:[{required:!0,message:t("auth.passwdRequired"),trigger:"change"},{min:8,max:64,message:t("auth.passwdLength"),trigger:"change"}],veriCode:[{required:!0,message:t("auth.veriCodeRequired"),trigger:"change"},{min:6,max:6,message:t("auth.veriCodeRequired"),trigger:"change"}]}),I=()=>{se.confirm(t("auth.confirmChangeEmail"),"",{confirmButtonText:t("message.ok"),cancelButtonText:t("message.cancel"),type:"warning"}).then(()=>{r.value=0,l.email="",l.veriCode="",m.success(t("action.opExecuted"))}).catch(()=>{m.info(t("action.opCanceled"))})},R=()=>{E.value=!0,b(v.value,!0)},b=async(i,s=!1)=>{await i.validate((f,_)=>{if(f||s){const y=z.service({text:t("auth.sendingVeriCode")});$fetch(s?"/api/auth/resendCode":"/api/auth/createVerification",{method:"POST",body:{email:l.email}}).then(n=>{const p=n;p!=null&&p.error?m.error(p==null?void 0:p.error):(m.success("Email sent, please check your inbox."),r.value=1)}).catch(()=>{m.error("Oops! Something went wrong.")}).finally(()=>{y.close()})}else m.error(t("auth.formIncomplete"))})},B=async i=>{await i.validate((s,f)=>{if(s){const _=z.service({text:t("auth.sendingVeriCode")});$fetch("/api/auth/resetPassword",{method:"POST",body:{email:l.email,password:l.password,code:l.veriCode}}).then(y=>{const n=y;n!=null&&n.error?m.error(n==null?void 0:n.error):(m.success("Password reset successful."),D("/login"))}).catch(()=>{m.error("Oops! Something went wrong.")}).finally(()=>{_.close()})}else m.error(t("auth.formIncomplete"))})};return ae(`Reset Password - ${U("appName").value}`),(i,s)=>{const f=N,_=A,y=H,n=X,p=Y,V=Z,P=ee,q=F,T=O,L=te;return u(),x(L,null,{default:a(()=>[o(q,{ref_key:"ruleFormRef",ref:v,model:e(l),rules:e(S),"label-position":"top",class:"flex-col flex-center w-full max-w-xs px-4 m-auto",style:{height:"calc(100vh - 56px)"}},{default:a(()=>[le,o(_,{label:i.$t("auth.email"),style:j(e(r)===1?"margin-bottom: 0;":""),prop:"email",class:"inputWrapper SignupInputAnim1"},{default:a(()=>[(u(),x(f,{key:e(r),modelValue:e(l).email,"onUpdate:modelValue":s[0]||(s[0]=c=>e(l).email=c),type:"email",size:"large","prefix-icon":e(G),readonly:e(r)>0,disabled:e(r)>0},null,8,["modelValue","prefix-icon","readonly","disabled"]))]),_:1},8,["label","style"]),e(r)===1?(u(),w("div",re,[o(n,{type:"primary",onClick:I,style:{"font-size":"small"}},{default:a(()=>[o(y,{size:"small",class:"mr-1"},{default:a(()=>[o(e(J))]),_:1}),d("span",null,C(i.$t("action.change")),1)]),_:1})])):g("",!0),e(r)===1?(u(),x(_,{key:1,label:i.$t("auth.passwd"),prop:"password",class:"inputWrapper SignupInputAnim2 SignupPasswordInputWrapper"},{default:a(()=>[o(f,{modelValue:e(l).password,"onUpdate:modelValue":s[1]||(s[1]=c=>e(l).password=c),type:"password",size:"large","prefix-icon":e(K),formatter:c=>c.trim(),parser:c=>c.trim(),"show-password":""},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):g("",!0),e(r)===1?(u(),x(_,{key:2,label:i.$t("auth.veriCode"),prop:"veriCode",class:"inputWrapper SignupInputAnim2"},{default:a(()=>[o(f,{modelValue:e(l).veriCode,"onUpdate:modelValue":s[2]||(s[2]=c=>e(l).veriCode=c),type:"text",size:"large",maxLength:"6","prefix-icon":e(Q)},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"])):g("",!0),e(r)===1&&!e(E)?(u(),w("div",ne,[d("div",ie,[o(p,{type:"info",style:{"font-size":"small"}},{default:a(()=>[h(C(i.$t("auth.notReceiveVeriCode")),1)]),_:1}),o(n,{type:"primary",style:{"font-size":"small"},onClick:R},{default:a(()=>[h(C(i.$t("action.resend")),1)]),_:1})])])):g("",!0),ce,e(r)===0?(u(),w("div",me,[o(V,{size:"large",type:"primary",onClick:s[3]||(s[3]=c=>b(e(v)))},{default:a(()=>[h(C(i.$t("auth.getVeriCode")),1)]),_:1})])):g("",!0),e(r)===1?(u(),w("div",de,[o(V,{size:"large",type:"primary",onClick:s[4]||(s[4]=c=>B(e(v)))},{default:a(()=>[h(" Reset ")]),_:1})])):g("",!0),pe,d("div",ue,[d("div",fe,[o(n,{type:"primary"},{default:a(()=>[o(P,{to:"/login"},{default:a(()=>[h("Back to Home")]),_:1})]),_:1})])]),_e]),_:1},8,["model","rules"]),d("div",ge,[o(p,{type:"info",class:"opacity-75"},{default:a(()=>[h("More languages:")]),_:1}),d("span",he,[o(T,{size:"small"})])])]),_:1})}}});export{Le as default};
