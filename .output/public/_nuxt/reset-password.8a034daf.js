import{E as F}from"./el-input.d5155eab.js";import{E as N,a as O,_ as A}from"./el-form.d6710cec.js";import{f as W,g as M,r as k,h as $,i as U,o as u,j as w,w as l,b as a,n as j,k as e,c as x,a as m,t as C,l as g,d as h,E as d,m as z,q as D,s as G,v as H,x as J,y as K,z as Q}from"./entry.97b597df.js";import{E as X,a as Y}from"./el-text.58d01c78.js";import{E as Z}from"./el-button.dc8b7a60.js";import{_ as ee}from"./client-only.1350851e.js";/* empty css                */import{E as te}from"./el-overlay.bcefe1da.js";import{u as se}from"./useTitle.1287adce.js";import"./isEqual.a4c671d1.js";import"./el-scrollbar.f878f403.js";import"./el-popper.975103f2.js";import"./focus-trap.50241fa8.js";import"./scroll.692d7907.js";const ae=m("h1",{class:"mt-0 mb-6"},"Reset Password",-1),oe={key:0,class:"-mt-1 mb-2 w-full text-right"},le={key:3,class:"flex-center flex-col gap-1 w-full"},re={class:"flex justify-end gap-1 w-full"},ne=m("div",{class:"p-6"},null,-1),ie={key:4,class:"flex-center"},ce={key:5,class:"flex-center"},de=m("div",{class:"p-2"},null,-1),me={class:"flex-center flex-col gap-1"},pe={class:"flex-center flex-wrap gap-1",style:{"line-height":"1rem"}},ue=m("div",{class:"p-8"},null,-1),fe={class:"absolute w-screen flex-center gap-2 p-3",style:{bottom:"0"}},_e={style:{width:"120px"}},Re=W({__name:"reset-password",setup(ge){const s=M().t,b=k(!1),r=k(0),v=k(),o=$({email:"",password:"",veriCode:""}),S=()=>{history.back()},B=$({email:[{required:!0,message:s("auth.emailRequired"),trigger:"change"},{type:"email",message:s("auth.emailInvalid"),trigger:"change"}],password:[{required:!0,message:s("auth.passwdRequired"),trigger:"change"},{min:8,max:64,message:s("auth.passwdLength"),trigger:"change"}],veriCode:[{required:!0,message:s("auth.veriCodeRequired"),trigger:"change"},{min:6,max:6,message:s("auth.veriCodeRequired"),trigger:"change"}]}),I=()=>{te.confirm(s("auth.confirmChangeEmail"),"",{confirmButtonText:s("message.ok"),cancelButtonText:s("message.cancel"),type:"warning"}).then(()=>{r.value=0,o.email="",o.veriCode="",d.success(s("action.opExecuted"))}).catch(()=>{d.info(s("action.opCanceled"))})},R=()=>{b.value=!0,E(v.value,!0)},E=async(c,t=!1)=>{await c.validate((f,_)=>{if(f||t){const y=z.service({text:s("auth.sendingVeriCode")});$fetch(t?"/api/auth/resendCode":"/api/auth/createVerification",{method:"POST",body:{email:o.email}}).then(n=>{const p=n;p!=null&&p.error?d.error(p==null?void 0:p.error):(d.success("Email sent, please check your inbox."),r.value=1)}).catch(()=>{d.error("Oops! Something went wrong.")}).finally(()=>{y.close()})}else d.error(s("auth.formIncomplete"))})},P=async c=>{await c.validate((t,f)=>{if(t){const _=z.service({text:s("auth.sendingVeriCode")});$fetch("/api/auth/resetPassword",{method:"POST",body:{email:o.email,password:o.password,code:o.veriCode}}).then(y=>{const n=y;n!=null&&n.error?d.error(n==null?void 0:n.error):(d.success("Password reset successful."),D("/login"))}).catch(()=>{d.error("Oops! Something went wrong.")}).finally(()=>{_.close()})}else d.error(s("auth.formIncomplete"))})};return se(`Reset Password - ${U("appName").value}`),(c,t)=>{const f=F,_=N,y=G,n=X,p=Y,V=Z,q=O,T=A,L=ee;return u(),w(L,null,{default:l(()=>[a(q,{ref_key:"ruleFormRef",ref:v,model:e(o),rules:e(B),"label-position":"top",class:"flex-col flex-center w-full max-w-xs px-4 m-auto",style:{height:"calc(100vh - 56px)"}},{default:l(()=>[ae,a(_,{label:c.$t("auth.email"),style:j(e(r)===1?"margin-bottom: 0;":""),prop:"email",class:"inputWrapper SignupInputAnim1"},{default:l(()=>[(u(),w(f,{key:e(r),modelValue:e(o).email,"onUpdate:modelValue":t[0]||(t[0]=i=>e(o).email=i),type:"email",size:"large","prefix-icon":e(H),readonly:e(r)>0,disabled:e(r)>0},null,8,["modelValue","prefix-icon","readonly","disabled"]))]),_:1},8,["label","style"]),e(r)===1?(u(),x("div",oe,[a(n,{type:"primary",onClick:I,style:{"font-size":"small"}},{default:l(()=>[a(y,{size:"small",class:"mr-1"},{default:l(()=>[a(e(J))]),_:1}),m("span",null,C(c.$t("action.change")),1)]),_:1})])):g("",!0),e(r)===1?(u(),w(_,{key:1,label:c.$t("auth.passwd"),prop:"password",class:"inputWrapper SignupInputAnim2 SignupPasswordInputWrapper"},{default:l(()=>[a(f,{modelValue:e(o).password,"onUpdate:modelValue":t[1]||(t[1]=i=>e(o).password=i),type:"password",size:"large","prefix-icon":e(K),formatter:i=>i.trim(),parser:i=>i.trim(),"show-password":""},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):g("",!0),e(r)===1?(u(),w(_,{key:2,label:c.$t("auth.veriCode"),prop:"veriCode",class:"inputWrapper SignupInputAnim2"},{default:l(()=>[a(f,{modelValue:e(o).veriCode,"onUpdate:modelValue":t[2]||(t[2]=i=>e(o).veriCode=i),type:"text",size:"large",maxLength:"6","prefix-icon":e(Q)},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"])):g("",!0),e(r)===1&&!e(b)?(u(),x("div",le,[m("div",re,[a(p,{type:"info",style:{"font-size":"small"}},{default:l(()=>[h(C(c.$t("auth.notReceiveVeriCode")),1)]),_:1}),a(n,{type:"primary",style:{"font-size":"small"},onClick:R},{default:l(()=>[h(C(c.$t("action.resend")),1)]),_:1})])])):g("",!0),ne,e(r)===0?(u(),x("div",ie,[a(V,{size:"large",type:"primary",onClick:t[3]||(t[3]=i=>E(e(v)))},{default:l(()=>[h(C(c.$t("auth.getVeriCode")),1)]),_:1})])):g("",!0),e(r)===1?(u(),x("div",ce,[a(V,{size:"large",type:"primary",onClick:t[4]||(t[4]=i=>P(e(v)))},{default:l(()=>[h(" Reset ")]),_:1})])):g("",!0),de,m("div",me,[m("div",pe,[a(n,{type:"primary",onClick:t[5]||(t[5]=i=>S())},{default:l(()=>[h("Back")]),_:1})])]),ue]),_:1},8,["model","rules"]),m("div",fe,[a(p,{type:"info",class:"opacity-75"},{default:l(()=>[h("More languages:")]),_:1}),m("span",_e,[a(T,{size:"small"})])])]),_:1})}}});export{Re as default};
