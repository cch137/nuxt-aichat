import{r as m,g as E,D as L,E as i,z as W,A as $}from"./entry.14c95830.js";import{u as A}from"./useChat.22a2d051.js";const p=m(""),v=m(""),a=m(!1),w=m(!1),k=(()=>{const t=(e="")=>e.startsWith("Win")?"Win":e.startsWith("Linux")?"Linux":e.startsWith("Mac")?"Mac":e,r=e=>!!e,c=(e="",s="")=>!e.includes(t(s)),n=(e,s=!1)=>{if(s)return!1;if(!e||e.length===0)return!0;const g=Object.values(Object.getOwnPropertyDescriptors(e)).map(o=>o.value);if(g.length===e.length)return!0;const h=g.map(o=>o.constructor===Plugin);return h.filter(o=>o).length!==h.length},d=(e="",s=[])=>!e||!s||s.length===0,u=(e="",s)=>e.includes("Chrome")?!s:!1,l=()=>"ontouchstart"in document||navigator.maxTouchPoints>0;return()=>{const{userAgent:e="",platform:s="",plugins:g=[],webdriver:h=!1,language:o="",languages:P=[]}=navigator,I=l(),O=r(h),b=n(g,I),S=d(o,P),x=c(e,s),C=u(e,window==null?void 0:window.chrome);return{wd:O,pg:b,lg:S,pf:x,ch:C}}})();function y(t){w.value=t}const D=async()=>{a.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"}),p.value="",v.value="",y(!1),i.success("Logged out."),A().clear()}catch{i.error("Log out failed.")}finally{a.value=!1}};let T=0;const f=async(t=!1)=>{const r=Date.now();if(!t&&r-T<6e4)return w.value;a.value=!0;try{const{isLoggedIn:c,user:n}=await $fetch("/api/auth/check",{method:"POST"});return T=r,p.value=(n==null?void 0:n.email)||"",v.value=(n==null?void 0:n.username)||"",a.value=!1,setTimeout(()=>y(c),0),c}catch{a.value=!1}};(async()=>{try{await f()}catch(t){console.error(t)}finally{}})();const M=async t=>{try{const{error:r}=await $fetch("/api/auth/username",{method:"PUT",body:{username:t}});if(r)throw r;return await f(!0),i.success("The username has been changed."),!0}catch(r){return i.error(typeof r=="string"?r:"Oops! Something went wrong."),!1}};function j(){const t=E().t;return{authIsLoading:a,isLoggedIn:w,email:p,username:v,login:async(c,n)=>{const d=W.service({text:t("auth.loggingIn")});a.value=!0;try{const u=await $fetch("/api/auth/login",{method:"POST",body:{usernameOrEmail:c,password:n}}),{error:l}=u;if(l)throw l;$("/c/"),await f(!0),i.success("Logged in.")}catch(u){i.error(typeof u=="string"?u:"Oops! Something went wrong.")}finally{d.close(),a.value=!1}},logout:D,checkIsLoggedIn:f,setIsLoggedIn:y,changeUsername:M,mousetrap:k,goToHome(){L().$router.replace("/")},goToNewChat(){L().$router.replace("/c/")}}}export{j as u};
