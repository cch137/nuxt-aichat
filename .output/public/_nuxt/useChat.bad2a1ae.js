var hn=Object.defineProperty;var mn=(e,t,r)=>t in e?hn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Se=(e,t,r)=>(mn(e,typeof t!="symbol"?t+"":t,r),r);import{a4 as _t,a6 as pn,b4 as It,a3 as ft,i as gn,Z as Rt,c5 as yn,aY as Ht,c6 as dt,q as ee,c7 as wn,aw as Cn,c8 as bn,av as En,bK as De,af as ye,aE as Sn,V as Bn,W as vt,K as $t,b as Z,a7 as Ge,au as Tn,a8 as An,m as kn,c9 as xn,ca as Mn,a2 as ie,r as N,n as tt,cb as ht,aU as mt,ao as _n,az as le,o as V,g as Q,w as X,ak as Ne,a as G,D as $,s as pt,aB as Be,c as ze,am as Te,A as ce,t as ve,b5 as Ae,d as Pe,aA as We,as as In,ab as Lt,cc as Ot,cd as Dt,at as gt,ah as Rn,ad as Hn,aC as yt,bx as wt,ce as nt,cf as $n,cg as Ln,ch as On,ci as Dn,cj as re,f as Ct,ck as Nn,L as zn,E as q,aI as $e,j as Nt,cl as Fe,aH as bt,cm as Pn}from"./entry.efa1cdc8.js";import{E as Wn}from"./el-button.a37edf7d.js";import{t as Un,E as Vn}from"./el-input.c0ed8d02.js";import{u as ke}from"./useTitle.3ad48261.js";import{E as qn,i as Yn}from"./focus-trap.a6ebf413.js";import{a as jn}from"./scroll.61a2e521.js";const Kn='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',Xn=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,Et=e=>Array.from(e.querySelectorAll(Kn)).filter(t=>Gn(t)&&Xn(t)),Gn=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}};var Ie=(e=>(e[e.TEXT=1]="TEXT",e[e.CLASS=2]="CLASS",e[e.STYLE=4]="STYLE",e[e.PROPS=8]="PROPS",e[e.FULL_PROPS=16]="FULL_PROPS",e[e.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",e[e.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",e[e.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",e[e.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",e[e.NEED_PATCH=512]="NEED_PATCH",e[e.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",e[e.HOISTED=-1]="HOISTED",e[e.BAIL=-2]="BAIL",e))(Ie||{});const Fn=(e,t,r)=>{let n={offsetX:0,offsetY:0};const a=b=>{const x=b.clientX,o=b.clientY,{offsetX:S,offsetY:B}=n,c=e.value.getBoundingClientRect(),k=c.left,T=c.top,g=c.width,h=c.height,w=document.documentElement.clientWidth,s=document.documentElement.clientHeight,l=-k+S,m=-T+B,y=w-k-g+S,E=s-T-h+B,C=A=>{const M=Math.min(Math.max(S+A.clientX-x,l),y),I=Math.min(Math.max(B+A.clientY-o,m),E);n={offsetX:M,offsetY:I},e.value.style.transform=`translate(${ft(M)}, ${ft(I)})`},_=()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",_)};document.addEventListener("mousemove",C),document.addEventListener("mouseup",_)},i=()=>{t.value&&e.value&&t.value.addEventListener("mousedown",a)},p=()=>{t.value&&e.value&&t.value.removeEventListener("mousedown",a)};_t(()=>{pn(()=>{r.value?i():p()})}),It(()=>{p()})},Qn=(e,t={})=>{gn(e)||Un("[useLockscreen]","You need to pass a ref param to this function");const r=t.ns||Rt("popup"),n=yn(()=>r.bm("parent","hidden"));if(!Ht||dt(document.body,n.value))return;let a=0,i=!1,p="0";const b=()=>{setTimeout(()=>{En(document==null?void 0:document.body,n.value),i&&document&&(document.body.style.width=p)},200)};ee(e,x=>{if(!x){b();return}i=!dt(document.body,n.value),i&&(p=document.body.style.width),a=jn(r.namespace.value);const o=document.documentElement.clientHeight<document.body.scrollHeight,S=wn(document.body,"overflowY");a>0&&(o||S==="scroll")&&i&&(document.body.style.width=`calc(100% - ${a}px)`),Cn(document.body,n.value)}),bn(()=>b())},zt=e=>{if(!e)return{onClick:De,onMousedown:De,onMouseup:De};let t=!1,r=!1;return{onClick:p=>{t&&r&&e(p),t=r=!1},onMousedown:p=>{t=p.target===p.currentTarget},onMouseup:p=>{r=p.target===p.currentTarget}}},Qe="_trap-focus-children",se=[],St=e=>{if(se.length===0)return;const t=se[se.length-1][Qe];if(t.length>0&&e.code===Sn.tab){if(t.length===1){e.preventDefault(),document.activeElement!==t[0]&&t[0].focus();return}const r=e.shiftKey,n=e.target===t[0],a=e.target===t[t.length-1];n&&r&&(e.preventDefault(),t[t.length-1].focus()),a&&!r&&(e.preventDefault(),t[0].focus())}},Jn={beforeMount(e){e[Qe]=Et(e),se.push(e),se.length<=1&&document.addEventListener("keydown",St)},updated(e){ye(()=>{e[Qe]=Et(e)})},unmounted(){se.shift(),se.length===0&&document.removeEventListener("keydown",St)}},Zn=Bn({mask:{type:Boolean,default:!0},customMaskEvent:{type:Boolean,default:!1},overlayClass:{type:vt([String,Array,Object])},zIndex:{type:vt([String,Number])}}),eo={click:e=>e instanceof MouseEvent},to="overlay";var no=$t({name:"ElOverlay",props:Zn,emits:eo,setup(e,{slots:t,emit:r}){const n=Rt(to),a=x=>{r("click",x)},{onClick:i,onMousedown:p,onMouseup:b}=zt(e.customMaskEvent?void 0:a);return()=>e.mask?Z("div",{class:[n.b(),e.overlayClass],style:{zIndex:e.zIndex},onClick:i,onMousedown:p,onMouseup:b},[Ge(t,"default")],Ie.STYLE|Ie.CLASS|Ie.PROPS,["onClick","onMouseup","onMousedown"]):Tn("div",{class:e.overlayClass,style:{zIndex:e.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[Ge(t,"default")])}});const oo=no,ro=$t({name:"ElMessageBox",directives:{TrapFocus:Jn},components:{ElButton:Wn,ElFocusTrap:qn,ElInput:Vn,ElOverlay:oo,ElIcon:kn,...xn},inheritAttrs:!1,props:{buttonSize:{type:String,validator:Yn},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:t}){const{locale:r,zIndex:n,ns:a,size:i}=Mn("message-box",ie(()=>e.buttonSize)),{t:p}=r,{nextZIndex:b}=n,x=N(!1),o=tt({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:null,inputValidator:null,inputErrorMessage:"",message:null,modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:b()}),S=ie(()=>{const H=o.type;return{[a.bm("icon",H)]:H&&ht[H]}}),B=mt(),c=mt(),k=ie(()=>o.icon||ht[o.type]||""),T=ie(()=>!!o.message),g=N(),h=N(),w=N(),s=N(),l=N(),m=ie(()=>o.confirmButtonClass);ee(()=>o.inputValue,async H=>{await ye(),e.boxType==="prompt"&&H!==null&&I()},{immediate:!0}),ee(()=>x.value,H=>{var O,z;H&&(e.boxType!=="prompt"&&(o.autofocus?w.value=(z=(O=l.value)==null?void 0:O.$el)!=null?z:g.value:w.value=g.value),o.zIndex=b()),e.boxType==="prompt"&&(H?ye().then(()=>{var D;s.value&&s.value.$el&&(o.autofocus?w.value=(D=R())!=null?D:g.value:w.value=g.value)}):(o.editorErrorMessage="",o.validateError=!1))});const y=ie(()=>e.draggable);Fn(g,h,y),_t(async()=>{await ye(),e.closeOnHashChange&&window.addEventListener("hashchange",E)}),It(()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",E)});function E(){x.value&&(x.value=!1,ye(()=>{o.action&&t("action",o.action)}))}const C=()=>{e.closeOnClickModal&&M(o.distinguishCancelAndClose?"close":"cancel")},_=zt(C),A=H=>{if(o.inputType!=="textarea")return H.preventDefault(),M("confirm")},M=H=>{var O;e.boxType==="prompt"&&H==="confirm"&&!I()||(o.action=H,o.beforeClose?(O=o.beforeClose)==null||O.call(o,H,o,E):E())},I=()=>{if(e.boxType==="prompt"){const H=o.inputPattern;if(H&&!H.test(o.inputValue||""))return o.editorErrorMessage=o.inputErrorMessage||p("el.messagebox.error"),o.validateError=!0,!1;const O=o.inputValidator;if(typeof O=="function"){const z=O(o.inputValue);if(z===!1)return o.editorErrorMessage=o.inputErrorMessage||p("el.messagebox.error"),o.validateError=!0,!1;if(typeof z=="string")return o.editorErrorMessage=z,o.validateError=!0,!1}}return o.editorErrorMessage="",o.validateError=!1,!0},R=()=>{const H=s.value.$refs;return H.input||H.textarea},W=()=>{M("close")},Y=()=>{e.closeOnPressEscape&&W()};return e.lockScroll&&Qn(x),{..._n(o),ns:a,overlayEvent:_,visible:x,hasMessage:T,typeClass:S,contentId:B,inputId:c,btnSize:i,iconComponent:k,confirmButtonClasses:m,rootRef:g,focusStartRef:w,headerRef:h,inputRef:s,confirmRef:l,doClose:E,handleClose:W,onCloseRequested:Y,handleWrapperClick:C,handleInputEnter:A,handleAction:M,t:p}}}),so=["aria-label","aria-describedby"],ao=["aria-label"],io=["id"];function lo(e,t,r,n,a,i){const p=le("el-icon"),b=le("close"),x=le("el-input"),o=le("el-button"),S=le("el-focus-trap"),B=le("el-overlay");return V(),Q(In,{name:"fade-in-linear",onAfterLeave:t[11]||(t[11]=c=>e.$emit("vanish")),persisted:""},{default:X(()=>[Ne(Z(B,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:X(()=>[G("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:$(`${e.ns.namespace.value}-overlay-message-box`),onClick:t[8]||(t[8]=(...c)=>e.overlayEvent.onClick&&e.overlayEvent.onClick(...c)),onMousedown:t[9]||(t[9]=(...c)=>e.overlayEvent.onMousedown&&e.overlayEvent.onMousedown(...c)),onMouseup:t[10]||(t[10]=(...c)=>e.overlayEvent.onMouseup&&e.overlayEvent.onMouseup(...c))},[Z(S,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:X(()=>[G("div",{ref:"rootRef",class:$([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),{[e.ns.m("center")]:e.center}]),style:pt(e.customStyle),tabindex:"-1",onClick:t[7]||(t[7]=Be(()=>{},["stop"]))},[e.title!==null&&e.title!==void 0?(V(),ze("div",{key:0,ref:"headerRef",class:$(e.ns.e("header"))},[G("div",{class:$(e.ns.e("title"))},[e.iconComponent&&e.center?(V(),Q(p,{key:0,class:$([e.ns.e("status"),e.typeClass])},{default:X(()=>[(V(),Q(Te(e.iconComponent)))]),_:1},8,["class"])):ce("v-if",!0),G("span",null,ve(e.title),1)],2),e.showClose?(V(),ze("button",{key:0,type:"button",class:$(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:t[0]||(t[0]=c=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel")),onKeydown:t[1]||(t[1]=Ae(Be(c=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"]))},[Z(p,{class:$(e.ns.e("close"))},{default:X(()=>[Z(b)]),_:1},8,["class"])],42,ao)):ce("v-if",!0)],2)):ce("v-if",!0),G("div",{id:e.contentId,class:$(e.ns.e("content"))},[G("div",{class:$(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?(V(),Q(p,{key:0,class:$([e.ns.e("status"),e.typeClass])},{default:X(()=>[(V(),Q(Te(e.iconComponent)))]),_:1},8,["class"])):ce("v-if",!0),e.hasMessage?(V(),ze("div",{key:1,class:$(e.ns.e("message"))},[Ge(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?(V(),Q(Te(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):(V(),Q(Te(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0},{default:X(()=>[Pe(ve(e.dangerouslyUseHTMLString?"":e.message),1)]),_:1},8,["for"]))])],2)):ce("v-if",!0)],2),Ne(G("div",{class:$(e.ns.e("input"))},[Z(x,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":t[2]||(t[2]=c=>e.inputValue=c),type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:$({invalid:e.validateError}),onKeydown:Ae(e.handleInputEnter,["enter"])},null,8,["id","modelValue","type","placeholder","aria-invalid","class","onKeydown"]),G("div",{class:$(e.ns.e("errormsg")),style:pt({visibility:e.editorErrorMessage?"visible":"hidden"})},ve(e.editorErrorMessage),7)],2),[[We,e.showInput]])],10,io),G("div",{class:$(e.ns.e("btns"))},[e.showCancelButton?(V(),Q(o,{key:0,loading:e.cancelButtonLoading,class:$([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:t[3]||(t[3]=c=>e.handleAction("cancel")),onKeydown:t[4]||(t[4]=Ae(Be(c=>e.handleAction("cancel"),["prevent"]),["enter"]))},{default:X(()=>[Pe(ve(e.cancelButtonText||e.t("el.messagebox.cancel")),1)]),_:1},8,["loading","class","round","size"])):ce("v-if",!0),Ne(Z(o,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,class:$([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:t[5]||(t[5]=c=>e.handleAction("confirm")),onKeydown:t[6]||(t[6]=Ae(Be(c=>e.handleAction("confirm"),["prevent"]),["enter"]))},{default:X(()=>[Pe(ve(e.confirmButtonText||e.t("el.messagebox.confirm")),1)]),_:1},8,["loading","class","round","disabled","size"]),[[We,e.showConfirmButton]])],2)],6)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,so)]),_:3},8,["z-index","overlay-class","mask"]),[[We,e.visible]])]),_:3})}var co=An(ro,[["render",lo],["__file","/home/runner/work/element-plus/element-plus/packages/components/message-box/src/index.vue"]]);const Ce=new Map,uo=e=>{let t=document.body;return e.appendTo&&(Lt(e.appendTo)&&(t=document.querySelector(e.appendTo)),wt(e.appendTo)&&(t=e.appendTo),wt(t)||(t=document.body)),t},fo=(e,t,r=null)=>{const n=Z(co,e,yt(e.message)||Ot(e.message)?{default:yt(e.message)?e.message:()=>e.message}:null);return n.appContext=r,Dt(n,t),uo(e).appendChild(t.firstElementChild),n.component},vo=()=>document.createElement("div"),ho=(e,t)=>{const r=vo();e.onVanish=()=>{Dt(null,r),Ce.delete(a)},e.onAction=i=>{const p=Ce.get(a);let b;e.showInput?b={value:a.inputValue,action:i}:b=i,e.callback?e.callback(b,n.proxy):i==="cancel"||i==="close"?e.distinguishCancelAndClose&&i!=="cancel"?p.reject("close"):p.reject("cancel"):p.resolve(b)};const n=fo(e,r,t),a=n.proxy;for(const i in e)gt(e,i)&&!gt(a.$props,i)&&(a[i]=e[i]);return a.visible=!0,a};function ue(e,t=null){if(!Ht)return Promise.reject();let r;return Lt(e)||Ot(e)?e={message:e}:r=e.callback,new Promise((n,a)=>{const i=ho(e,t??ue._context);Ce.set(i,{options:e,callback:r,resolve:n,reject:a})})}const mo=["alert","confirm","prompt"],po={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};mo.forEach(e=>{ue[e]=go(e)});function go(e){return(t,r,n,a)=>{let i="";return Rn(r)?(n=r,i=""):Hn(r)?i="":i=r,ue(Object.assign({title:i,message:t,type:"",...po[e]},n,{boxType:e}),a)}}ue.close=()=>{Ce.forEach((e,t)=>{t.doClose()}),Ce.clear()};ue._context=null;const J=ue;J.install=e=>{J._context=e._context,e.config.globalProperties.$msgbox=J,e.config.globalProperties.$messageBox=J,e.config.globalProperties.$alert=J.alert,e.config.globalProperties.$confirm=J.confirm,e.config.globalProperties.$prompt=J.prompt};const Ue=J;var yo=$n,wo=Ln,Co=On,bo={formats:Co,parse:wo,stringify:yo};const Pt=nt(bo);async function ne(e=0){return await new Promise((t,r)=>{setTimeout(()=>{try{window.scrollTo(0,document.body.scrollHeight),t(null)}catch(n){r(n)}},+e||0)})}const Eo={get isMobileScreen(){return window.innerWidth<600},get isTouchScreen(){return"ontouchstart"in document||navigator.maxTouchPoints>0}};function Bt(){return Eo}const Tt="web-browsing",At="temperature-suffix",Ve="temperature",Oe=e=>(e==null?void 0:e.toString)===void 0?"":e.toString(),So=e=>Oe(e).toLowerCase(),Wt="01",Ut="0123456789",Vt="0123456789abcdef",qt="0123456789abcdefghijklmnopqrstuvwxyz",Yt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",Je=e=>{switch(typeof e!="string"&&(e=So(e)),e){case"2":return Wt;case"10":return Ut;case"16":return Vt;case"36":return qt;case"62":return Yt;case"64":return ae;case"64w":case"64+":return jt;default:return e}},Bo=(e,t,r,n=0)=>{typeof e!="string"&&(e=Oe(e));let a=BigInt(0);t=Je(t);const i=t.length;for(let b=0;b<e.length;b++)a+=BigInt(t.indexOf(e[b])*Math.pow(i,e.length-1-b));let p="";if(r=Je(r),p===""){const b=BigInt(r.length);for(;a>0;)p=r.charAt(+BigInt(a%b).toString())+p,a=BigInt(a/b)}return(p===""?r.charAt(0):p).padStart(n,r[0])},To=e=>{const t=e.split("").map(i=>i.charCodeAt(0)),r=[];let n=0;for(;n<t.length;){const[i,p=0,b=0]=t.slice(n,n+=3),x=(i<<16)+(p<<8)+b,o=x>>18,S=x>>12&63,B=x>>6&63,c=x&63;r.push(ae[o],ae[S],ae[B],ae[c])}const a=t.length%3;return r.join("").slice(0,1+r.length-a)+(a===2?"==":a===1?"=":"")},Ao=/[^A-Za-z0-9+/]/g,Kt=e=>e.replace(Ao,""),qe=e=>String.fromCharCode(+e),ko=e=>{const t=Kt(e).split(""),r=[];let n=0;for(;n<t.length;){const[a,i,p,b]=t.slice(n,n+=4).map(x=>ae.indexOf(x));r.push(qe(a<<2|i>>4)),p!==64&&r.push(qe((i&15)<<4|p>>2)),b!==64&&r.push(qe((p&3)<<6|b))}return r.join("").replaceAll("\0","")},fe={BASE2_CHARSET:Wt,BASE10_CHARSET:Ut,BASE16_CHARSET:Vt,BASE36_CHARSET:qt,BASE62_CHARSET:Yt,BASE64_CHARSET:ae,BASE64WEB_CHARSET:jt,convert:Bo,getCharset:Je,secureBase64:Kt,textToBase64:To,base64ToText:ko};var Xt={exports:{}};function xo(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ye={exports:{}},kt;function ot(){return kt||(kt=1,function(e,t){(function(r,n){e.exports=n()})(re,function(){var r=r||function(n,a){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof re<"u"&&re.crypto&&(i=re.crypto),!i&&typeof xo=="function")try{i=Dn}catch{}var p=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},b=Object.create||function(){function s(){}return function(l){var m;return s.prototype=l,m=new s,s.prototype=null,m}}(),x={},o=x.lib={},S=o.Base=function(){return{extend:function(s){var l=b(this);return s&&l.mixIn(s),(!l.hasOwnProperty("init")||this.init===l.init)&&(l.init=function(){l.$super.init.apply(this,arguments)}),l.init.prototype=l,l.$super=this,l},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var l in s)s.hasOwnProperty(l)&&(this[l]=s[l]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),B=o.WordArray=S.extend({init:function(s,l){s=this.words=s||[],l!=a?this.sigBytes=l:this.sigBytes=s.length*4},toString:function(s){return(s||k).stringify(this)},concat:function(s){var l=this.words,m=s.words,y=this.sigBytes,E=s.sigBytes;if(this.clamp(),y%4)for(var C=0;C<E;C++){var _=m[C>>>2]>>>24-C%4*8&255;l[y+C>>>2]|=_<<24-(y+C)%4*8}else for(var A=0;A<E;A+=4)l[y+A>>>2]=m[A>>>2];return this.sigBytes+=E,this},clamp:function(){var s=this.words,l=this.sigBytes;s[l>>>2]&=4294967295<<32-l%4*8,s.length=n.ceil(l/4)},clone:function(){var s=S.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var l=[],m=0;m<s;m+=4)l.push(p());return new B.init(l,s)}}),c=x.enc={},k=c.Hex={stringify:function(s){for(var l=s.words,m=s.sigBytes,y=[],E=0;E<m;E++){var C=l[E>>>2]>>>24-E%4*8&255;y.push((C>>>4).toString(16)),y.push((C&15).toString(16))}return y.join("")},parse:function(s){for(var l=s.length,m=[],y=0;y<l;y+=2)m[y>>>3]|=parseInt(s.substr(y,2),16)<<24-y%8*4;return new B.init(m,l/2)}},T=c.Latin1={stringify:function(s){for(var l=s.words,m=s.sigBytes,y=[],E=0;E<m;E++){var C=l[E>>>2]>>>24-E%4*8&255;y.push(String.fromCharCode(C))}return y.join("")},parse:function(s){for(var l=s.length,m=[],y=0;y<l;y++)m[y>>>2]|=(s.charCodeAt(y)&255)<<24-y%4*8;return new B.init(m,l)}},g=c.Utf8={stringify:function(s){try{return decodeURIComponent(escape(T.stringify(s)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(s){return T.parse(unescape(encodeURIComponent(s)))}},h=o.BufferedBlockAlgorithm=S.extend({reset:function(){this._data=new B.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=g.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var l,m=this._data,y=m.words,E=m.sigBytes,C=this.blockSize,_=C*4,A=E/_;s?A=n.ceil(A):A=n.max((A|0)-this._minBufferSize,0);var M=A*C,I=n.min(M*4,E);if(M){for(var R=0;R<M;R+=C)this._doProcessBlock(y,R);l=y.splice(0,M),m.sigBytes-=I}return new B.init(l,I)},clone:function(){var s=S.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0});o.Hasher=h.extend({cfg:S.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){s&&this._append(s);var l=this._doFinalize();return l},blockSize:16,_createHelper:function(s){return function(l,m){return new s.init(m).finalize(l)}},_createHmacHelper:function(s){return function(l,m){return new w.HMAC.init(s,m).finalize(l)}}});var w=x.algo={};return x}(Math);return r})}(Ye)),Ye.exports}var je={exports:{}},xt;function Mo(){return xt||(xt=1,function(e,t){(function(r,n){e.exports=n(ot())})(re,function(r){return function(n){var a=r,i=a.lib,p=i.Base,b=i.WordArray,x=a.x64={};x.Word=p.extend({init:function(o,S){this.high=o,this.low=S}}),x.WordArray=p.extend({init:function(o,S){o=this.words=o||[],S!=n?this.sigBytes=S:this.sigBytes=o.length*8},toX32:function(){for(var o=this.words,S=o.length,B=[],c=0;c<S;c++){var k=o[c];B.push(k.high),B.push(k.low)}return b.create(B,this.sigBytes)},clone:function(){for(var o=p.clone.call(this),S=o.words=this.words.slice(0),B=S.length,c=0;c<B;c++)S[c]=S[c].clone();return o}})}(),r})}(je)),je.exports}(function(e,t){(function(r,n,a){e.exports=n(ot(),Mo())})(re,function(r){return function(n){var a=r,i=a.lib,p=i.WordArray,b=i.Hasher,x=a.x64,o=x.Word,S=a.algo,B=[],c=[],k=[];(function(){for(var h=1,w=0,s=0;s<24;s++){B[h+5*w]=(s+1)*(s+2)/2%64;var l=w%5,m=(2*h+3*w)%5;h=l,w=m}for(var h=0;h<5;h++)for(var w=0;w<5;w++)c[h+5*w]=w+(2*h+3*w)%5*5;for(var y=1,E=0;E<24;E++){for(var C=0,_=0,A=0;A<7;A++){if(y&1){var M=(1<<A)-1;M<32?_^=1<<M:C^=1<<M-32}y&128?y=y<<1^113:y<<=1}k[E]=o.create(C,_)}})();var T=[];(function(){for(var h=0;h<25;h++)T[h]=o.create()})();var g=S.SHA3=b.extend({cfg:b.cfg.extend({outputLength:512}),_doReset:function(){for(var h=this._state=[],w=0;w<25;w++)h[w]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(h,w){for(var s=this._state,l=this.blockSize/2,m=0;m<l;m++){var y=h[w+2*m],E=h[w+2*m+1];y=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,E=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360;var C=s[m];C.high^=E,C.low^=y}for(var _=0;_<24;_++){for(var A=0;A<5;A++){for(var M=0,I=0,R=0;R<5;R++){var C=s[A+5*R];M^=C.high,I^=C.low}var W=T[A];W.high=M,W.low=I}for(var A=0;A<5;A++)for(var Y=T[(A+4)%5],H=T[(A+1)%5],O=H.high,z=H.low,M=Y.high^(O<<1|z>>>31),I=Y.low^(z<<1|O>>>31),R=0;R<5;R++){var C=s[A+5*R];C.high^=M,C.low^=I}for(var D=1;D<25;D++){var M,I,C=s[D],j=C.high,K=C.low,u=B[D];u<32?(M=j<<u|K>>>32-u,I=K<<u|j>>>32-u):(M=K<<u-32|j>>>64-u,I=j<<u-32|K>>>64-u);var f=T[c[D]];f.high=M,f.low=I}var d=T[0],v=s[0];d.high=v.high,d.low=v.low;for(var A=0;A<5;A++)for(var R=0;R<5;R++){var D=A+5*R,C=s[D],it=T[D],lt=T[(A+1)%5+5*R],ct=T[(A+2)%5+5*R];C.high=it.high^~lt.high&ct.high,C.low=it.low^~lt.low&ct.low}var C=s[0],ut=k[_];C.high^=ut.high,C.low^=ut.low}},_doFinalize:function(){var h=this._data,w=h.words;this._nDataBytes*8;var s=h.sigBytes*8,l=this.blockSize*32;w[s>>>5]|=1<<24-s%32,w[(n.ceil((s+1)/l)*l>>>5)-1]|=128,h.sigBytes=w.length*4,this._process();for(var m=this._state,y=this.cfg.outputLength/8,E=y/8,C=[],_=0;_<E;_++){var A=m[_],M=A.high,I=A.low;M=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360,I=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,C.push(I),C.push(M)}return new p.init(C,y)},clone:function(){for(var h=b.clone.call(this),w=h._state=this._state.slice(0),s=0;s<25;s++)w[s]=w[s].clone();return h}});a.SHA3=b._createHelper(g),a.HmacSHA3=b._createHmacHelper(g)}(Math),r.SHA3})})(Xt);var _o=Xt.exports;const Gt=nt(_o);function Io(...e){return e.reduce((t,r)=>t+r,0)}function Ro(e){try{return typeof e[Symbol==null?void 0:Symbol.iterator]=="function"}catch{return!1}}function Ft(e){const t=new Set;return JSON.stringify(e,(n,a)=>{if(typeof a=="object"&&a!==null){if(t.has(a))return;t.add(a),Ro(a)&&(a=[...a])}return a})}const Ho=e=>Gt(e,{outputLength:256}).toString(),$o=/0b[0-1]+/i;function be(e){if(typeof e=="number")return Math.round(e);if(e instanceof Object&&(e=Ft(e)),typeof e=="string"){if($o.test(e))return parseInt(e.substring(2,e.length-1),2);const t=parseInt(e);return Number.isNaN(t)?t:Io(parseInt(Ho(e),16))}else return Date.now()}const L=624,xe=397,Lo=2567483615,Ke=2147483648,Xe=2147483647;class Oo{constructor(t){Se(this,"mt",new Array(L));Se(this,"mti",L+1);Se(this,"seed");return this.seed=t=be(t),Array.isArray(t)?this.init_by_array(t,t.length):this.init_seed(t),this}init_seed(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<L;this.mti++)t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(((t&4294901760)>>>16)*1812433253<<16)+(t&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}init_by_array(t,r){let n,a,i;for(this.init_seed(19650218),n=1,a=0,i=L>r?L:r;i!==0;i--){const p=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((p&4294901760)>>>16)*1664525<<16)+(p&65535)*1664525)+t[a]+a,this.mt[n]>>>=0,n++,a++,n>=L&&(this.mt[0]=this.mt[L-1],n=1),a>=r&&(a=0)}for(i=L-1;i!==0;i--){const p=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((p&4294901760)>>>16)*1566083941<<16)+(p&65535)*1566083941)-n,this.mt[n]>>>=0,n++,n>=L&&(this.mt[0]=this.mt[L-1],n=1)}this.mt[0]=2147483648}random_int(){let t;const r=new Array(0,Lo);if(this.mti>=L){let n;for(this.mti===L+1&&this.init_seed(5489),n=0;n<L-xe;n++)t=this.mt[n]&Ke|this.mt[n+1]&Xe,this.mt[n]=this.mt[n+xe]^t>>>1^r[t&1];for(;n<L-1;n++)t=this.mt[n]&Ke|this.mt[n+1]&Xe,this.mt[n]=this.mt[n+(xe-L)]^t>>>1^r[t&1];t=this.mt[L-1]&Ke|this.mt[0]&Xe,this.mt[L-1]=this.mt[xe-1]^t>>>1^r[t&1],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0}random_int31(){return this.random_int()>>>1}random_incl(){return this.random_int()*(1/4294967295)}random(){return this.random_int()*(1/4294967296)}random_excl(){return(this.random_int()+.5)*(1/4294967296)}random_long(){return((this.random_int()>>>5)*67108864+(this.random_int()>>>6))*(1/9007199254740992)}}function Qt(e){return new Oo(e)}const{BASE10_CHARSET:Do,BASE16_CHARSET:No,BASE64WEB_CHARSET:zo}=fe,Po=Qt(),Jt=(e=Po)=>e.random(),rt=(e,t,r)=>((t===void 0||t===0)&&(t=e,e=0),Math.floor(e+Jt(r)*t)),Zt=(e,t)=>e[rt(0,e.length,t)],en=(e,t=1,r)=>{const n=[],a=[];for(let i=0;i<t;i++)a.length===0&&a.push(...e),n.push(a.splice(rt(0,a.length,r),1)[0]);return n},Wo=(e,t)=>en(e,e.length,t),Me=(e,t=8,r)=>new Array(t).fill(0).map(n=>Zt(e,r)).join(""),tn={MT:Qt,toSeed:be,rand:Jt,randInt:rt,charset:Me,choice:Zt,choices:en,shuffle:Wo,base10:(e=6,t)=>Me(Do,e,t),base16:(e=32,t)=>Me(No,e,t),base64:(e=32,t)=>Me(zo,e,t),lcg(e){let t=be(e);return()=>(t=(t*1664525+1013904223)%4294967296)/4294967296}};var nn={exports:{}};(function(e,t){(function(r,n){e.exports=n(ot())})(re,function(r){return function(n){var a=r,i=a.lib,p=i.WordArray,b=i.Hasher,x=a.algo,o=[];(function(){for(var g=0;g<64;g++)o[g]=n.abs(n.sin(g+1))*4294967296|0})();var S=x.MD5=b.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(g,h){for(var w=0;w<16;w++){var s=h+w,l=g[s];g[s]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360}var m=this._hash.words,y=g[h+0],E=g[h+1],C=g[h+2],_=g[h+3],A=g[h+4],M=g[h+5],I=g[h+6],R=g[h+7],W=g[h+8],Y=g[h+9],H=g[h+10],O=g[h+11],z=g[h+12],D=g[h+13],j=g[h+14],K=g[h+15],u=m[0],f=m[1],d=m[2],v=m[3];u=B(u,f,d,v,y,7,o[0]),v=B(v,u,f,d,E,12,o[1]),d=B(d,v,u,f,C,17,o[2]),f=B(f,d,v,u,_,22,o[3]),u=B(u,f,d,v,A,7,o[4]),v=B(v,u,f,d,M,12,o[5]),d=B(d,v,u,f,I,17,o[6]),f=B(f,d,v,u,R,22,o[7]),u=B(u,f,d,v,W,7,o[8]),v=B(v,u,f,d,Y,12,o[9]),d=B(d,v,u,f,H,17,o[10]),f=B(f,d,v,u,O,22,o[11]),u=B(u,f,d,v,z,7,o[12]),v=B(v,u,f,d,D,12,o[13]),d=B(d,v,u,f,j,17,o[14]),f=B(f,d,v,u,K,22,o[15]),u=c(u,f,d,v,E,5,o[16]),v=c(v,u,f,d,I,9,o[17]),d=c(d,v,u,f,O,14,o[18]),f=c(f,d,v,u,y,20,o[19]),u=c(u,f,d,v,M,5,o[20]),v=c(v,u,f,d,H,9,o[21]),d=c(d,v,u,f,K,14,o[22]),f=c(f,d,v,u,A,20,o[23]),u=c(u,f,d,v,Y,5,o[24]),v=c(v,u,f,d,j,9,o[25]),d=c(d,v,u,f,_,14,o[26]),f=c(f,d,v,u,W,20,o[27]),u=c(u,f,d,v,D,5,o[28]),v=c(v,u,f,d,C,9,o[29]),d=c(d,v,u,f,R,14,o[30]),f=c(f,d,v,u,z,20,o[31]),u=k(u,f,d,v,M,4,o[32]),v=k(v,u,f,d,W,11,o[33]),d=k(d,v,u,f,O,16,o[34]),f=k(f,d,v,u,j,23,o[35]),u=k(u,f,d,v,E,4,o[36]),v=k(v,u,f,d,A,11,o[37]),d=k(d,v,u,f,R,16,o[38]),f=k(f,d,v,u,H,23,o[39]),u=k(u,f,d,v,D,4,o[40]),v=k(v,u,f,d,y,11,o[41]),d=k(d,v,u,f,_,16,o[42]),f=k(f,d,v,u,I,23,o[43]),u=k(u,f,d,v,Y,4,o[44]),v=k(v,u,f,d,z,11,o[45]),d=k(d,v,u,f,K,16,o[46]),f=k(f,d,v,u,C,23,o[47]),u=T(u,f,d,v,y,6,o[48]),v=T(v,u,f,d,R,10,o[49]),d=T(d,v,u,f,j,15,o[50]),f=T(f,d,v,u,M,21,o[51]),u=T(u,f,d,v,z,6,o[52]),v=T(v,u,f,d,_,10,o[53]),d=T(d,v,u,f,H,15,o[54]),f=T(f,d,v,u,E,21,o[55]),u=T(u,f,d,v,W,6,o[56]),v=T(v,u,f,d,K,10,o[57]),d=T(d,v,u,f,I,15,o[58]),f=T(f,d,v,u,D,21,o[59]),u=T(u,f,d,v,A,6,o[60]),v=T(v,u,f,d,O,10,o[61]),d=T(d,v,u,f,C,15,o[62]),f=T(f,d,v,u,Y,21,o[63]),m[0]=m[0]+u|0,m[1]=m[1]+f|0,m[2]=m[2]+d|0,m[3]=m[3]+v|0},_doFinalize:function(){var g=this._data,h=g.words,w=this._nDataBytes*8,s=g.sigBytes*8;h[s>>>5]|=128<<24-s%32;var l=n.floor(w/4294967296),m=w;h[(s+64>>>9<<4)+15]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360,h[(s+64>>>9<<4)+14]=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,g.sigBytes=(h.length+1)*4,this._process();for(var y=this._hash,E=y.words,C=0;C<4;C++){var _=E[C];E[C]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360}return y},clone:function(){var g=b.clone.call(this);return g._hash=this._hash.clone(),g}});function B(g,h,w,s,l,m,y){var E=g+(h&w|~h&s)+l+y;return(E<<m|E>>>32-m)+h}function c(g,h,w,s,l,m,y){var E=g+(h&s|w&~s)+l+y;return(E<<m|E>>>32-m)+h}function k(g,h,w,s,l,m,y){var E=g+(h^w^s)+l+y;return(E<<m|E>>>32-m)+h}function T(g,h,w,s,l,m,y){var E=g+(w^(h|~s))+l+y;return(E<<m|E>>>32-m)+h}a.MD5=b._createHelper(S),a.HmacMD5=b._createHmacHelper(S)}(Math),r.MD5})})(nn);var Uo=nn.exports;const Vo=nt(Uo),{MT:Le,shuffle:qo,randInt:Re}=tn,{convert:on,getCharset:rn}=fe,sn=(e,t)=>{const r=qo(e,t);return()=>(r.push(r.shift()),r)},an=(e,t=16,r=1,n)=>{const a=Number.isNaN(+t)?64:+t,i=rn(t),p=be(n!==void 0?n:Re(0,a)),b=Le(p),x=sn(i,Le(Re(0,1e6,b))),o=typeof e=="string"?e.split(""):e,S=[n!==void 0?i[Re(0,a)]:on(p,10,t),...o.map(B=>x()[i.indexOf(B)])];return--r<1?S.join(""):an(S,t,r,n)},ln=(e,t=16,r=1,n)=>{const a=rn(t),i=be(n!==void 0?n:+on(e[0],t,10)),p=Le(i),b=sn(a,Le(Re(0,1e6,p))),o=(typeof e=="string"?e.split(""):e).slice(1,e.length).map(S=>a[b().indexOf(S)]);return--r<1?o.join(""):ln(o,t,r,n)},{textToBase64:Yo,base64ToText:jo,secureBase64:Ko}=fe;function cn(e,t=1,r){return typeof e=="object"?e=Ft(e):typeof e!="string"&&(e=Oe(e)),an(Ko(Yo(e)),64,t,r)}function Xo(e,t=1,r,n=!0){if(e=jo(ln(e,64,t,r)),!n)return e;try{return JSON.parse(e)}catch{return e}}function Go(e,t=512,r){const n=cn(e,1,r).substring(1);return t==="MD5"?Vo(n).toString():Gt(n,{outputLength:t}).toString()}const Fo={e:cn,d:Xo,h:Go},Qo=new Map([["THINKING","Please wait, I am answering another question..."]]);function Jo(e,t){switch(e){case"model":if(["gpt3","gpt4","gpt-web-1","gpt-web-2"].includes(t))return!0;break;case"temperature":if(typeof t=="number"&&t>=0&&t<=1)return!0;break;case"context":if(typeof t=="boolean")return!0;break}return!1}function Zo(e){try{return JSON.parse(e)}catch{return e}}function un(e){try{const t={};for(const r in e){const n=Zo(e[r]);Jo(r,n)&&(t[r]=n)}return t}catch{return{}}}function er(e){try{return un(Pt.parse(e))}catch{return{}}}function tr(e){try{return Pt.stringify(un(e))}catch{return""}}new EventTarget;const he=()=>{try{document.querySelector(".InputBox textarea").focus()}catch{}},_e=()=>new Promise((e,t)=>{$fetch("/api/curva/check",{method:"POST"}).then(r=>{const{list:n,saved:a}=r;te.value=n.sort().map(i=>{var p,b;return{id:i,name:(p=a[i])==null?void 0:p.name,config:((b=a[i])==null?void 0:b.config)||""}}),e(!0)}).catch(r=>{q.error("Initialization Failed"),t(r)})}),nr=e=>new Promise(async(t,r)=>{if(e==null)return t([]);const n=await $fetch("/api/curva/history",{method:"POST",body:{id:e}});(!n||n.length===0)&&$e("/c/");try{t(n.map(a=>tt({...a,t:new Date(a.t),done:!!a.A})))}catch{$e("/c/"),t([])}}),fn=async function(e){return await $fetch("/api/curva/suggestions",{method:"POST",body:{question:e}})},or=async()=>{try{const e=P.value.at(-1),t=await fn(e.Q),r=Fe()>=document.body.clientHeight;e.more=t,r&&ne()}catch(e){console.error(e)}};let st;const de=N("gpt4"),Ee=N(!0),F=N(.5),P=N([]),te=N([]),at=()=>{de.value="gpt4",Ee.value=!0,F.value=.5};at();const oe=N(!1),me=N(oe.value),pe=N(oe.value),ge=N(""),rr=(()=>{const{h:e}=Fo,t=()=>[77,68,53].map(a=>String.fromCharCode(a)).join(""),r=(a,i,p)=>({hash:e(`${a}${i}`,t(),p),timestamp:Oe(p)}),n=(a,i,p,b,x,o)=>{var B,c;let S=(c=(B=Nt()._route)==null?void 0:B.params)==null?void 0:c.conv;return S||(S=tn.base64(8),te.value.push({id:S,name:void 0}),$e(`/c/${S}?feature=new`)),{conv:S,context:"getContext()",prompt:a,model:i,temperature:p,t:b,tz:x,id:o}};return(a,i)=>{const p=new Date,b=p.getTime(),x=p.getTimezoneOffset()/60*-1,o=n(a,de.value,F.value,b,x,i),S=r(a,o.context,b);return $fetch("/api/curva/answer",{method:"POST",headers:S,body:o})}})(),sr=(e="",t="",r=!1)=>tt({done:r,Q:e,A:t,queries:[],urls:[],dt:void 0,t:new Date}),He=new Set,ar=()=>{te.value=[],P.value=[],$e("/c/"),Ze=!0};let Ze=!0;function Mt(){{const e=Pn();e.get("feature")==="new"&&(e.delete("feature"),e.save())}}const dn=(e,t)=>{const r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),r.remove()},U=()=>{var e,t;return(t=(e=st._route)==null?void 0:e.params)==null?void 0:t.conv},we=()=>{var t;const e=U();return((t=te.value.filter(r=>r.id===e)[0])==null?void 0:t.name)||""};async function vn(e,t){return await $fetch("/api/curva/conv",{method:"PUT",body:{id:e||U(),name:t||we(),config:tr({model:de.value,temperature:F.value,context:Ee.value})}})}let et=!1;const ir=e=>{var n;if(e===void 0&&(e=U()),e==null)return;const t=er(((n=te.value.filter(a=>a.id===e)[0])==null?void 0:n.config)||""),r=Object.keys(t);if(r.length===0)at();else{et=!0;try{for(const a of r){const i=t[a];switch(a){case"model":de.value=i;break;case"temperature":F.value=i;break;case"context":Ee.value=i;break}}}finally{et=!1}}q.info("Conversation settings have been loaded.")};setTimeout(()=>{let e;[de,Ee,F].forEach(t=>{ee(t,(r,n)=>{st&&!et&&r!==n&&He.size===0&&(clearTimeout(e),e=setTimeout(async()=>{try{await vn(),q.info("Conversation settings have been saved.")}catch(a){console.error(a),q.warning("Failed to save conversation settings.")}finally{clearTimeout(e)}},typeof t.value=="number"?500:0))})})},1e3);const lr=e=>{P.value=P.value.filter(t=>t.id!==e),$fetch("/api/curva/answer",{method:"DELETE",body:{conv:U(),id:e}}).then(()=>q.info("The message has been deleted.")).catch(()=>q.error("An error occurred while deleting the message."))},cr=()=>{let e=0;const t=`${fe.convert(U(),"64w",10)}.md`,r=P.value.map(n=>{e++;try{return(n.t?`${new Date(n.t.getTime()-(n.dt||0)).toLocaleString()}${n.dt===void 0?"":" (Δt: "+n.dt.toString()+"ms)"}

`:"")+(n.Q?`QUESTION ${e}:

${n.Q.replaceAll(`
`,`

`)}`:"")+(n.Q&&n.A?`

`:"")+(n.A?`ANSWER ${e}:

${n.A}`:"")}catch{return"(Unknown message)"}}).join(`

---

`)+`

---

`;dn(t,r)},ur=()=>{dn(`${fe.convert(U(),"64w",10)}.json`,JSON.stringify(P.value.map(e=>({question:e.Q,answer:e.A,created:new Date(e.t.getTime()).toUTCString(),timeUsed:e.dt||void 0,queries:e.queries||void 0,urls:e.urls||void 0})),null,4))};function yr(){const e=Ct("appName").value,t=Nn(),r=+(t.has(Ve)?t.get(Ve):.5);t.delete(Tt,{path:"/"}),t.delete(Tt),t.delete(At,{path:"/"}),t.delete(At),r>=0&&r<=1&&(F.value=r),ee(F,c=>{F.value=Math.round(c*10)/10,t.set(Ve,`${c}`,{path:"/"})}),st=Nt(),ee(oe,c=>{Bt().isMobileScreen?(me.value=!1,pe.value!==c&&(pe.value=c)):(pe.value=!1,me.value!==c&&(me.value=c)),setTimeout(()=>{try{he()}catch{}},0)}),ee(pe,c=>{oe.value=c}),ee(me,c=>{oe.value=c});const n=async c=>{Bt().isMobileScreen&&(oe.value=!1),P.value=[];const k=bt.service();try{const T=await Promise.all([c===null&&te.value.length>0?null:_e(),c===null?null:nr(c)]);ir(c);const g=T[1];g!==null&&U()===c&&(P.value=g,or())}finally{try{ke(`${we()||"Chat"} - ${e}`)}catch{ke(`Chat - ${e}`)}if(ne(),k!==null)try{await ne(500)}finally{k.close();try{await ne(500)}finally{}}}setTimeout(()=>he(),500)},a=async(c,k=!1)=>{const T=Promise.all([...He]),g=Ze&&k?new Promise(async h=>{await n(c),Mt(),h(null)}):k?new Promise(h=>h(null)):n(c);Ze=!1,He.add(g);try{await T}catch{}try{await g}finally{He.delete(g)}},i=zn().t,p=Ct("version"),b=(c,k)=>{if(document.querySelectorAll(".Message.T").length>0)return q.info("Thinking too many questions."),!1;const g=c===void 0?ge.value:c,h=g.trim();if(g===ge.value&&(ge.value="",h===""))return!1;const w=sr(h,"",!1);P.value.push(w),ne(),setTimeout(()=>{he()},500);const s=fn(h);return rr(h,k).then(l=>{Mt();const m=Fe()>=document.body.clientHeight,y=l.id,E=l.answer,C=l.error,_=l.urls,A=l.queries,M=l.dt,I=l.version;if(y&&(w.id=y),!E){if(C){const R=P.value.indexOf(w);switch(C){case"THINKING":P.value.splice(R,1),q.warning(Qo.get(C)),ge.value=h;return;default:throw C}}throw i("error.plzRefresh")}w.A=E,w.urls=_||[],w.queries=A||[],w.dt=M||void 0,I!==p.value&&Ue.confirm(i("action.newVersion"),i("message.notice"),{confirmButtonText:i("message.ok"),cancelButtonText:i("message.cancel"),type:"warning"}).then(()=>{location.reload()}).finally(()=>{he()}),m&&ne(),s.then(R=>{const W=Fe()>=document.body.clientHeight;w.more=R,W&&ne()}).catch(()=>{})}).catch(l=>{q.error(l||"Oops! Something went wrong!"),w.A="Oops! Something went wrong!"}).finally(()=>{w.done=!0,w.t=new Date}),!0};return{model:de,conversations:te,messages:P,temperature:F,contextMode:Ee,openMenu:oe,openSidebar:me,openDrawer:pe,inputValue:ge,getCurrentConvId:U,getCurrentConvName:we,checkTokenAndGetConversations:_e,loadChat:a,sendMessage:b,deleteMessage:lr,regenerateMessage:async()=>{const c=P.value.pop();c!==void 0&&(b(c.Q,c.id)||P.value.push(c))},focusInput:he,refreshConversation:()=>{a(U())},renameConversation:(c,k="")=>{c||(c=U(),k=we()),Ue.prompt(i("message.renameConvHint"),i("message.setting"),{confirmButtonText:i("message.ok"),cancelButtonText:i("message.cancel"),inputValue:k,inputPlaceholder:fe.convert(c,"64w",10)}).then(async({value:T})=>{try{await vn(c,T),q({type:"success",message:i("message.renameSuccess")}),await _e();try{ke(`${we()||"Chat"} - ${e}`)}catch{ke(`Chat - ${e}`)}}catch{q({type:"error",message:"Oops! Something went wrong!"})}}).catch(()=>{})},deleteConversation:c=>{var w,s;const k=c||U(),T=[...te.value];let g=-1,h="createNewChat";for(let l=0;l<T.length;l++)if(T[l].id===k){g=l;break}if(g!==-1){const l=(w=T[g-1])==null?void 0:w.id,m=(s=T[g+1])==null?void 0:s.id;l!==void 0?h=l:m!==void 0&&(h=m)}Ue.confirm(i("message.deleteConvConfirm"),i("message.warning"),{confirmButtonText:i("message.ok"),cancelButtonText:i("message.cancel"),type:"warning"}).then(()=>{const l=bt.service();$fetch("/api/curva/conv",{method:"DELETE",body:{id:k}}).finally(async()=>{var m;l.close(),c===U()?(m=document.getElementById(h))==null||m.click():await _e()})})},resetConvConfig:at,exportAsMarkdown:cr,exportAsJson:ur,clear:ar}}export{Ue as E,Fn as a,Qn as b,oo as c,zt as d,fe as e,Bt as f,tn as r,Oe as s,yr as u};
