var vn=Object.defineProperty;var hn=(e,t,r)=>t in e?vn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Be=(e,t,r)=>(hn(e,typeof t!="symbol"?t+"":t,r),r);import{$ as _t,a9 as mn,ao as It,aQ as ft,K as pn,I as Rt,cd as gn,L as Ht,a5 as dt,G as ee,ce as yn,a3 as wn,cf as bn,a6 as Cn,bW as Oe,J as be,aY as En,aL as Sn,aM as vt,N as Lt,b as Z,af as Ke,a7 as Bn,M as Tn,O as An,cg as kn,ch as Mn,F as ie,D as z,at as et,ci as ht,bf as mt,H as xn,S as le,o as q,U as Q,w as K,Y as Ne,a as G,V as L,ag as pt,aW as Te,c as De,aV as Ae,ah as ce,t as he,bp as ke,d as ze,ai as We,aT as _n,ap as $t,cj as Ot,ck as Nt,y as gt,B as In,an as Rn,aX as yt,a4 as wt,x as tt,cl as Hn,cm as Ln,cn as $n,co as On,cp as re,as as bt,cq as Nn,aJ as Dn,av as j,b6 as Le,aw as zn,cr as Ge,b5 as Ct,cs as Wn}from"./entry.63b3f33c.js";import{E as Pn}from"./el-button.9c6f1ffd.js";import{t as Un,E as Vn}from"./el-input.93a7722b.js";import{u as Me}from"./useTitle.0015af00.js";import{E as qn,i as jn,l as Yn,s as nt}from"./str.751aa1f4.js";import{a as Xn}from"./scroll.defd2da0.js";const Kn='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',Gn=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,Et=e=>Array.from(e.querySelectorAll(Kn)).filter(t=>Fn(t)&&Gn(t)),Fn=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}};var Ie=(e=>(e[e.TEXT=1]="TEXT",e[e.CLASS=2]="CLASS",e[e.STYLE=4]="STYLE",e[e.PROPS=8]="PROPS",e[e.FULL_PROPS=16]="FULL_PROPS",e[e.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",e[e.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",e[e.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",e[e.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",e[e.NEED_PATCH=512]="NEED_PATCH",e[e.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",e[e.HOISTED=-1]="HOISTED",e[e.BAIL=-2]="BAIL",e))(Ie||{});const Qn=(e,t,r)=>{let n={offsetX:0,offsetY:0};const i=C=>{const T=C.clientX,o=C.clientY,{offsetX:A,offsetY:k}=n,E=e.value.getBoundingClientRect(),p=E.left,B=E.top,y=E.width,v=E.height,w=document.documentElement.clientWidth,s=document.documentElement.clientHeight,h=-p+A,c=-B+k,g=w-p-y+A,b=s-B-v+k,S=M=>{const x=Math.min(Math.max(A+M.clientX-T,h),g),I=Math.min(Math.max(k+M.clientY-o,c),b);n={offsetX:x,offsetY:I},e.value.style.transform=`translate(${ft(x)}, ${ft(I)})`},_=()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",_)};document.addEventListener("mousemove",S),document.addEventListener("mouseup",_)},a=()=>{t.value&&e.value&&t.value.addEventListener("mousedown",i)},m=()=>{t.value&&e.value&&t.value.removeEventListener("mousedown",i)};_t(()=>{mn(()=>{r.value?a():m()})}),It(()=>{m()})},Jn=(e,t={})=>{pn(e)||Un("[useLockscreen]","You need to pass a ref param to this function");const r=t.ns||Rt("popup"),n=gn(()=>r.bm("parent","hidden"));if(!Ht||dt(document.body,n.value))return;let i=0,a=!1,m="0";const C=()=>{setTimeout(()=>{Cn(document==null?void 0:document.body,n.value),a&&document&&(document.body.style.width=m)},200)};ee(e,T=>{if(!T){C();return}a=!dt(document.body,n.value),a&&(m=document.body.style.width),i=Xn(r.namespace.value);const o=document.documentElement.clientHeight<document.body.scrollHeight,A=yn(document.body,"overflowY");i>0&&(o||A==="scroll")&&a&&(document.body.style.width=`calc(100% - ${i}px)`),wn(document.body,n.value)}),bn(()=>C())},Dt=e=>{if(!e)return{onClick:Oe,onMousedown:Oe,onMouseup:Oe};let t=!1,r=!1;return{onClick:m=>{t&&r&&e(m),t=r=!1},onMousedown:m=>{t=m.target===m.currentTarget},onMouseup:m=>{r=m.target===m.currentTarget}}},Fe="_trap-focus-children",se=[],St=e=>{if(se.length===0)return;const t=se[se.length-1][Fe];if(t.length>0&&e.code===En.tab){if(t.length===1){e.preventDefault(),document.activeElement!==t[0]&&t[0].focus();return}const r=e.shiftKey,n=e.target===t[0],i=e.target===t[t.length-1];n&&r&&(e.preventDefault(),t[t.length-1].focus()),i&&!r&&(e.preventDefault(),t[0].focus())}},Zn={beforeMount(e){e[Fe]=Et(e),se.push(e),se.length<=1&&document.addEventListener("keydown",St)},updated(e){be(()=>{e[Fe]=Et(e)})},unmounted(){se.shift(),se.length===0&&document.removeEventListener("keydown",St)}},eo=Sn({mask:{type:Boolean,default:!0},customMaskEvent:{type:Boolean,default:!1},overlayClass:{type:vt([String,Array,Object])},zIndex:{type:vt([String,Number])}}),to={click:e=>e instanceof MouseEvent},no="overlay";var oo=Lt({name:"ElOverlay",props:eo,emits:to,setup(e,{slots:t,emit:r}){const n=Rt(no),i=T=>{r("click",T)},{onClick:a,onMousedown:m,onMouseup:C}=Dt(e.customMaskEvent?void 0:i);return()=>e.mask?Z("div",{class:[n.b(),e.overlayClass],style:{zIndex:e.zIndex},onClick:a,onMousedown:m,onMouseup:C},[Ke(t,"default")],Ie.STYLE|Ie.CLASS|Ie.PROPS,["onClick","onMouseup","onMousedown"]):Bn("div",{class:e.overlayClass,style:{zIndex:e.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[Ke(t,"default")])}});const ro=oo,so=Lt({name:"ElMessageBox",directives:{TrapFocus:Zn},components:{ElButton:Pn,ElFocusTrap:qn,ElInput:Vn,ElOverlay:ro,ElIcon:An,...kn},inheritAttrs:!1,props:{buttonSize:{type:String,validator:jn},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:t}){const{locale:r,zIndex:n,ns:i,size:a}=Mn("message-box",ie(()=>e.buttonSize)),{t:m}=r,{nextZIndex:C}=n,T=z(!1),o=et({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:null,inputValidator:null,inputErrorMessage:"",message:null,modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:C()}),A=ie(()=>{const R=o.type;return{[i.bm("icon",R)]:R&&ht[R]}}),k=mt(),E=mt(),p=ie(()=>o.icon||ht[o.type]||""),B=ie(()=>!!o.message),y=z(),v=z(),w=z(),s=z(),h=z(),c=ie(()=>o.confirmButtonClass);ee(()=>o.inputValue,async R=>{await be(),e.boxType==="prompt"&&R!==null&&I()},{immediate:!0}),ee(()=>T.value,R=>{var O,P;R&&(e.boxType!=="prompt"&&(o.autofocus?w.value=(P=(O=h.value)==null?void 0:O.$el)!=null?P:y.value:w.value=y.value),o.zIndex=C()),e.boxType==="prompt"&&(R?be().then(()=>{var N;s.value&&s.value.$el&&(o.autofocus?w.value=(N=H())!=null?N:y.value:w.value=y.value)}):(o.editorErrorMessage="",o.validateError=!1))});const g=ie(()=>e.draggable);Qn(y,v,g),_t(async()=>{await be(),e.closeOnHashChange&&window.addEventListener("hashchange",b)}),It(()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",b)});function b(){T.value&&(T.value=!1,be(()=>{o.action&&t("action",o.action)}))}const S=()=>{e.closeOnClickModal&&x(o.distinguishCancelAndClose?"close":"cancel")},_=Dt(S),M=R=>{if(o.inputType!=="textarea")return R.preventDefault(),x("confirm")},x=R=>{var O;e.boxType==="prompt"&&R==="confirm"&&!I()||(o.action=R,o.beforeClose?(O=o.beforeClose)==null||O.call(o,R,o,b):b())},I=()=>{if(e.boxType==="prompt"){const R=o.inputPattern;if(R&&!R.test(o.inputValue||""))return o.editorErrorMessage=o.inputErrorMessage||m("el.messagebox.error"),o.validateError=!0,!1;const O=o.inputValidator;if(typeof O=="function"){const P=O(o.inputValue);if(P===!1)return o.editorErrorMessage=o.inputErrorMessage||m("el.messagebox.error"),o.validateError=!0,!1;if(typeof P=="string")return o.editorErrorMessage=P,o.validateError=!0,!1}}return o.editorErrorMessage="",o.validateError=!1,!0},H=()=>{const R=s.value.$refs;return R.input||R.textarea},W=()=>{x("close")},V=()=>{e.closeOnPressEscape&&W()};return e.lockScroll&&Jn(T),{...xn(o),ns:i,overlayEvent:_,visible:T,hasMessage:B,typeClass:A,contentId:k,inputId:E,btnSize:a,iconComponent:p,confirmButtonClasses:c,rootRef:y,focusStartRef:w,headerRef:v,inputRef:s,confirmRef:h,doClose:b,handleClose:W,onCloseRequested:V,handleWrapperClick:S,handleInputEnter:M,handleAction:x,t:m}}}),ao=["aria-label","aria-describedby"],io=["aria-label"],lo=["id"];function co(e,t,r,n,i,a){const m=le("el-icon"),C=le("close"),T=le("el-input"),o=le("el-button"),A=le("el-focus-trap"),k=le("el-overlay");return q(),Q(_n,{name:"fade-in-linear",onAfterLeave:t[11]||(t[11]=E=>e.$emit("vanish")),persisted:""},{default:K(()=>[Ne(Z(k,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:K(()=>[G("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:L(`${e.ns.namespace.value}-overlay-message-box`),onClick:t[8]||(t[8]=(...E)=>e.overlayEvent.onClick&&e.overlayEvent.onClick(...E)),onMousedown:t[9]||(t[9]=(...E)=>e.overlayEvent.onMousedown&&e.overlayEvent.onMousedown(...E)),onMouseup:t[10]||(t[10]=(...E)=>e.overlayEvent.onMouseup&&e.overlayEvent.onMouseup(...E))},[Z(A,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:K(()=>[G("div",{ref:"rootRef",class:L([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),{[e.ns.m("center")]:e.center}]),style:pt(e.customStyle),tabindex:"-1",onClick:t[7]||(t[7]=Te(()=>{},["stop"]))},[e.title!==null&&e.title!==void 0?(q(),De("div",{key:0,ref:"headerRef",class:L(e.ns.e("header"))},[G("div",{class:L(e.ns.e("title"))},[e.iconComponent&&e.center?(q(),Q(m,{key:0,class:L([e.ns.e("status"),e.typeClass])},{default:K(()=>[(q(),Q(Ae(e.iconComponent)))]),_:1},8,["class"])):ce("v-if",!0),G("span",null,he(e.title),1)],2),e.showClose?(q(),De("button",{key:0,type:"button",class:L(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:t[0]||(t[0]=E=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel")),onKeydown:t[1]||(t[1]=ke(Te(E=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"]))},[Z(m,{class:L(e.ns.e("close"))},{default:K(()=>[Z(C)]),_:1},8,["class"])],42,io)):ce("v-if",!0)],2)):ce("v-if",!0),G("div",{id:e.contentId,class:L(e.ns.e("content"))},[G("div",{class:L(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?(q(),Q(m,{key:0,class:L([e.ns.e("status"),e.typeClass])},{default:K(()=>[(q(),Q(Ae(e.iconComponent)))]),_:1},8,["class"])):ce("v-if",!0),e.hasMessage?(q(),De("div",{key:1,class:L(e.ns.e("message"))},[Ke(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?(q(),Q(Ae(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):(q(),Q(Ae(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0},{default:K(()=>[ze(he(e.dangerouslyUseHTMLString?"":e.message),1)]),_:1},8,["for"]))])],2)):ce("v-if",!0)],2),Ne(G("div",{class:L(e.ns.e("input"))},[Z(T,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":t[2]||(t[2]=E=>e.inputValue=E),type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:L({invalid:e.validateError}),onKeydown:ke(e.handleInputEnter,["enter"])},null,8,["id","modelValue","type","placeholder","aria-invalid","class","onKeydown"]),G("div",{class:L(e.ns.e("errormsg")),style:pt({visibility:e.editorErrorMessage?"visible":"hidden"})},he(e.editorErrorMessage),7)],2),[[We,e.showInput]])],10,lo),G("div",{class:L(e.ns.e("btns"))},[e.showCancelButton?(q(),Q(o,{key:0,loading:e.cancelButtonLoading,class:L([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:t[3]||(t[3]=E=>e.handleAction("cancel")),onKeydown:t[4]||(t[4]=ke(Te(E=>e.handleAction("cancel"),["prevent"]),["enter"]))},{default:K(()=>[ze(he(e.cancelButtonText||e.t("el.messagebox.cancel")),1)]),_:1},8,["loading","class","round","size"])):ce("v-if",!0),Ne(Z(o,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,class:L([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:t[5]||(t[5]=E=>e.handleAction("confirm")),onKeydown:t[6]||(t[6]=ke(Te(E=>e.handleAction("confirm"),["prevent"]),["enter"]))},{default:K(()=>[ze(he(e.confirmButtonText||e.t("el.messagebox.confirm")),1)]),_:1},8,["loading","class","round","disabled","size"]),[[We,e.showConfirmButton]])],2)],6)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,ao)]),_:3},8,["z-index","overlay-class","mask"]),[[We,e.visible]])]),_:3})}var uo=Tn(so,[["render",co],["__file","/home/runner/work/element-plus/element-plus/packages/components/message-box/src/index.vue"]]);const Ee=new Map,fo=e=>{let t=document.body;return e.appendTo&&($t(e.appendTo)&&(t=document.querySelector(e.appendTo)),wt(e.appendTo)&&(t=e.appendTo),wt(t)||(t=document.body)),t},vo=(e,t,r=null)=>{const n=Z(uo,e,yt(e.message)||Ot(e.message)?{default:yt(e.message)?e.message:()=>e.message}:null);return n.appContext=r,Nt(n,t),fo(e).appendChild(t.firstElementChild),n.component},ho=()=>document.createElement("div"),mo=(e,t)=>{const r=ho();e.onVanish=()=>{Nt(null,r),Ee.delete(i)},e.onAction=a=>{const m=Ee.get(i);let C;e.showInput?C={value:i.inputValue,action:a}:C=a,e.callback?e.callback(C,n.proxy):a==="cancel"||a==="close"?e.distinguishCancelAndClose&&a!=="cancel"?m.reject("close"):m.reject("cancel"):m.resolve(C)};const n=vo(e,r,t),i=n.proxy;for(const a in e)gt(e,a)&&!gt(i.$props,a)&&(i[a]=e[a]);return i.visible=!0,i};function ue(e,t=null){if(!Ht)return Promise.reject();let r;return $t(e)||Ot(e)?e={message:e}:r=e.callback,new Promise((n,i)=>{const a=mo(e,t??ue._context);Ee.set(a,{options:e,callback:r,resolve:n,reject:i})})}const po=["alert","confirm","prompt"],go={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};po.forEach(e=>{ue[e]=yo(e)});function yo(e){return(t,r,n,i)=>{let a="";return In(r)?(n=r,a=""):Rn(r)?a="":a=r,ue(Object.assign({title:a,message:t,type:"",...go[e]},n,{boxType:e}),i)}}ue.close=()=>{Ee.forEach((e,t)=>{t.doClose()}),Ee.clear()};ue._context=null;const J=ue;J.install=e=>{J._context=e._context,e.config.globalProperties.$msgbox=J,e.config.globalProperties.$messageBox=J,e.config.globalProperties.$alert=J.alert,e.config.globalProperties.$confirm=J.confirm,e.config.globalProperties.$prompt=J.prompt};const Pe=J;var wo=Hn,bo=Ln,Co=$n,Eo={formats:Co,parse:bo,stringify:wo};const zt=tt(Eo);async function ne(e=0){return await new Promise((t,r)=>{setTimeout(()=>{try{window.scrollTo(0,document.body.scrollHeight),t(null)}catch(n){r(n)}},+e||0)})}const So={get isMobileScreen(){return window.innerWidth<600},get isTouchScreen(){return"ontouchstart"in document||navigator.maxTouchPoints>0}};function Bt(){return So}const Tt="web-browsing",At="temperature-suffix",Ue="temperature",Wt="01",Pt="0123456789",Ut="0123456789abcdef",Vt="0123456789abcdefghijklmnopqrstuvwxyz",qt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",Qe=e=>{switch(typeof e!="string"&&(e=Yn(e)),e){case"2":return Wt;case"10":return Pt;case"16":return Ut;case"36":return Vt;case"62":return qt;case"64":return ae;case"64w":case"64+":return jt;default:return e}},Bo=(e,t,r,n=0)=>{typeof e!="string"&&(e=nt(e));let i=BigInt(0);t=Qe(t);const a=t.length;for(let C=0;C<e.length;C++)i+=BigInt(t.indexOf(e[C])*Math.pow(a,e.length-1-C));let m="";if(r=Qe(r),m===""){const C=BigInt(r.length);for(;i>0;)m=r.charAt(+BigInt(i%C).toString())+m,i=BigInt(i/C)}return(m===""?r.charAt(0):m).padStart(n,r[0])},To=e=>{const t=e.split("").map(a=>a.charCodeAt(0)),r=[];let n=0;for(;n<t.length;){const[a,m=0,C=0]=t.slice(n,n+=3),T=(a<<16)+(m<<8)+C,o=T>>18,A=T>>12&63,k=T>>6&63,E=T&63;r.push(ae[o],ae[A],ae[k],ae[E])}const i=t.length%3;return r.join("").slice(0,1+r.length-i)+(i===2?"==":i===1?"=":"")},Ao=/[^A-Za-z0-9+/]/g,Yt=e=>e.replace(Ao,""),Ve=e=>String.fromCharCode(+e),ko=e=>{const t=Yt(e).split(""),r=[];let n=0;for(;n<t.length;){const[i,a,m,C]=t.slice(n,n+=4).map(T=>ae.indexOf(T));r.push(Ve(i<<2|a>>4)),m!==64&&r.push(Ve((a&15)<<4|m>>2)),C!==64&&r.push(Ve((m&3)<<6|C))}return r.join("").replaceAll("\0","")},fe={BASE2_CHARSET:Wt,BASE10_CHARSET:Pt,BASE16_CHARSET:Ut,BASE36_CHARSET:Vt,BASE62_CHARSET:qt,BASE64_CHARSET:ae,BASE64WEB_CHARSET:jt,convert:Bo,getCharset:Qe,secureBase64:Yt,textToBase64:To,base64ToText:ko};var Xt={exports:{}};function Mo(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qe={exports:{}},kt;function ot(){return kt||(kt=1,function(e,t){(function(r,n){e.exports=n()})(re,function(){var r=r||function(n,i){var a;if(typeof window<"u"&&window.crypto&&(a=window.crypto),typeof self<"u"&&self.crypto&&(a=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(a=globalThis.crypto),!a&&typeof window<"u"&&window.msCrypto&&(a=window.msCrypto),!a&&typeof re<"u"&&re.crypto&&(a=re.crypto),!a&&typeof Mo=="function")try{a=On}catch{}var m=function(){if(a){if(typeof a.getRandomValues=="function")try{return a.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof a.randomBytes=="function")try{return a.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},C=Object.create||function(){function s(){}return function(h){var c;return s.prototype=h,c=new s,s.prototype=null,c}}(),T={},o=T.lib={},A=o.Base=function(){return{extend:function(s){var h=C(this);return s&&h.mixIn(s),(!h.hasOwnProperty("init")||this.init===h.init)&&(h.init=function(){h.$super.init.apply(this,arguments)}),h.init.prototype=h,h.$super=this,h},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var h in s)s.hasOwnProperty(h)&&(this[h]=s[h]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),k=o.WordArray=A.extend({init:function(s,h){s=this.words=s||[],h!=i?this.sigBytes=h:this.sigBytes=s.length*4},toString:function(s){return(s||p).stringify(this)},concat:function(s){var h=this.words,c=s.words,g=this.sigBytes,b=s.sigBytes;if(this.clamp(),g%4)for(var S=0;S<b;S++){var _=c[S>>>2]>>>24-S%4*8&255;h[g+S>>>2]|=_<<24-(g+S)%4*8}else for(var M=0;M<b;M+=4)h[g+M>>>2]=c[M>>>2];return this.sigBytes+=b,this},clamp:function(){var s=this.words,h=this.sigBytes;s[h>>>2]&=4294967295<<32-h%4*8,s.length=n.ceil(h/4)},clone:function(){var s=A.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var h=[],c=0;c<s;c+=4)h.push(m());return new k.init(h,s)}}),E=T.enc={},p=E.Hex={stringify:function(s){for(var h=s.words,c=s.sigBytes,g=[],b=0;b<c;b++){var S=h[b>>>2]>>>24-b%4*8&255;g.push((S>>>4).toString(16)),g.push((S&15).toString(16))}return g.join("")},parse:function(s){for(var h=s.length,c=[],g=0;g<h;g+=2)c[g>>>3]|=parseInt(s.substr(g,2),16)<<24-g%8*4;return new k.init(c,h/2)}},B=E.Latin1={stringify:function(s){for(var h=s.words,c=s.sigBytes,g=[],b=0;b<c;b++){var S=h[b>>>2]>>>24-b%4*8&255;g.push(String.fromCharCode(S))}return g.join("")},parse:function(s){for(var h=s.length,c=[],g=0;g<h;g++)c[g>>>2]|=(s.charCodeAt(g)&255)<<24-g%4*8;return new k.init(c,h)}},y=E.Utf8={stringify:function(s){try{return decodeURIComponent(escape(B.stringify(s)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(s){return B.parse(unescape(encodeURIComponent(s)))}},v=o.BufferedBlockAlgorithm=A.extend({reset:function(){this._data=new k.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=y.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var h,c=this._data,g=c.words,b=c.sigBytes,S=this.blockSize,_=S*4,M=b/_;s?M=n.ceil(M):M=n.max((M|0)-this._minBufferSize,0);var x=M*S,I=n.min(x*4,b);if(x){for(var H=0;H<x;H+=S)this._doProcessBlock(g,H);h=g.splice(0,x),c.sigBytes-=I}return new k.init(h,I)},clone:function(){var s=A.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0});o.Hasher=v.extend({cfg:A.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){s&&this._append(s);var h=this._doFinalize();return h},blockSize:16,_createHelper:function(s){return function(h,c){return new s.init(c).finalize(h)}},_createHmacHelper:function(s){return function(h,c){return new w.HMAC.init(s,c).finalize(h)}}});var w=T.algo={};return T}(Math);return r})}(qe)),qe.exports}var je={exports:{}},Mt;function xo(){return Mt||(Mt=1,function(e,t){(function(r,n){e.exports=n(ot())})(re,function(r){return function(n){var i=r,a=i.lib,m=a.Base,C=a.WordArray,T=i.x64={};T.Word=m.extend({init:function(o,A){this.high=o,this.low=A}}),T.WordArray=m.extend({init:function(o,A){o=this.words=o||[],A!=n?this.sigBytes=A:this.sigBytes=o.length*8},toX32:function(){for(var o=this.words,A=o.length,k=[],E=0;E<A;E++){var p=o[E];k.push(p.high),k.push(p.low)}return C.create(k,this.sigBytes)},clone:function(){for(var o=m.clone.call(this),A=o.words=this.words.slice(0),k=A.length,E=0;E<k;E++)A[E]=A[E].clone();return o}})}(),r})}(je)),je.exports}(function(e,t){(function(r,n,i){e.exports=n(ot(),xo())})(re,function(r){return function(n){var i=r,a=i.lib,m=a.WordArray,C=a.Hasher,T=i.x64,o=T.Word,A=i.algo,k=[],E=[],p=[];(function(){for(var v=1,w=0,s=0;s<24;s++){k[v+5*w]=(s+1)*(s+2)/2%64;var h=w%5,c=(2*v+3*w)%5;v=h,w=c}for(var v=0;v<5;v++)for(var w=0;w<5;w++)E[v+5*w]=w+(2*v+3*w)%5*5;for(var g=1,b=0;b<24;b++){for(var S=0,_=0,M=0;M<7;M++){if(g&1){var x=(1<<M)-1;x<32?_^=1<<x:S^=1<<x-32}g&128?g=g<<1^113:g<<=1}p[b]=o.create(S,_)}})();var B=[];(function(){for(var v=0;v<25;v++)B[v]=o.create()})();var y=A.SHA3=C.extend({cfg:C.cfg.extend({outputLength:512}),_doReset:function(){for(var v=this._state=[],w=0;w<25;w++)v[w]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(v,w){for(var s=this._state,h=this.blockSize/2,c=0;c<h;c++){var g=v[w+2*c],b=v[w+2*c+1];g=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,b=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360;var S=s[c];S.high^=b,S.low^=g}for(var _=0;_<24;_++){for(var M=0;M<5;M++){for(var x=0,I=0,H=0;H<5;H++){var S=s[M+5*H];x^=S.high,I^=S.low}var W=B[M];W.high=x,W.low=I}for(var M=0;M<5;M++)for(var V=B[(M+4)%5],R=B[(M+1)%5],O=R.high,P=R.low,x=V.high^(O<<1|P>>>31),I=V.low^(P<<1|O>>>31),H=0;H<5;H++){var S=s[M+5*H];S.high^=x,S.low^=I}for(var N=1;N<25;N++){var x,I,S=s[N],Y=S.high,X=S.low,l=k[N];l<32?(x=Y<<l|X>>>32-l,I=X<<l|Y>>>32-l):(x=X<<l-32|Y>>>64-l,I=Y<<l-32|X>>>64-l);var u=B[E[N]];u.high=x,u.low=I}var f=B[0],d=s[0];f.high=d.high,f.low=d.low;for(var M=0;M<5;M++)for(var H=0;H<5;H++){var N=M+5*H,S=s[N],it=B[N],lt=B[(M+1)%5+5*H],ct=B[(M+2)%5+5*H];S.high=it.high^~lt.high&ct.high,S.low=it.low^~lt.low&ct.low}var S=s[0],ut=p[_];S.high^=ut.high,S.low^=ut.low}},_doFinalize:function(){var v=this._data,w=v.words;this._nDataBytes*8;var s=v.sigBytes*8,h=this.blockSize*32;w[s>>>5]|=1<<24-s%32,w[(n.ceil((s+1)/h)*h>>>5)-1]|=128,v.sigBytes=w.length*4,this._process();for(var c=this._state,g=this.cfg.outputLength/8,b=g/8,S=[],_=0;_<b;_++){var M=c[_],x=M.high,I=M.low;x=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,I=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,S.push(I),S.push(x)}return new m.init(S,g)},clone:function(){for(var v=C.clone.call(this),w=v._state=this._state.slice(0),s=0;s<25;s++)w[s]=w[s].clone();return v}});i.SHA3=C._createHelper(y),i.HmacSHA3=C._createHmacHelper(y)}(Math),r.SHA3})})(Xt);var _o=Xt.exports;const Kt=tt(_o);function Io(...e){return e.reduce((t,r)=>t+r,0)}function Ro(e){try{return typeof e[Symbol==null?void 0:Symbol.iterator]=="function"}catch{return!1}}function Gt(e){const t=new Set;return JSON.stringify(e,(n,i)=>{if(typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i),Ro(i)&&(i=[...i])}return i})}const Ho=e=>Kt(e,{outputLength:256}).toString(),Lo=/0b[0-1]+/i;function Se(e){if(typeof e=="number")return Math.round(e);if(e instanceof Object&&(e=Gt(e)),typeof e=="string"){if(Lo.test(e))return parseInt(e.substring(2,e.length-1),2);const t=parseInt(e);return Number.isNaN(t)?t:Io(parseInt(Ho(e),16))}else return Date.now()}const $=624,xe=397,$o=2567483615,Ye=2147483648,Xe=2147483647;class Oo{constructor(t){Be(this,"mt",new Array($));Be(this,"mti",$+1);Be(this,"seed");return this.seed=t=Se(t),Array.isArray(t)?this.init_by_array(t,t.length):this.init_seed(t),this}init_seed(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<$;this.mti++)t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(((t&4294901760)>>>16)*1812433253<<16)+(t&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}init_by_array(t,r){let n,i,a;for(this.init_seed(19650218),n=1,i=0,a=$>r?$:r;a!==0;a--){const m=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((m&4294901760)>>>16)*1664525<<16)+(m&65535)*1664525)+t[i]+i,this.mt[n]>>>=0,n++,i++,n>=$&&(this.mt[0]=this.mt[$-1],n=1),i>=r&&(i=0)}for(a=$-1;a!==0;a--){const m=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((m&4294901760)>>>16)*1566083941<<16)+(m&65535)*1566083941)-n,this.mt[n]>>>=0,n++,n>=$&&(this.mt[0]=this.mt[$-1],n=1)}this.mt[0]=2147483648}random_int(){let t;const r=new Array(0,$o);if(this.mti>=$){let n;for(this.mti===$+1&&this.init_seed(5489),n=0;n<$-xe;n++)t=this.mt[n]&Ye|this.mt[n+1]&Xe,this.mt[n]=this.mt[n+xe]^t>>>1^r[t&1];for(;n<$-1;n++)t=this.mt[n]&Ye|this.mt[n+1]&Xe,this.mt[n]=this.mt[n+(xe-$)]^t>>>1^r[t&1];t=this.mt[$-1]&Ye|this.mt[0]&Xe,this.mt[$-1]=this.mt[xe-1]^t>>>1^r[t&1],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0}random_int31(){return this.random_int()>>>1}random_incl(){return this.random_int()*(1/4294967295)}random(){return this.random_int()*(1/4294967296)}random_excl(){return(this.random_int()+.5)*(1/4294967296)}random_long(){return((this.random_int()>>>5)*67108864+(this.random_int()>>>6))*(1/9007199254740992)}}function Ft(e){return new Oo(e)}const{BASE10_CHARSET:No,BASE16_CHARSET:Do,BASE64WEB_CHARSET:zo}=fe,Wo=Ft(),Qt=(e=Wo)=>e.random(),rt=(e,t,r)=>((t===void 0||t===0)&&(t=e,e=0),Math.floor(e+Qt(r)*t)),Jt=(e,t)=>e[rt(0,e.length,t)],Zt=(e,t=1,r)=>{const n=[],i=[];for(let a=0;a<t;a++)i.length===0&&i.push(...e),n.push(i.splice(rt(0,i.length,r),1)[0]);return n},Po=(e,t)=>Zt(e,e.length,t),_e=(e,t=8,r)=>new Array(t).fill(0).map(n=>Jt(e,r)).join(""),en={MT:Ft,toSeed:Se,rand:Qt,randInt:rt,charset:_e,choice:Jt,choices:Zt,shuffle:Po,base10:(e=6,t)=>_e(No,e,t),base16:(e=32,t)=>_e(Do,e,t),base64:(e=32,t)=>_e(zo,e,t),lcg(e){let t=Se(e);return()=>(t=(t*1664525+1013904223)%4294967296)/4294967296}};var tn={exports:{}};(function(e,t){(function(r,n){e.exports=n(ot())})(re,function(r){return function(n){var i=r,a=i.lib,m=a.WordArray,C=a.Hasher,T=i.algo,o=[];(function(){for(var y=0;y<64;y++)o[y]=n.abs(n.sin(y+1))*4294967296|0})();var A=T.MD5=C.extend({_doReset:function(){this._hash=new m.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(y,v){for(var w=0;w<16;w++){var s=v+w,h=y[s];y[s]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360}var c=this._hash.words,g=y[v+0],b=y[v+1],S=y[v+2],_=y[v+3],M=y[v+4],x=y[v+5],I=y[v+6],H=y[v+7],W=y[v+8],V=y[v+9],R=y[v+10],O=y[v+11],P=y[v+12],N=y[v+13],Y=y[v+14],X=y[v+15],l=c[0],u=c[1],f=c[2],d=c[3];l=k(l,u,f,d,g,7,o[0]),d=k(d,l,u,f,b,12,o[1]),f=k(f,d,l,u,S,17,o[2]),u=k(u,f,d,l,_,22,o[3]),l=k(l,u,f,d,M,7,o[4]),d=k(d,l,u,f,x,12,o[5]),f=k(f,d,l,u,I,17,o[6]),u=k(u,f,d,l,H,22,o[7]),l=k(l,u,f,d,W,7,o[8]),d=k(d,l,u,f,V,12,o[9]),f=k(f,d,l,u,R,17,o[10]),u=k(u,f,d,l,O,22,o[11]),l=k(l,u,f,d,P,7,o[12]),d=k(d,l,u,f,N,12,o[13]),f=k(f,d,l,u,Y,17,o[14]),u=k(u,f,d,l,X,22,o[15]),l=E(l,u,f,d,b,5,o[16]),d=E(d,l,u,f,I,9,o[17]),f=E(f,d,l,u,O,14,o[18]),u=E(u,f,d,l,g,20,o[19]),l=E(l,u,f,d,x,5,o[20]),d=E(d,l,u,f,R,9,o[21]),f=E(f,d,l,u,X,14,o[22]),u=E(u,f,d,l,M,20,o[23]),l=E(l,u,f,d,V,5,o[24]),d=E(d,l,u,f,Y,9,o[25]),f=E(f,d,l,u,_,14,o[26]),u=E(u,f,d,l,W,20,o[27]),l=E(l,u,f,d,N,5,o[28]),d=E(d,l,u,f,S,9,o[29]),f=E(f,d,l,u,H,14,o[30]),u=E(u,f,d,l,P,20,o[31]),l=p(l,u,f,d,x,4,o[32]),d=p(d,l,u,f,W,11,o[33]),f=p(f,d,l,u,O,16,o[34]),u=p(u,f,d,l,Y,23,o[35]),l=p(l,u,f,d,b,4,o[36]),d=p(d,l,u,f,M,11,o[37]),f=p(f,d,l,u,H,16,o[38]),u=p(u,f,d,l,R,23,o[39]),l=p(l,u,f,d,N,4,o[40]),d=p(d,l,u,f,g,11,o[41]),f=p(f,d,l,u,_,16,o[42]),u=p(u,f,d,l,I,23,o[43]),l=p(l,u,f,d,V,4,o[44]),d=p(d,l,u,f,P,11,o[45]),f=p(f,d,l,u,X,16,o[46]),u=p(u,f,d,l,S,23,o[47]),l=B(l,u,f,d,g,6,o[48]),d=B(d,l,u,f,H,10,o[49]),f=B(f,d,l,u,Y,15,o[50]),u=B(u,f,d,l,x,21,o[51]),l=B(l,u,f,d,P,6,o[52]),d=B(d,l,u,f,_,10,o[53]),f=B(f,d,l,u,R,15,o[54]),u=B(u,f,d,l,b,21,o[55]),l=B(l,u,f,d,W,6,o[56]),d=B(d,l,u,f,X,10,o[57]),f=B(f,d,l,u,I,15,o[58]),u=B(u,f,d,l,N,21,o[59]),l=B(l,u,f,d,M,6,o[60]),d=B(d,l,u,f,O,10,o[61]),f=B(f,d,l,u,S,15,o[62]),u=B(u,f,d,l,V,21,o[63]),c[0]=c[0]+l|0,c[1]=c[1]+u|0,c[2]=c[2]+f|0,c[3]=c[3]+d|0},_doFinalize:function(){var y=this._data,v=y.words,w=this._nDataBytes*8,s=y.sigBytes*8;v[s>>>5]|=128<<24-s%32;var h=n.floor(w/4294967296),c=w;v[(s+64>>>9<<4)+15]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360,v[(s+64>>>9<<4)+14]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360,y.sigBytes=(v.length+1)*4,this._process();for(var g=this._hash,b=g.words,S=0;S<4;S++){var _=b[S];b[S]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360}return g},clone:function(){var y=C.clone.call(this);return y._hash=this._hash.clone(),y}});function k(y,v,w,s,h,c,g){var b=y+(v&w|~v&s)+h+g;return(b<<c|b>>>32-c)+v}function E(y,v,w,s,h,c,g){var b=y+(v&s|w&~s)+h+g;return(b<<c|b>>>32-c)+v}function p(y,v,w,s,h,c,g){var b=y+(v^w^s)+h+g;return(b<<c|b>>>32-c)+v}function B(y,v,w,s,h,c,g){var b=y+(w^(v|~s))+h+g;return(b<<c|b>>>32-c)+v}i.MD5=C._createHelper(A),i.HmacMD5=C._createHmacHelper(A)}(Math),r.MD5})})(tn);var Uo=tn.exports;const Vo=tt(Uo),{MT:$e,shuffle:qo,randInt:Re}=en,{convert:nn,getCharset:on}=fe,rn=(e,t)=>{const r=qo(e,t);return()=>(r.push(r.shift()),r)},sn=(e,t=16,r=1,n)=>{const i=Number.isNaN(+t)?64:+t,a=on(t),m=Se(n!==void 0?n:Re(0,i)),C=$e(m),T=rn(a,$e(Re(0,1e6,C))),o=typeof e=="string"?e.split(""):e,A=[n!==void 0?a[Re(0,i)]:nn(m,10,t),...o.map(k=>T()[a.indexOf(k)])];return--r<1?A.join(""):sn(A,t,r,n)},an=(e,t=16,r=1,n)=>{const i=on(t),a=Se(n!==void 0?n:+nn(e[0],t,10)),m=$e(a),C=rn(i,$e(Re(0,1e6,m))),o=(typeof e=="string"?e.split(""):e).slice(1,e.length).map(A=>i[C().indexOf(A)]);return--r<1?o.join(""):an(o,t,r,n)},{textToBase64:jo,base64ToText:Yo,secureBase64:Xo}=fe;function ln(e,t=1,r){return typeof e=="object"?e=Gt(e):typeof e!="string"&&(e=nt(e)),sn(Xo(jo(e)),64,t,r)}function Ko(e,t=1,r,n=!0){if(e=Yo(an(e,64,t,r)),!n)return e;try{return JSON.parse(e)}catch{return e}}function Go(e,t=512,r){const n=ln(e,1,r).substring(1);return t==="MD5"?Vo(n).toString():Kt(n,{outputLength:t}).toString()}const Fo={e:ln,d:Ko,h:Go},Qo=new Map([["THINKING","Please wait, I am answering another question..."]]);function Jo(e,t){switch(e){case"model":if(["gpt3","gpt4","gpt-web","claude-2-web","gpt3-fga"].includes(t))return!0;break;case"temperature":if(typeof t=="number"&&t>=0&&t<=1)return!0;break;case"context":if(typeof t=="boolean")return!0;break}return!1}function Zo(e){try{return JSON.parse(e)}catch{return e}}function cn(e){try{const t={};for(const r in e){const n=Zo(e[r]);Jo(r,n)&&(t[r]=n)}return t}catch{return{}}}function er(e){try{return cn(zt.parse(e))}catch{return{}}}function tr(e){try{return zt.stringify(cn(e))}catch{return""}}const me=()=>{try{document.querySelector(".InputBox textarea").focus()}catch{}},pe=()=>new Promise((e,t)=>{$fetch("/api/curva/check",{method:"POST"}).then(r=>{const{list:n,saved:i}=r;te.value=n.sort().map(a=>{var m,C,T;return{id:a,name:(m=i[a])==null?void 0:m.name,config:((C=i[a])==null?void 0:C.config)||"",mtime:((T=i[a])==null?void 0:T.mtime)||0}}).sort((a,m)=>a.mtime-m.mtime).reverse(),e(!0)}).catch(r=>{j.error("Initialization Failed"),t(r)})}),nr=e=>new Promise(async(t,r)=>{if(e==null)return t([]);const n=await $fetch("/api/curva/history",{method:"POST",body:{id:e}});(!n||n.length===0)&&Le("/c/");try{t(n.map(i=>et({...i,t:new Date(i.t),done:!!i.A})))}catch{Le("/c/"),t([])}}),un=async function(e){return[]},or=async()=>{try{const e=D.value.at(-1),t=await un(e.Q),r=Ge()>=document.body.clientHeight;e.more=t,r&&ne()}catch(e){console.error(e)}};let st;const de=z("gpt4"),ve=z(!0),F=z(.5),D=z([]),te=z([]),at=()=>{de.value="gpt4",ve.value=!0,F.value=.5};at();const oe=z(!1),ge=z(oe.value),ye=z(oe.value),we=z(""),rr=(()=>{const{h:e}=Fo,t=()=>[77,68,53].map(i=>String.fromCharCode(i)).join(""),r=(i,a)=>({hash:e(i,t(),a),timestamp:nt(a)}),n=(i,a,m,C,T,o)=>{let A=U();return A||(A=en.base64(8),te.value.push({id:A,name:void 0}),Le(`/c/${A}?feature=new`)),{conv:A,messages:i,model:a,temperature:m,t:C,tz:T,id:o}};return i=>{var k;const a=new Date,m=a.getTime(),C=a.getTimezoneOffset()/60*-1;let T=ve.value?D.value.map(E=>{const{Q:p,A:B}=E;return p?B?[{role:"user",content:p},{role:"assistant",content:B}]:[{role:"user",content:p}]:B?[{role:"assistant",content:B}]:[]}).flat():[{role:"user",content:((k=D.value.at(-1))==null?void 0:k.Q)||""}];T=T.slice(T.length-100);const o=n(T,de.value,F.value,m,C,i),A=r(T,m);return $fetch("/api/curva/answer",{method:"POST",headers:A,body:o})}})(),sr=(e="",t="",r=!1)=>et({done:r,Q:e,A:t,queries:[],urls:[],dt:void 0,t:new Date}),He=new Set,ar=()=>{te.value=[],D.value=[],Le("/c/"),Je=!0};let Je=!0;function xt(){{const e=Wn();e.get("feature")==="new"&&(e.delete("feature"),e.save())}}const fn=(e,t)=>{const r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),r.remove()},U=()=>{var e,t;return(t=(e=st._route)==null?void 0:e.params)==null?void 0:t.conv},Ce=()=>{var t;const e=U();return((t=te.value.filter(r=>r.id===e)[0])==null?void 0:t.name)||""};async function dn(e,t){return await $fetch("/api/curva/conv",{method:"PUT",body:{id:e||U(),name:t||Ce(),config:tr({model:de.value,temperature:F.value,context:ve.value})}})}let Ze=!1;const ir=e=>{var n;if(e===void 0&&(e=U()),e==null)return;const t=er(((n=te.value.filter(i=>i.id===e)[0])==null?void 0:n.config)||""),r=Object.keys(t);if(r.length===0)at();else{Ze=!0;try{for(const i of r){const a=t[i];switch(i){case"model":de.value=a;break;case"temperature":F.value=a;break;case"context":ve.value=a;break}}}finally{Ze=!1}}j.info("Conversation settings have been loaded.")};setTimeout(()=>{let e;[de,ve,F].forEach(t=>{ee(t,(r,n)=>{st&&!Ze&&r!==n&&He.size===0&&(clearTimeout(e),e=setTimeout(async()=>{try{await dn(),j.info("Conversation settings have been saved.")}catch(i){console.error(i),j.warning("Failed to save conversation settings.")}finally{clearTimeout(e)}},typeof t.value=="number"?500:0))})})},1e3);const lr=e=>{D.value=D.value.filter(t=>t.id!==e),$fetch("/api/curva/answer",{method:"DELETE",body:{conv:U(),id:e}}).then(()=>j.info("The message has been deleted.")).catch(()=>j.error("An error occurred while deleting the message."))},cr=()=>{let e=0;const t=`${fe.convert(U(),"64w",10)}.md`,r=D.value.map(n=>{e++;try{return(n.t?`${new Date(n.t.getTime()-(n.dt||0)).toLocaleString()}${n.dt===void 0?"":" (Î”t: "+n.dt.toString()+"ms)"}

`:"")+(n.Q?`QUESTION ${e}:

${n.Q.replaceAll(`
`,`

`)}`:"")+(n.Q&&n.A?`

`:"")+(n.A?`ANSWER ${e}:

${n.A}`:"")}catch{return"(Unknown message)"}}).join(`

---

`)+`

---

`;fn(t,r)},ur=()=>{fn(`${fe.convert(U(),"64w",10)}.json`,JSON.stringify(D.value.map(e=>({question:e.Q,answer:e.A,created:new Date(e.t.getTime()).toUTCString(),timeUsed:e.dt||void 0,queries:e.queries||void 0,urls:e.urls||void 0})),null,4))};function yr(){const e=bt("appName").value,t=Nn(),r=+(t.has(Ue)?t.get(Ue):.5);t.delete(Tt,{path:"/"}),t.delete(Tt),t.delete(At,{path:"/"}),t.delete(At),r>=0&&r<=1&&(F.value=r),ee(F,p=>{F.value=Math.round(p*10)/10,t.set(Ue,`${p}`,{path:"/"})}),st=zn(),ee(oe,p=>{Bt().isMobileScreen?(ge.value=!1,ye.value!==p&&(ye.value=p)):(ye.value=!1,ge.value!==p&&(ge.value=p)),setTimeout(()=>{try{me()}catch{}},0)}),ee(ye,p=>{oe.value=p}),ee(ge,p=>{oe.value=p});const n=async p=>{Bt().isMobileScreen&&(oe.value=!1),D.value=[];const B=Ct.service();try{const y=await Promise.all([p===null&&te.value.length>0?null:pe(),p===null?null:nr(p)]);ir(p);const v=y[1];v!==null&&U()===p&&(D.value=v,or())}finally{try{Me(`${Ce()||"Chat"} - ${e}`)}catch{Me(`Chat - ${e}`)}if(ne(),B!==null)try{await ne(500)}finally{B.close();try{await ne(500)}finally{}}}setTimeout(()=>me(),500)},i=async(p,B=!1)=>{const y=Promise.all([...He]),v=Je&&B?new Promise(async w=>{await n(p),xt(),w(null)}):B?new Promise(w=>w(null)):n(p);Je=!1,He.add(v);try{await y}catch{}try{await v}finally{He.delete(v)}},a=Dn().t,m=bt("version");let C=!0;const T=(p,B)=>{if(document.querySelectorAll(".Message.T").length>0)return j.info("Thinking too many questions."),!1;const v=p===void 0?we.value:p,w=v.trim();if(v===we.value&&(we.value="",w===""))return!1;const s=sr(w,"",!1);D.value.push(s),ne(),setTimeout(()=>{me()},500);const h=un();return rr(B).then(c=>{xt(),C&&(C=!1,pe());const g=Ge()>=document.body.clientHeight,b=c.id,S=c.answer,_=c.error,M=c.urls,x=c.queries,I=c.dt,H=c.version;if(b&&(s.id=b),!S){if(_){const W=D.value.indexOf(s);switch(_){case"THINKING":D.value.splice(W,1),j.warning(Qo.get(_)),we.value=w;return;default:throw _}}throw a("error.plzRefresh")}s.A=S,s.urls=M||[],s.queries=x||[],s.dt=I||void 0,H!==m.value&&Pe.confirm(a("action.newVersion"),a("message.notice"),{confirmButtonText:a("message.ok"),cancelButtonText:a("message.cancel"),type:"warning"}).then(()=>{location.reload()}).finally(()=>{me()}),g&&ne(),h.then(W=>{const V=Ge()>=document.body.clientHeight;s.more=W,V&&ne()}).catch(()=>{})}).catch(c=>{j.error(c||"Oops! Something went wrong!"),s.A="Oops! Something went wrong!"}).finally(()=>{s.done=!0,s.t=new Date}),!0};return{model:de,conversations:te,messages:D,temperature:F,contextMode:ve,openMenu:oe,openSidebar:ge,openDrawer:ye,inputValue:we,getCurrentConvId:U,getCurrentConvName:Ce,checkTokenAndGetConversations:pe,loadChat:i,sendMessage:T,deleteMessage:lr,regenerateMessage:async()=>{const p=D.value.pop();p!==void 0&&(T(p.Q,p.id)||D.value.push(p))},focusInput:me,refreshConversation:()=>{i(U())},renameConversation:(p,B="")=>{p||(p=U(),B=Ce()),Pe.prompt(a("message.renameConvHint"),a("message.setting"),{confirmButtonText:a("message.ok"),cancelButtonText:a("message.cancel"),inputValue:B,inputPlaceholder:fe.convert(p,"64w",10)}).then(async({value:y})=>{try{await dn(p,y),j({type:"success",message:a("message.renameSuccess")}),await pe();try{Me(`${Ce()||"Chat"} - ${e}`)}catch{Me(`Chat - ${e}`)}}catch{j({type:"error",message:"Oops! Something went wrong!"})}}).catch(()=>{})},deleteConversation:p=>{var s,h;const B=p||U(),y=[...te.value];let v=-1,w="createNewChat";for(let c=0;c<y.length;c++)if(y[c].id===B){v=c;break}if(v!==-1){const c=(s=y[v-1])==null?void 0:s.id,g=(h=y[v+1])==null?void 0:h.id;c!==void 0?w=c:g!==void 0&&(w=g)}Pe.confirm(a("message.deleteConvConfirm"),a("message.warning"),{confirmButtonText:a("message.ok"),cancelButtonText:a("message.cancel"),type:"warning"}).then(()=>{const c=Ct.service();$fetch("/api/curva/conv",{method:"DELETE",body:{id:B}}).finally(async()=>{var g;c.close(),p===U()?(g=document.getElementById(w))==null||g.click():await pe()})})},resetConvConfig:at,exportAsMarkdown:cr,exportAsJson:ur,clear:ar}}export{Pe as E,ne as a,Qn as b,Jn as c,ro as d,Dt as e,fe as f,Bt as g,en as r,yr as u};
