import{r as u,g as y,aD as f,E as o,s as w,v as p}from"./entry.c8d59687.js";import{u as v}from"./useChat.68d6b0b3.js";const l=u(""),a=u(!1),i=u(!1);function g(e){i.value=e}const L=async()=>{a.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"}),l.value="",g(!1),o.success("Logged out."),v().clear()}catch{o.error("Log out failed.")}finally{a.value=!1}};let d=0;const c=async(e=!1)=>{const t=Date.now();if(!e&&t-d<6e4)return i.value;a.value=!0;try{const{isLoggedIn:r,user:s}=await $fetch("/api/auth/check",{method:"POST"});return d=t,l.value=(s==null?void 0:s.username)||"",a.value=!1,setTimeout(()=>g(r),0),r}catch{a.value=!1}};(async()=>{try{await c()}catch(e){console.error(e)}finally{}})();const I=async e=>{try{const{error:t}=await $fetch("/api/auth/username",{method:"PUT",body:{username:e}});if(t)throw t;return await c(!0),o.success("The username has been changed."),!0}catch(t){return o.error(typeof t=="string"?t:"Oops! Something went wrong."),!1}};function O(){const e=y().t;return{authIsLoading:a,isLoggedIn:i,username:l,login:async(r,s)=>{const m=w.service({text:e("auth.loggingIn")});a.value=!0;try{const n=await $fetch("/api/auth/login",{method:"POST",body:{usernameOrEmail:r,password:s}}),{error:h}=n;if(h)throw h;p("/c/"),await c(!0),o.success("Logged in.")}catch(n){o.error(typeof n=="string"?n:"Oops! Something went wrong.")}finally{m.close(),a.value=!1}},logout:L,checkIsLoggedIn:c,setIsLoggedIn:g,changeUsername:I,goToHome(){f().$router.replace("/")},goToNewChat(){f().$router.replace("/c/")}}}export{O as u};
