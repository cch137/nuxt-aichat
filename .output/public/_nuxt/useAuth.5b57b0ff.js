import{r as u,L as d,j as c,E as s,aH as v,aI as L}from"./entry.29c0e4da.js";import{u as p}from"./useChat.7bc265f2.js";const e=u(!1),t=u(!1),y=async()=>{e.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"}),t.value=!1,s.success("Logged out."),p().clear()}catch{s.error("Log out failed.")}finally{e.value=!1}};let n=0;const g=async()=>{const a=Date.now();if(a-n<6e4)return t.value;e.value=!0;try{const r=(await $fetch("/api/auth/check",{method:"POST"})).isLoggedIn;return n=a,t.value=r,e.value=!1,r}catch{e.value=!1}};(async()=>{try{await g()}catch(a){console.error(a)}finally{}})();function w(){const a=d().t;return{isLoading:e,isLoggedIn:t,login:(l,i)=>{const h=v.service({text:a("auth.loggingIn")});e.value=!0,$fetch("/api/auth/login",{method:"POST",body:{usernameOrEmail:l,password:i}}).then(f=>{const o=f;o!=null&&o.error?s.error(o==null?void 0:o.error):(s.success("Logged in."),L("/c/"),t.value=!0)}).catch(()=>{s.error("Oops! Something went wrong.")}).finally(()=>{h.close(),e.value=!1})},logout:y,checkIsLoggedIn:g,setIsLoggedIn(l){t.value=l},goToHome(){c().$router.replace("/")},goToNewChat(){c().$router.replace("/c/")}}}export{w as u};
