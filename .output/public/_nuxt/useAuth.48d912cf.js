import{r as d,g as C,D as L,E as i,z as E,A as $}from"./entry.ac43ba46.js";import{u as j}from"./useChat.6d2b773f.js";const p=d(""),v=d(""),a=d(!1),w=d(!1),k=(()=>{const r=(e="")=>e.startsWith("Win")?"Win":e.startsWith("Linux")?"Linux":e.startsWith("Mac")?"Mac":e,t=e=>(e=!!e,e?!0:Object.keys(Object.getOwnPropertyDescriptors(navigator)).includes("webdriver")),c=(e="",n="")=>!e.includes(r(n)),s=(e,n=!1)=>{if(n)return!1;if(!e||e.length===0)return!0;const g=Object.values(Object.getOwnPropertyDescriptors(e)).map(o=>o.value);if(g.length===e.length)return!0;const h=g.map(o=>o.constructor===Plugin);return h.filter(o=>o).length!==h.length},m=(e="",n=[])=>!e||!n||n.length===0,u=(e="",n)=>e.includes("Chrome")?!n:!1,l=()=>"ontouchstart"in document||navigator.maxTouchPoints>0;return()=>{const{userAgent:e="",platform:n="",plugins:g=[],webdriver:h=!1,language:o="",languages:O=[]}=navigator,P=l(),b=t(h),I=s(g,P),W=m(o,O),S=c(e,n),x=u(e,window==null?void 0:window.chrome);return{wd:b,pg:I,lg:W,pf:S,ch:x}}})();function y(r){w.value=r}const A=async()=>{a.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"}),p.value="",v.value="",y(!1),i.success("Logged out."),j().clear()}catch{i.error("Log out failed.")}finally{a.value=!1}};let T=0;const f=async(r=!1)=>{const t=Date.now();if(!r&&t-T<6e4)return w.value;a.value=!0;try{const{isLoggedIn:c,user:s}=await $fetch("/api/auth/check",{method:"POST"});return T=t,p.value=(s==null?void 0:s.email)||"",v.value=(s==null?void 0:s.username)||"",a.value=!1,setTimeout(()=>y(c),0),c}catch{a.value=!1}};(async()=>{try{await f()}catch(r){console.error(r)}finally{}})();const D=async r=>{try{const{error:t}=await $fetch("/api/auth/username",{method:"PUT",body:{username:r}});if(t)throw t;return await f(!0),i.success("The username has been changed."),!0}catch(t){return i.error(typeof t=="string"?t:"Oops! Something went wrong."),!1}};function _(){const r=C().t;async function t(c,s){const m=E.service({text:r("auth.loggingIn")});a.value=!0;try{const u=await $fetch("/api/auth/login",{method:"POST",body:{usernameOrEmail:c,password:s}}),{error:l}=u;if(l)throw l;$("/c/"),await f(!0),i.success("Logged in.")}catch(u){i.error(typeof u=="string"?u:"Oops! Something went wrong.")}finally{m.close(),a.value=!1}}return{authIsLoading:a,isLoggedIn:w,email:p,username:v,login:t,logout:A,checkIsLoggedIn:f,setIsLoggedIn:y,changeUsername:D,mousetrap:k,goToHome(){L().$router.replace("/")},goToNewChat(){L().$router.replace("/c/")}}}export{_ as u};
