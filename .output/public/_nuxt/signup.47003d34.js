import{E as N}from"./el-input.8c6d3326.js";import{E as F,a as O}from"./el-form.95e2588a.js";import{f as U,g as W,r as k,m as $,i as P,o as c,j as x,w as l,b as n,a as f,t as d,n as j,k as e,c as C,q as h,d as y,E as p,s as I,v as M,x as D,y as H,z as G,aI as J,A as K,B as Q}from"./entry.c8d59687.js";import{E as X}from"./el-link.e17eded7.js";import{E as Y}from"./el-text.1313fb10.js";import{E as Z}from"./el-button.9cf1b9e4.js";import{_ as ee}from"./nuxt-link.a67a48ec.js";import{_ as te}from"./client-only.8bf95797.js";/* empty css                */import{E as ae}from"./el-overlay.d4b13c41.js";import{u as se}from"./useAuth.8dbf7a7e.js";import{u as oe}from"./useTitle.22e79668.js";import"./_Uint8Array.bd14c3e8.js";import"./_initCloneObject.dba67074.js";import"./focus-trap.145bbd45.js";import"./scroll.fc9c0e8e.js";import"./useChat.68d6b0b3.js";import"./str.d457f5f4.js";const re={class:"mt-0 mb-6"},le={key:0,class:"-mt-1 mb-2 w-full text-right"},ne={key:4,class:"flex-center flex-col gap-1 w-full"},ie={class:"flex justify-end gap-1 w-full"},ue=f("div",{class:"p-6"},null,-1),me={key:5,class:"flex-center"},pe={key:6,class:"flex-center"},ce=f("div",{class:"p-2"},null,-1),de={class:"flex-center flex-col gap-1"},fe={class:"flex-center flex-wrap gap-1",style:{"line-height":"1rem"}},ge={style:{"line-height":"1rem"},class:"mt-2 text-center"},_e=f("div",{class:"p-8"},null,-1),Ne=U({__name:"signup",setup(he){const z=se(),t=W().t,E=k(!1),i=k(0),w=k(),r=$({email:"",username:"",password:"",veriCode:""}),S=$({email:[{required:!0,message:t("auth.emailRequired"),trigger:"change"},{type:"email",message:t("auth.emailInvalid"),trigger:"change"}],username:[{required:!0,message:t("auth.usernameRequired"),trigger:"change"},{min:5,max:32,message:t("auth.usernameLength"),trigger:"change"}],password:[{required:!0,message:t("auth.passwdRequired"),trigger:"change"},{min:8,max:64,message:t("auth.passwdLength"),trigger:"change"}],veriCode:[{required:!0,message:t("auth.veriCodeRequired"),trigger:"change"},{min:6,max:6,message:t("auth.veriCodeRequired"),trigger:"change"}]}),q=()=>{ae.confirm(t("auth.confirmChangeEmail"),"",{confirmButtonText:t("message.ok"),cancelButtonText:t("message.cancel"),type:"warning"}).then(()=>{i.value=0,r.email="",r.veriCode="",p.success(t("action.opExecuted"))}).catch(()=>{p.info(t("action.opCanceled"))})},A=()=>{E.value=!0,V(w.value,!0)},V=async(a,s=!1)=>{await a.validate((g,_)=>{if(g||s){const v=I.service({text:t("auth.sendingVeriCode")});$fetch(s?"/api/auth/resendCode":"/api/auth/createVerification",{method:"POST",body:{email:r.email}}).then(u=>{const m=u;m!=null&&m.error?p.error(m==null?void 0:m.error):(p.success("Email sent, please check your inbox."),i.value=1)}).catch(()=>{p.error("Oops! Something went wrong.")}).finally(()=>{v.close()})}else p.error(t("auth.formIncomplete"))})},B=async a=>{await a.validate((s,g)=>{if(s){const _=I.service({text:t("action.submitting")+"..."});$fetch("/api/auth/signup",{method:"POST",body:{email:r.email,username:r.username,password:r.password,code:r.veriCode}}).then(async v=>{const u=v;u!=null&&u.error?p.error(u==null?void 0:u.error):(await z.checkIsLoggedIn(!0),p.success("Sign up successful."),M("/c/"))}).catch(()=>{p.error("Oops! Something went wrong.")}).finally(()=>{_.close()})}else p.error(t("auth.formIncomplete"))})};return oe(`${t("auth.signup")} - ${P("appName").value}`),(a,s)=>{const g=N,_=F,v=D,u=X,m=Y,b=Z,T=ee,L=O,R=te;return c(),x(R,null,{default:l(()=>[n(L,{ref_key:"ruleFormRef",ref:w,model:e(r),rules:e(S),"label-position":"top",class:"flex-col flex-center w-full max-w-xs px-4 m-auto",style:{height:"calc(100vh - 56px)"}},{default:l(()=>[f("h1",re,d(a.$t("auth.signup")),1),n(_,{label:a.$t("auth.email"),style:j(e(i)===1?"margin-bottom: 0;":""),prop:"email",class:"inputWrapper SignupInputAnim1"},{default:l(()=>[(c(),x(g,{key:e(i),modelValue:e(r).email,"onUpdate:modelValue":s[0]||(s[0]=o=>e(r).email=o),type:"email",size:"large","prefix-icon":e(H),readonly:e(i)>0,disabled:e(i)>0},null,8,["modelValue","prefix-icon","readonly","disabled"]))]),_:1},8,["label","style"]),e(i)===1?(c(),C("div",le,[n(u,{type:"primary",onClick:q,style:{"font-size":"small"}},{default:l(()=>[n(v,{size:"small",class:"mr-1"},{default:l(()=>[n(e(G))]),_:1}),f("span",null,d(a.$t("action.change")),1)]),_:1})])):h("",!0),e(i)===1?(c(),x(_,{key:1,label:a.$t("auth.username"),prop:"username",class:"inputWrapper SignupInputAnim1"},{default:l(()=>[n(g,{modelValue:e(r).username,"onUpdate:modelValue":s[1]||(s[1]=o=>e(r).username=o),type:"text",size:"large","prefix-icon":e(J),formatter:o=>o.replace(/[^\w]+/g,""),parser:o=>o.replace(/[^\w]+/g,"")},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):h("",!0),e(i)===1?(c(),x(_,{key:2,label:a.$t("auth.passwd"),prop:"password",class:"inputWrapper SignupInputAnim2 SignupPasswordInputWrapper"},{default:l(()=>[n(g,{modelValue:e(r).password,"onUpdate:modelValue":s[2]||(s[2]=o=>e(r).password=o),type:"password",size:"large","prefix-icon":e(K),formatter:o=>o.trim(),parser:o=>o.trim(),"show-password":""},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):h("",!0),e(i)===1?(c(),x(_,{key:3,label:a.$t("auth.veriCode"),prop:"veriCode",class:"inputWrapper SignupInputAnim2"},{default:l(()=>[n(g,{modelValue:e(r).veriCode,"onUpdate:modelValue":s[3]||(s[3]=o=>e(r).veriCode=o),type:"text",size:"large",maxLength:"6","prefix-icon":e(Q)},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"])):h("",!0),e(i)===1&&!e(E)?(c(),C("div",ne,[f("div",ie,[n(m,{type:"info",style:{"font-size":"small"}},{default:l(()=>[y(d(a.$t("auth.notReceiveVeriCode")),1)]),_:1}),n(u,{type:"primary",style:{"font-size":"small"},onClick:A},{default:l(()=>[y(d(a.$t("action.resend")),1)]),_:1})])])):h("",!0),ue,e(i)===0?(c(),C("div",me,[n(b,{size:"large",type:"primary",onClick:s[4]||(s[4]=o=>V(e(w)))},{default:l(()=>[y(d(a.$t("auth.getVeriCode")),1)]),_:1})])):h("",!0),e(i)===1?(c(),C("div",pe,[n(b,{size:"large",type:"primary",onClick:s[5]||(s[5]=o=>B(e(w)))},{default:l(()=>[y(d(a.$t("auth.signup")),1)]),_:1})])):h("",!0),ce,f("div",de,[f("div",fe,[n(m,{type:"info"},{default:l(()=>[y(d(a.$t("auth.alreadyHaveAnAcc")),1)]),_:1}),n(u,{type:"primary"},{default:l(()=>[n(T,{to:"/login"},{default:l(()=>[y(d(a.$t("auth.login")),1)]),_:1})]),_:1})])]),f("div",ge,[n(m,{size:"small",type:"info"},{default:l(()=>[y(d(a.$t("auth.loginTip1")),1)]),_:1})]),_e]),_:1},8,["model","rules"])]),_:1})}}});export{Ne as default};
