var O=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var d=(t,e,r)=>(O(t,e,"read from private field"),r?r.call(t):e.get(t)),P=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},b=(t,e,r,s)=>(O(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r);import{r as m,g as D,D as I,E as l,z as M,A as N}from"./entry.53b65866.js";var i;class _{constructor(){P(this,i,void 0);b(this,i,new EventTarget)}addListener(e,r){try{d(this,i).addEventListener(e,r)}catch{}}removeListener(e,r){try{d(this,i).removeEventListener(e,r)}catch{}}dispatchEvent(e){d(this,i).dispatchEvent(new Event(e))}}i=new WeakMap;const w=new _,y=m(""),L=m(""),o=m(!1),E=m(!1),R=(()=>{const t=(n="")=>n.startsWith("Win")?"Win":n.startsWith("Linux")?"Linux":n.startsWith("Mac")?"Mac":n,e=n=>(n=!!n,n?!0:Object.keys(Object.getOwnPropertyDescriptors(navigator)).includes("webdriver")),r=(n="",a="")=>!n.includes(t(a)),s=(n,a=!1)=>{if(a)return!1;if(!n||n.length===0)return!0;const h=Object.values(Object.getOwnPropertyDescriptors(n)).map(c=>c.value);if(h.length===n.length)return!0;const f=h.map(c=>c.constructor===Plugin);return f.filter(c=>c).length!==f.length},p=(n="",a=[])=>!n||!a||a.length===0,u=(n="",a)=>n.includes("Chrome")?!a:!1,g=()=>"ontouchstart"in document||navigator.maxTouchPoints>0;return()=>{const{userAgent:n="",platform:a="",plugins:h=[],webdriver:f=!1,language:c="",languages:S=[]}=navigator,x=g(),C=e(f),$=s(h,x),j=p(c,S),k=r(n,a),A=u(n,window==null?void 0:window.chrome);return{wd:C,pg:$,lg:j,pf:k,cr:A}}})();function T(t){E.value=t}const U=async()=>{o.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"}),y.value="",L.value="",T(!1),w.dispatchEvent("logout"),l.success("Logged out.")}catch{l.error("Log out failed.")}finally{o.value=!1}};let W=0;const v=async(t=!1)=>{const e=Date.now();if(!t&&e-W<6e4)return E.value;o.value=!0;try{const{isLoggedIn:r,user:s}=await $fetch("/api/auth/check",{method:"POST"});return W=e,y.value=(s==null?void 0:s.email)||"",L.value=(s==null?void 0:s.username)||"",o.value=!1,setTimeout(()=>T(r),0),r}catch{o.value=!1}};(async()=>{try{await v()}catch(t){console.error(t)}finally{}})();const z=async t=>{try{const{error:e}=await $fetch("/api/auth/username",{method:"PUT",body:{username:t}});if(e)throw e;return await v(!0),l.success("The username has been changed."),!0}catch(e){return l.error(typeof e=="string"?e:"Oops! Something went wrong."),!1}};function q(){const t=D().t;async function e(r,s){const p=M.service({text:t("auth.loggingIn")});o.value=!0;try{const u=await $fetch("/api/auth/login",{method:"POST",body:{usernameOrEmail:r,password:s}}),{error:g}=u;if(g)throw g;w.dispatchEvent("login"),await N("/c/"),await v(!0),l.success("Logged in.")}catch(u){l.error(typeof u=="string"?u:"Oops! Something went wrong.")}finally{p.close(),o.value=!1}}return{authEventTarget:w,authIsLoading:o,isLoggedIn:E,email:y,username:L,login:e,logout:U,checkIsLoggedIn:v,setIsLoggedIn:T,changeUsername:z,mousetrap:R,goToHome(){I().$router.replace("/")},goToNewChat(){I().$router.replace("/c/")}}}export{q as u};
