import{E as A}from"./el-input.56f3fa48.js";import{E as F,a as N}from"./el-form.3cdfe342.js";import{f as O,g as W,r as k,m as $,i as M,o as u,j as x,w as r,b as o,a as p,t as f,n as U,k as e,c as C,q as h,d as y,E as m,s as z,v as j,x as D,y as G,z as H,A as J,B as K}from"./entry.9e0d5745.js";import{E as Q}from"./el-link.77ff80bd.js";import{E as X}from"./el-text.cc01af29.js";import{E as Y}from"./el-button.37e5292e.js";import{_ as Z}from"./LanguageSelect.ec84d6a5.js";import{_ as ee}from"./client-only.4f1a4f73.js";/* empty css                */import{E as te}from"./el-overlay.69ea380b.js";import{u as ae}from"./useTitle.56a5e2e0.js";import"./isEqual.c2ec19c3.js";import"./_initCloneObject.b39d8b7e.js";import"./el-popper.a364c5dd.js";import"./focus-trap.5c6bc571.js";import"./el-scrollbar.074c1fe3.js";import"./scroll.3ddc10fa.js";const se={class:"mt-0 mb-6"},oe={key:0,class:"-mt-1 mb-2 w-full text-right"},le={key:3,class:"flex-center flex-col gap-1 w-full"},re={class:"flex justify-end gap-1 w-full"},ie=p("div",{class:"p-6"},null,-1),ne={key:4,class:"flex-center"},ce={key:5,class:"flex-center"},me=p("div",{class:"p-2"},null,-1),pe={class:"flex-center flex-col gap-1"},de={class:"flex-center flex-wrap gap-1",style:{"line-height":"1rem"}},ue=p("div",{class:"p-8"},null,-1),fe={class:"absolute w-screen flex-center gap-2 p-3",style:{bottom:"0"}},_e={style:{width:"120px"}},Re=O({__name:"reset-password",setup(ge){const a=W().t,b=k(!1),i=k(0),w=k(),l=$({email:"",password:"",veriCode:""}),S=()=>{history.back()},B=$({email:[{required:!0,message:a("auth.emailRequired"),trigger:"change"},{type:"email",message:a("auth.emailInvalid"),trigger:"change"}],password:[{required:!0,message:a("auth.passwdRequired"),trigger:"change"},{min:8,max:64,message:a("auth.passwdLength"),trigger:"change"}],veriCode:[{required:!0,message:a("auth.veriCodeRequired"),trigger:"change"},{min:6,max:6,message:a("auth.veriCodeRequired"),trigger:"change"}]}),I=()=>{te.confirm(a("auth.confirmChangeEmail"),"",{confirmButtonText:a("message.ok"),cancelButtonText:a("message.cancel"),type:"warning"}).then(()=>{i.value=0,l.email="",l.veriCode="",m.success(a("action.opExecuted"))}).catch(()=>{m.info(a("action.opCanceled"))})},P=()=>{b.value=!0,E(w.value,!0)},E=async(s,t=!1)=>{await s.validate((_,g)=>{if(_||t){const v=z.service({text:a("auth.sendingVeriCode")});$fetch(t?"/api/auth/resendCode":"/api/auth/createVerification",{method:"POST",body:{email:l.email}}).then(n=>{const d=n;d!=null&&d.error?m.error(d==null?void 0:d.error):(m.success("Email sent, please check your inbox."),i.value=1)}).catch(()=>{m.error("Oops! Something went wrong.")}).finally(()=>{v.close()})}else m.error(a("auth.formIncomplete"))})},q=async s=>{await s.validate((t,_)=>{if(t){const g=z.service({text:a("auth.sendingVeriCode")});$fetch("/api/auth/resetPassword",{method:"POST",body:{email:l.email,password:l.password,code:l.veriCode}}).then(v=>{const n=v;n!=null&&n.error?m.error(n==null?void 0:n.error):(m.success("Password reset successful."),j("/acc/profile"))}).catch(()=>{m.error("Oops! Something went wrong.")}).finally(()=>{g.close()})}else m.error(a("auth.formIncomplete"))})};return ae(`${a("auth.resetPw")} - ${M("appName").value}`),(s,t)=>{const _=A,g=F,v=D,n=Q,d=X,V=Y,T=N,R=Z,L=ee;return u(),x(L,null,{default:r(()=>[o(T,{ref_key:"ruleFormRef",ref:w,model:e(l),rules:e(B),"label-position":"top",class:"flex-col flex-center w-full max-w-xs px-4 m-auto",style:{height:"calc(100vh - 56px)"}},{default:r(()=>[p("h1",se,f(s.$t("auth.resetPw")),1),o(g,{label:s.$t("auth.email"),style:U(e(i)===1?"margin-bottom: 0;":""),prop:"email",class:"inputWrapper SignupInputAnim1"},{default:r(()=>[(u(),x(_,{key:e(i),modelValue:e(l).email,"onUpdate:modelValue":t[0]||(t[0]=c=>e(l).email=c),type:"email",size:"large","prefix-icon":e(G),readonly:e(i)>0,disabled:e(i)>0},null,8,["modelValue","prefix-icon","readonly","disabled"]))]),_:1},8,["label","style"]),e(i)===1?(u(),C("div",oe,[o(n,{type:"primary",onClick:I,style:{"font-size":"small"}},{default:r(()=>[o(v,{size:"small",class:"mr-1"},{default:r(()=>[o(e(H))]),_:1}),p("span",null,f(s.$t("action.change")),1)]),_:1})])):h("",!0),e(i)===1?(u(),x(g,{key:1,label:s.$t("auth.passwd"),prop:"password",class:"inputWrapper SignupInputAnim2 SignupPasswordInputWrapper"},{default:r(()=>[o(_,{modelValue:e(l).password,"onUpdate:modelValue":t[1]||(t[1]=c=>e(l).password=c),type:"password",size:"large","prefix-icon":e(J),formatter:c=>c.trim(),parser:c=>c.trim(),"show-password":""},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):h("",!0),e(i)===1?(u(),x(g,{key:2,label:s.$t("auth.veriCode"),prop:"veriCode",class:"inputWrapper SignupInputAnim2"},{default:r(()=>[o(_,{modelValue:e(l).veriCode,"onUpdate:modelValue":t[2]||(t[2]=c=>e(l).veriCode=c),type:"text",size:"large",maxLength:"6","prefix-icon":e(K)},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"])):h("",!0),e(i)===1&&!e(b)?(u(),C("div",le,[p("div",re,[o(d,{type:"info",style:{"font-size":"small"}},{default:r(()=>[y(f(s.$t("auth.notReceiveVeriCode")),1)]),_:1}),o(n,{type:"primary",style:{"font-size":"small"},onClick:P},{default:r(()=>[y(f(s.$t("action.resend")),1)]),_:1})])])):h("",!0),ie,e(i)===0?(u(),C("div",ne,[o(V,{size:"large",type:"primary",onClick:t[3]||(t[3]=c=>E(e(w)))},{default:r(()=>[y(f(s.$t("auth.getVeriCode")),1)]),_:1})])):h("",!0),e(i)===1?(u(),C("div",ce,[o(V,{size:"large",type:"primary",onClick:t[4]||(t[4]=c=>q(e(w)))},{default:r(()=>[y(f(s.$t("action.submit")),1)]),_:1})])):h("",!0),me,p("div",pe,[p("div",de,[o(n,{type:"primary",onClick:t[5]||(t[5]=c=>S())},{default:r(()=>[y(f(s.$t("action.back")),1)]),_:1})])]),ue]),_:1},8,["model","rules"]),p("div",fe,[o(d,{type:"info",class:"opacity-75"},{default:r(()=>[y("More languages:")]),_:1}),p("span",_e,[o(R,{size:"small"})])])]),_:1})}}});export{Re as default};
