import{r as l,g as p,aD as h,E as s,s as w,v as L}from"./entry.60a981b0.js";import{u as I}from"./useChat.fb420c67.js";const r=l(""),o=l(!1),g=l(!1);function c(e){g.value=e}const T=async()=>{o.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"}),r.value="",c(!1),s.success("Logged out."),I().clear()}catch{s.error("Log out failed.")}finally{o.value=!1}};let f=0;const m=async()=>{const e=Date.now();if(e-f<6e4)return g.value;o.value=!0;try{const{isLoggedIn:a,user:t}=await $fetch("/api/auth/check",{method:"POST"});return f=e,r.value=(t==null?void 0:t.username)||"",o.value=!1,setTimeout(()=>c(a),0),a}catch{o.value=!1}};(async()=>{try{await m()}catch(e){console.error(e)}finally{}})();const $=async e=>{try{const{error:a,username:t}=await $fetch("/api/auth/username",{method:"PUT",body:{username:e}});if(a)throw a;return t&&(r.value=t),s.success("The username has been changed."),!0}catch(a){return s.error(typeof a=="string"?a:"Oops! Something went wrong."),!1}};function P(){const e=p().t;return{authIsLoading:o,isLoggedIn:g,username:r,login:async(t,d)=>{const y=w.service({text:e("auth.loggingIn")});o.value=!0;try{const n=await $fetch("/api/auth/login",{method:"POST",body:{usernameOrEmail:t,password:d}}),{error:i,isLoggedIn:v=!1,user:u}=n;if(i)throw i;s.success("Logged in."),L("/c/"),r.value=(u==null?void 0:u.username)||"",setTimeout(()=>c(v),0)}catch(n){s.error(typeof n=="string"?n:"Oops! Something went wrong.")}finally{y.close(),o.value=!1}},logout:T,checkIsLoggedIn:m,setIsLoggedIn:c,changeUsername:$,goToHome(){h().$router.replace("/")},goToNewChat(){h().$router.replace("/c/")}}}export{P as u};
