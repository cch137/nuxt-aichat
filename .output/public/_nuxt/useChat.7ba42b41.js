var yn=Object.defineProperty;var wn=(e,t,r)=>t in e?yn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Se=(e,t,r)=>(wn(e,typeof t!="symbol"?t+"":t,r),r);import{ab as _t,al as bn,ay as Ht,aW as vt,Z as Cn,X as $t,cf as En,$ as Lt,ah as ht,V as F,cg as Sn,af as Bn,ch as Tn,ai as An,bY as Oe,Y as we,b2 as kn,aR as Mn,aS as mt,f as Ot,b as te,ar as Ge,aj as xn,a0 as In,s as Rn,ci as _n,cj as Hn,U as oe,r as O,h as tt,ck as pt,bg as gt,W as $n,a4 as ce,o as j,j as J,w as K,a9 as De,a as G,a6 as D,n as yt,b0 as Be,c as Ne,a$ as Te,l as ue,t as me,bq as Ae,d as ze,as as We,aZ as Ln,az as Dt,cl as Nt,cm as zt,P as wt,S as On,ax as Dn,b1 as bt,ag as Ct,O as nt,cn as Nn,co as zn,cp as Wn,cq as qn,cr as se,E as U,i as Et,cs as Pn,g as Un,q as $e,aD as Vn,ct as Fe,m as qe,cu as jn}from"./entry.1024d92c.js";import{E as Yn}from"./el-button.d23d9ba3.js";import{t as Xn,E as Kn}from"./el-input.1e6b9b8d.js";import{u as ke}from"./useTitle.7e1ece39.js";import{E as Gn,i as Fn,l as Qn,s as ot}from"./str.2229b459.js";import{a as Jn}from"./scroll.62441652.js";const Zn='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',eo=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,St=e=>Array.from(e.querySelectorAll(Zn)).filter(t=>to(t)&&eo(t)),to=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}};var Re=(e=>(e[e.TEXT=1]="TEXT",e[e.CLASS=2]="CLASS",e[e.STYLE=4]="STYLE",e[e.PROPS=8]="PROPS",e[e.FULL_PROPS=16]="FULL_PROPS",e[e.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",e[e.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",e[e.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",e[e.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",e[e.NEED_PATCH=512]="NEED_PATCH",e[e.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",e[e.HOISTED=-1]="HOISTED",e[e.BAIL=-2]="BAIL",e))(Re||{});const no=(e,t,r)=>{let n={offsetX:0,offsetY:0};const a=C=>{const M=C.clientX,o=C.clientY,{offsetX:S,offsetY:T}=n,c=e.value.getBoundingClientRect(),A=c.left,B=c.top,g=c.width,l=c.height,E=document.documentElement.clientWidth,s=document.documentElement.clientHeight,u=-A+S,m=-B+T,y=E-A-g+S,b=s-B-l+T,w=k=>{const x=Math.min(Math.max(S+k.clientX-M,u),y),I=Math.min(Math.max(T+k.clientY-o,m),b);n={offsetX:x,offsetY:I},e.value.style.transform=`translate(${vt(x)}, ${vt(I)})`},R=()=>{document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",R)};document.addEventListener("mousemove",w),document.addEventListener("mouseup",R)},i=()=>{t.value&&e.value&&t.value.addEventListener("mousedown",a)},p=()=>{t.value&&e.value&&t.value.removeEventListener("mousedown",a)};_t(()=>{bn(()=>{r.value?i():p()})}),Ht(()=>{p()})},oo=(e,t={})=>{Cn(e)||Xn("[useLockscreen]","You need to pass a ref param to this function");const r=t.ns||$t("popup"),n=En(()=>r.bm("parent","hidden"));if(!Lt||ht(document.body,n.value))return;let a=0,i=!1,p="0";const C=()=>{setTimeout(()=>{An(document==null?void 0:document.body,n.value),i&&document&&(document.body.style.width=p)},200)};F(e,M=>{if(!M){C();return}i=!ht(document.body,n.value),i&&(p=document.body.style.width),a=Jn(r.namespace.value);const o=document.documentElement.clientHeight<document.body.scrollHeight,S=Sn(document.body,"overflowY");a>0&&(o||S==="scroll")&&i&&(document.body.style.width=`calc(100% - ${a}px)`),Bn(document.body,n.value)}),Tn(()=>C())},Wt=e=>{if(!e)return{onClick:Oe,onMousedown:Oe,onMouseup:Oe};let t=!1,r=!1;return{onClick:p=>{t&&r&&e(p),t=r=!1},onMousedown:p=>{t=p.target===p.currentTarget},onMouseup:p=>{r=p.target===p.currentTarget}}},Qe="_trap-focus-children",ae=[],Bt=e=>{if(ae.length===0)return;const t=ae[ae.length-1][Qe];if(t.length>0&&e.code===kn.tab){if(t.length===1){e.preventDefault(),document.activeElement!==t[0]&&t[0].focus();return}const r=e.shiftKey,n=e.target===t[0],a=e.target===t[t.length-1];n&&r&&(e.preventDefault(),t[t.length-1].focus()),a&&!r&&(e.preventDefault(),t[0].focus())}},ro={beforeMount(e){e[Qe]=St(e),ae.push(e),ae.length<=1&&document.addEventListener("keydown",Bt)},updated(e){we(()=>{e[Qe]=St(e)})},unmounted(){ae.shift(),ae.length===0&&document.removeEventListener("keydown",Bt)}},so=Mn({mask:{type:Boolean,default:!0},customMaskEvent:{type:Boolean,default:!1},overlayClass:{type:mt([String,Array,Object])},zIndex:{type:mt([String,Number])}}),ao={click:e=>e instanceof MouseEvent},io="overlay";var lo=Ot({name:"ElOverlay",props:so,emits:ao,setup(e,{slots:t,emit:r}){const n=$t(io),a=M=>{r("click",M)},{onClick:i,onMousedown:p,onMouseup:C}=Wt(e.customMaskEvent?void 0:a);return()=>e.mask?te("div",{class:[n.b(),e.overlayClass],style:{zIndex:e.zIndex},onClick:i,onMousedown:p,onMouseup:C},[Ge(t,"default")],Re.STYLE|Re.CLASS|Re.PROPS,["onClick","onMouseup","onMousedown"]):xn("div",{class:e.overlayClass,style:{zIndex:e.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[Ge(t,"default")])}});const co=lo,uo=Ot({name:"ElMessageBox",directives:{TrapFocus:ro},components:{ElButton:Yn,ElFocusTrap:Gn,ElInput:Kn,ElOverlay:co,ElIcon:Rn,..._n},inheritAttrs:!1,props:{buttonSize:{type:String,validator:Fn},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:t}){const{locale:r,zIndex:n,ns:a,size:i}=Hn("message-box",oe(()=>e.buttonSize)),{t:p}=r,{nextZIndex:C}=n,M=O(!1),o=tt({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:null,inputValidator:null,inputErrorMessage:"",message:null,modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:C()}),S=oe(()=>{const _=o.type;return{[a.bm("icon",_)]:_&&pt[_]}}),T=gt(),c=gt(),A=oe(()=>o.icon||pt[o.type]||""),B=oe(()=>!!o.message),g=O(),l=O(),E=O(),s=O(),u=O(),m=oe(()=>o.confirmButtonClass);F(()=>o.inputValue,async _=>{await we(),e.boxType==="prompt"&&_!==null&&I()},{immediate:!0}),F(()=>M.value,_=>{var z,q;_&&(e.boxType!=="prompt"&&(o.autofocus?E.value=(q=(z=u.value)==null?void 0:z.$el)!=null?q:g.value:E.value=g.value),o.zIndex=C()),e.boxType==="prompt"&&(_?we().then(()=>{var W;s.value&&s.value.$el&&(o.autofocus?E.value=(W=H())!=null?W:g.value:E.value=g.value)}):(o.editorErrorMessage="",o.validateError=!1))});const y=oe(()=>e.draggable);no(g,l,y),_t(async()=>{await we(),e.closeOnHashChange&&window.addEventListener("hashchange",b)}),Ht(()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",b)});function b(){M.value&&(M.value=!1,we(()=>{o.action&&t("action",o.action)}))}const w=()=>{e.closeOnClickModal&&x(o.distinguishCancelAndClose?"close":"cancel")},R=Wt(w),k=_=>{if(o.inputType!=="textarea")return _.preventDefault(),x("confirm")},x=_=>{var z;e.boxType==="prompt"&&_==="confirm"&&!I()||(o.action=_,o.beforeClose?(z=o.beforeClose)==null||z.call(o,_,o,b):b())},I=()=>{if(e.boxType==="prompt"){const _=o.inputPattern;if(_&&!_.test(o.inputValue||""))return o.editorErrorMessage=o.inputErrorMessage||p("el.messagebox.error"),o.validateError=!0,!1;const z=o.inputValidator;if(typeof z=="function"){const q=z(o.inputValue);if(q===!1)return o.editorErrorMessage=o.inputErrorMessage||p("el.messagebox.error"),o.validateError=!0,!1;if(typeof q=="string")return o.editorErrorMessage=q,o.validateError=!0,!1}}return o.editorErrorMessage="",o.validateError=!1,!0},H=()=>{const _=s.value.$refs;return _.input||_.textarea},$=()=>{x("close")},V=()=>{e.closeOnPressEscape&&$()};return e.lockScroll&&oo(M),{...$n(o),ns:a,overlayEvent:R,visible:M,hasMessage:B,typeClass:S,contentId:T,inputId:c,btnSize:i,iconComponent:A,confirmButtonClasses:m,rootRef:g,focusStartRef:E,headerRef:l,inputRef:s,confirmRef:u,doClose:b,handleClose:$,onCloseRequested:V,handleWrapperClick:w,handleInputEnter:k,handleAction:x,t:p}}}),fo=["aria-label","aria-describedby"],vo=["aria-label"],ho=["id"];function mo(e,t,r,n,a,i){const p=ce("el-icon"),C=ce("close"),M=ce("el-input"),o=ce("el-button"),S=ce("el-focus-trap"),T=ce("el-overlay");return j(),J(Ln,{name:"fade-in-linear",onAfterLeave:t[11]||(t[11]=c=>e.$emit("vanish")),persisted:""},{default:K(()=>[De(te(T,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:K(()=>[G("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:D(`${e.ns.namespace.value}-overlay-message-box`),onClick:t[8]||(t[8]=(...c)=>e.overlayEvent.onClick&&e.overlayEvent.onClick(...c)),onMousedown:t[9]||(t[9]=(...c)=>e.overlayEvent.onMousedown&&e.overlayEvent.onMousedown(...c)),onMouseup:t[10]||(t[10]=(...c)=>e.overlayEvent.onMouseup&&e.overlayEvent.onMouseup(...c))},[te(S,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:K(()=>[G("div",{ref:"rootRef",class:D([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),{[e.ns.m("center")]:e.center}]),style:yt(e.customStyle),tabindex:"-1",onClick:t[7]||(t[7]=Be(()=>{},["stop"]))},[e.title!==null&&e.title!==void 0?(j(),Ne("div",{key:0,ref:"headerRef",class:D(e.ns.e("header"))},[G("div",{class:D(e.ns.e("title"))},[e.iconComponent&&e.center?(j(),J(p,{key:0,class:D([e.ns.e("status"),e.typeClass])},{default:K(()=>[(j(),J(Te(e.iconComponent)))]),_:1},8,["class"])):ue("v-if",!0),G("span",null,me(e.title),1)],2),e.showClose?(j(),Ne("button",{key:0,type:"button",class:D(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:t[0]||(t[0]=c=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel")),onKeydown:t[1]||(t[1]=Ae(Be(c=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"]))},[te(p,{class:D(e.ns.e("close"))},{default:K(()=>[te(C)]),_:1},8,["class"])],42,vo)):ue("v-if",!0)],2)):ue("v-if",!0),G("div",{id:e.contentId,class:D(e.ns.e("content"))},[G("div",{class:D(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?(j(),J(p,{key:0,class:D([e.ns.e("status"),e.typeClass])},{default:K(()=>[(j(),J(Te(e.iconComponent)))]),_:1},8,["class"])):ue("v-if",!0),e.hasMessage?(j(),Ne("div",{key:1,class:D(e.ns.e("message"))},[Ge(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?(j(),J(Te(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):(j(),J(Te(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0},{default:K(()=>[ze(me(e.dangerouslyUseHTMLString?"":e.message),1)]),_:1},8,["for"]))])],2)):ue("v-if",!0)],2),De(G("div",{class:D(e.ns.e("input"))},[te(M,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":t[2]||(t[2]=c=>e.inputValue=c),type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:D({invalid:e.validateError}),onKeydown:Ae(e.handleInputEnter,["enter"])},null,8,["id","modelValue","type","placeholder","aria-invalid","class","onKeydown"]),G("div",{class:D(e.ns.e("errormsg")),style:yt({visibility:e.editorErrorMessage?"visible":"hidden"})},me(e.editorErrorMessage),7)],2),[[We,e.showInput]])],10,ho),G("div",{class:D(e.ns.e("btns"))},[e.showCancelButton?(j(),J(o,{key:0,loading:e.cancelButtonLoading,class:D([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:t[3]||(t[3]=c=>e.handleAction("cancel")),onKeydown:t[4]||(t[4]=Ae(Be(c=>e.handleAction("cancel"),["prevent"]),["enter"]))},{default:K(()=>[ze(me(e.cancelButtonText||e.t("el.messagebox.cancel")),1)]),_:1},8,["loading","class","round","size"])):ue("v-if",!0),De(te(o,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,class:D([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:t[5]||(t[5]=c=>e.handleAction("confirm")),onKeydown:t[6]||(t[6]=Ae(Be(c=>e.handleAction("confirm"),["prevent"]),["enter"]))},{default:K(()=>[ze(me(e.confirmButtonText||e.t("el.messagebox.confirm")),1)]),_:1},8,["loading","class","round","disabled","size"]),[[We,e.showConfirmButton]])],2)],6)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,fo)]),_:3},8,["z-index","overlay-class","mask"]),[[We,e.visible]])]),_:3})}var po=In(uo,[["render",mo],["__file","/home/runner/work/element-plus/element-plus/packages/components/message-box/src/index.vue"]]);const Ce=new Map,go=e=>{let t=document.body;return e.appendTo&&(Dt(e.appendTo)&&(t=document.querySelector(e.appendTo)),Ct(e.appendTo)&&(t=e.appendTo),Ct(t)||(t=document.body)),t},yo=(e,t,r=null)=>{const n=te(po,e,bt(e.message)||Nt(e.message)?{default:bt(e.message)?e.message:()=>e.message}:null);return n.appContext=r,zt(n,t),go(e).appendChild(t.firstElementChild),n.component},wo=()=>document.createElement("div"),bo=(e,t)=>{const r=wo();e.onVanish=()=>{zt(null,r),Ce.delete(a)},e.onAction=i=>{const p=Ce.get(a);let C;e.showInput?C={value:a.inputValue,action:i}:C=i,e.callback?e.callback(C,n.proxy):i==="cancel"||i==="close"?e.distinguishCancelAndClose&&i!=="cancel"?p.reject("close"):p.reject("cancel"):p.resolve(C)};const n=yo(e,r,t),a=n.proxy;for(const i in e)wt(e,i)&&!wt(a.$props,i)&&(a[i]=e[i]);return a.visible=!0,a};function de(e,t=null){if(!Lt)return Promise.reject();let r;return Dt(e)||Nt(e)?e={message:e}:r=e.callback,new Promise((n,a)=>{const i=bo(e,t??de._context);Ce.set(i,{options:e,callback:r,resolve:n,reject:a})})}const Co=["alert","confirm","prompt"],Eo={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};Co.forEach(e=>{de[e]=So(e)});function So(e){return(t,r,n,a)=>{let i="";return On(r)?(n=r,i=""):Dn(r)?i="":i=r,de(Object.assign({title:i,message:t,type:"",...Eo[e]},n,{boxType:e}),a)}}de.close=()=>{Ce.forEach((e,t)=>{t.doClose()}),Ce.clear()};de._context=null;const Z=de;Z.install=e=>{Z._context=e._context,e.config.globalProperties.$msgbox=Z,e.config.globalProperties.$messageBox=Z,e.config.globalProperties.$alert=Z.alert,e.config.globalProperties.$confirm=Z.confirm,e.config.globalProperties.$prompt=Z.prompt};const Pe=Z;var Bo=Nn,To=zn,Ao=Wn,ko={formats:Ao,parse:To,stringify:Bo};const qt=nt(ko);async function fe(e=0){return await new Promise((t,r)=>{setTimeout(()=>{try{window.scrollTo(0,document.body.scrollHeight),t(null)}catch(n){r(n)}},+e||0)})}const Mo={get isMobileScreen(){return window.innerWidth<600},get isTouchScreen(){return"ontouchstart"in document||navigator.maxTouchPoints>0}};function Tt(){return Mo}const At="web-browsing",kt="temperature-suffix",Ue="temperature",Pt="01",Ut="0123456789",Vt="0123456789abcdef",jt="0123456789abcdefghijklmnopqrstuvwxyz",Yt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Xt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",Je=e=>{switch(typeof e!="string"&&(e=Qn(e)),e){case"2":return Pt;case"10":return Ut;case"16":return Vt;case"36":return jt;case"62":return Yt;case"64":return ie;case"64w":case"64+":return Xt;default:return e}},xo=(e,t,r,n=0)=>{typeof e!="string"&&(e=ot(e));let a=BigInt(0);t=Je(t);const i=t.length;for(let C=0;C<e.length;C++)a+=BigInt(t.indexOf(e[C])*Math.pow(i,e.length-1-C));let p="";if(r=Je(r),p===""){const C=BigInt(r.length);for(;a>0;)p=r.charAt(+BigInt(a%C).toString())+p,a=BigInt(a/C)}return(p===""?r.charAt(0):p).padStart(n,r[0])},Io=e=>{const t=e.split("").map(i=>i.charCodeAt(0)),r=[];let n=0;for(;n<t.length;){const[i,p=0,C=0]=t.slice(n,n+=3),M=(i<<16)+(p<<8)+C,o=M>>18,S=M>>12&63,T=M>>6&63,c=M&63;r.push(ie[o],ie[S],ie[T],ie[c])}const a=t.length%3;return r.join("").slice(0,1+r.length-a)+(a===2?"==":a===1?"=":"")},Ro=/[^A-Za-z0-9+/]/g,Kt=e=>e.replace(Ro,""),Ve=e=>String.fromCharCode(+e),_o=e=>{const t=Kt(e).split(""),r=[];let n=0;for(;n<t.length;){const[a,i,p,C]=t.slice(n,n+=4).map(M=>ie.indexOf(M));r.push(Ve(a<<2|i>>4)),p!==64&&r.push(Ve((i&15)<<4|p>>2)),C!==64&&r.push(Ve((p&3)<<6|C))}return r.join("").replaceAll("\0","")},ve={BASE2_CHARSET:Pt,BASE10_CHARSET:Ut,BASE16_CHARSET:Vt,BASE36_CHARSET:jt,BASE62_CHARSET:Yt,BASE64_CHARSET:ie,BASE64WEB_CHARSET:Xt,convert:xo,getCharset:Je,secureBase64:Kt,textToBase64:Io,base64ToText:_o};var Gt={exports:{}};function Ho(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var je={exports:{}},Mt;function rt(){return Mt||(Mt=1,function(e,t){(function(r,n){e.exports=n()})(se,function(){var r=r||function(n,a){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof se<"u"&&se.crypto&&(i=se.crypto),!i&&typeof Ho=="function")try{i=qn}catch{}var p=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},C=Object.create||function(){function s(){}return function(u){var m;return s.prototype=u,m=new s,s.prototype=null,m}}(),M={},o=M.lib={},S=o.Base=function(){return{extend:function(s){var u=C(this);return s&&u.mixIn(s),(!u.hasOwnProperty("init")||this.init===u.init)&&(u.init=function(){u.$super.init.apply(this,arguments)}),u.init.prototype=u,u.$super=this,u},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var u in s)s.hasOwnProperty(u)&&(this[u]=s[u]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),T=o.WordArray=S.extend({init:function(s,u){s=this.words=s||[],u!=a?this.sigBytes=u:this.sigBytes=s.length*4},toString:function(s){return(s||A).stringify(this)},concat:function(s){var u=this.words,m=s.words,y=this.sigBytes,b=s.sigBytes;if(this.clamp(),y%4)for(var w=0;w<b;w++){var R=m[w>>>2]>>>24-w%4*8&255;u[y+w>>>2]|=R<<24-(y+w)%4*8}else for(var k=0;k<b;k+=4)u[y+k>>>2]=m[k>>>2];return this.sigBytes+=b,this},clamp:function(){var s=this.words,u=this.sigBytes;s[u>>>2]&=4294967295<<32-u%4*8,s.length=n.ceil(u/4)},clone:function(){var s=S.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var u=[],m=0;m<s;m+=4)u.push(p());return new T.init(u,s)}}),c=M.enc={},A=c.Hex={stringify:function(s){for(var u=s.words,m=s.sigBytes,y=[],b=0;b<m;b++){var w=u[b>>>2]>>>24-b%4*8&255;y.push((w>>>4).toString(16)),y.push((w&15).toString(16))}return y.join("")},parse:function(s){for(var u=s.length,m=[],y=0;y<u;y+=2)m[y>>>3]|=parseInt(s.substr(y,2),16)<<24-y%8*4;return new T.init(m,u/2)}},B=c.Latin1={stringify:function(s){for(var u=s.words,m=s.sigBytes,y=[],b=0;b<m;b++){var w=u[b>>>2]>>>24-b%4*8&255;y.push(String.fromCharCode(w))}return y.join("")},parse:function(s){for(var u=s.length,m=[],y=0;y<u;y++)m[y>>>2]|=(s.charCodeAt(y)&255)<<24-y%4*8;return new T.init(m,u)}},g=c.Utf8={stringify:function(s){try{return decodeURIComponent(escape(B.stringify(s)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(s){return B.parse(unescape(encodeURIComponent(s)))}},l=o.BufferedBlockAlgorithm=S.extend({reset:function(){this._data=new T.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=g.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var u,m=this._data,y=m.words,b=m.sigBytes,w=this.blockSize,R=w*4,k=b/R;s?k=n.ceil(k):k=n.max((k|0)-this._minBufferSize,0);var x=k*w,I=n.min(x*4,b);if(x){for(var H=0;H<x;H+=w)this._doProcessBlock(y,H);u=y.splice(0,x),m.sigBytes-=I}return new T.init(u,I)},clone:function(){var s=S.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0});o.Hasher=l.extend({cfg:S.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){s&&this._append(s);var u=this._doFinalize();return u},blockSize:16,_createHelper:function(s){return function(u,m){return new s.init(m).finalize(u)}},_createHmacHelper:function(s){return function(u,m){return new E.HMAC.init(s,m).finalize(u)}}});var E=M.algo={};return M}(Math);return r})}(je)),je.exports}var Ye={exports:{}},xt;function $o(){return xt||(xt=1,function(e,t){(function(r,n){e.exports=n(rt())})(se,function(r){return function(n){var a=r,i=a.lib,p=i.Base,C=i.WordArray,M=a.x64={};M.Word=p.extend({init:function(o,S){this.high=o,this.low=S}}),M.WordArray=p.extend({init:function(o,S){o=this.words=o||[],S!=n?this.sigBytes=S:this.sigBytes=o.length*8},toX32:function(){for(var o=this.words,S=o.length,T=[],c=0;c<S;c++){var A=o[c];T.push(A.high),T.push(A.low)}return C.create(T,this.sigBytes)},clone:function(){for(var o=p.clone.call(this),S=o.words=this.words.slice(0),T=S.length,c=0;c<T;c++)S[c]=S[c].clone();return o}})}(),r})}(Ye)),Ye.exports}(function(e,t){(function(r,n,a){e.exports=n(rt(),$o())})(se,function(r){return function(n){var a=r,i=a.lib,p=i.WordArray,C=i.Hasher,M=a.x64,o=M.Word,S=a.algo,T=[],c=[],A=[];(function(){for(var l=1,E=0,s=0;s<24;s++){T[l+5*E]=(s+1)*(s+2)/2%64;var u=E%5,m=(2*l+3*E)%5;l=u,E=m}for(var l=0;l<5;l++)for(var E=0;E<5;E++)c[l+5*E]=E+(2*l+3*E)%5*5;for(var y=1,b=0;b<24;b++){for(var w=0,R=0,k=0;k<7;k++){if(y&1){var x=(1<<k)-1;x<32?R^=1<<x:w^=1<<x-32}y&128?y=y<<1^113:y<<=1}A[b]=o.create(w,R)}})();var B=[];(function(){for(var l=0;l<25;l++)B[l]=o.create()})();var g=S.SHA3=C.extend({cfg:C.cfg.extend({outputLength:512}),_doReset:function(){for(var l=this._state=[],E=0;E<25;E++)l[E]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(l,E){for(var s=this._state,u=this.blockSize/2,m=0;m<u;m++){var y=l[E+2*m],b=l[E+2*m+1];y=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,b=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360;var w=s[m];w.high^=b,w.low^=y}for(var R=0;R<24;R++){for(var k=0;k<5;k++){for(var x=0,I=0,H=0;H<5;H++){var w=s[k+5*H];x^=w.high,I^=w.low}var $=B[k];$.high=x,$.low=I}for(var k=0;k<5;k++)for(var V=B[(k+4)%5],_=B[(k+1)%5],z=_.high,q=_.low,x=V.high^(z<<1|q>>>31),I=V.low^(q<<1|z>>>31),H=0;H<5;H++){var w=s[k+5*H];w.high^=x,w.low^=I}for(var W=1;W<25;W++){var x,I,w=s[W],Y=w.high,X=w.low,f=T[W];f<32?(x=Y<<f|X>>>32-f,I=X<<f|Y>>>32-f):(x=X<<f-32|Y>>>64-f,I=Y<<f-32|X>>>64-f);var d=B[c[W]];d.high=x,d.low=I}var v=B[0],h=s[0];v.high=h.high,v.low=h.low;for(var k=0;k<5;k++)for(var H=0;H<5;H++){var W=k+5*H,w=s[W],ct=B[W],ut=B[(k+1)%5+5*H],ft=B[(k+2)%5+5*H];w.high=ct.high^~ut.high&ft.high,w.low=ct.low^~ut.low&ft.low}var w=s[0],dt=A[R];w.high^=dt.high,w.low^=dt.low}},_doFinalize:function(){var l=this._data,E=l.words;this._nDataBytes*8;var s=l.sigBytes*8,u=this.blockSize*32;E[s>>>5]|=1<<24-s%32,E[(n.ceil((s+1)/u)*u>>>5)-1]|=128,l.sigBytes=E.length*4,this._process();for(var m=this._state,y=this.cfg.outputLength/8,b=y/8,w=[],R=0;R<b;R++){var k=m[R],x=k.high,I=k.low;x=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,I=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,w.push(I),w.push(x)}return new p.init(w,y)},clone:function(){for(var l=C.clone.call(this),E=l._state=this._state.slice(0),s=0;s<25;s++)E[s]=E[s].clone();return l}});a.SHA3=C._createHelper(g),a.HmacSHA3=C._createHmacHelper(g)}(Math),r.SHA3})})(Gt);var Lo=Gt.exports;const Ft=nt(Lo);function Oo(...e){return e.reduce((t,r)=>t+r,0)}function Do(e){try{return typeof e[Symbol==null?void 0:Symbol.iterator]=="function"}catch{return!1}}function Qt(e){const t=new Set;return JSON.stringify(e,(n,a)=>{if(typeof a=="object"&&a!==null){if(t.has(a))return;t.add(a),Do(a)&&(a=[...a])}return a})}const No=e=>Ft(e,{outputLength:256}).toString(),zo=/0b[0-1]+/i;function Ee(e){if(typeof e=="number")return Math.round(e);if(e instanceof Object&&(e=Qt(e)),typeof e=="string"){if(zo.test(e))return parseInt(e.substring(2,e.length-1),2);const t=parseInt(e);return Number.isNaN(t)?t:Oo(parseInt(No(e),16))}else return Date.now()}const N=624,Me=397,Wo=2567483615,Xe=2147483648,Ke=2147483647;class qo{constructor(t){Se(this,"mt",new Array(N));Se(this,"mti",N+1);Se(this,"seed");return this.seed=t=Ee(t),Array.isArray(t)?this.init_by_array(t,t.length):this.init_seed(t),this}init_seed(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<N;this.mti++)t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(((t&4294901760)>>>16)*1812433253<<16)+(t&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}init_by_array(t,r){let n,a,i;for(this.init_seed(19650218),n=1,a=0,i=N>r?N:r;i!==0;i--){const p=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((p&4294901760)>>>16)*1664525<<16)+(p&65535)*1664525)+t[a]+a,this.mt[n]>>>=0,n++,a++,n>=N&&(this.mt[0]=this.mt[N-1],n=1),a>=r&&(a=0)}for(i=N-1;i!==0;i--){const p=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((p&4294901760)>>>16)*1566083941<<16)+(p&65535)*1566083941)-n,this.mt[n]>>>=0,n++,n>=N&&(this.mt[0]=this.mt[N-1],n=1)}this.mt[0]=2147483648}random_int(){let t;const r=new Array(0,Wo);if(this.mti>=N){let n;for(this.mti===N+1&&this.init_seed(5489),n=0;n<N-Me;n++)t=this.mt[n]&Xe|this.mt[n+1]&Ke,this.mt[n]=this.mt[n+Me]^t>>>1^r[t&1];for(;n<N-1;n++)t=this.mt[n]&Xe|this.mt[n+1]&Ke,this.mt[n]=this.mt[n+(Me-N)]^t>>>1^r[t&1];t=this.mt[N-1]&Xe|this.mt[0]&Ke,this.mt[N-1]=this.mt[Me-1]^t>>>1^r[t&1],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0}random_int31(){return this.random_int()>>>1}random_incl(){return this.random_int()*(1/4294967295)}random(){return this.random_int()*(1/4294967296)}random_excl(){return(this.random_int()+.5)*(1/4294967296)}random_long(){return((this.random_int()>>>5)*67108864+(this.random_int()>>>6))*(1/9007199254740992)}}function Jt(e){return new qo(e)}const{BASE10_CHARSET:Po,BASE16_CHARSET:Uo,BASE64WEB_CHARSET:Vo}=ve,jo=Jt(),Zt=(e=jo)=>e.random(),st=(e,t,r)=>((t===void 0||t===0)&&(t=e,e=0),Math.floor(e+Zt(r)*t)),en=(e,t)=>e[st(0,e.length,t)],tn=(e,t=1,r)=>{const n=[],a=[];for(let i=0;i<t;i++)a.length===0&&a.push(...e),n.push(a.splice(st(0,a.length,r),1)[0]);return n},Yo=(e,t)=>tn(e,e.length,t),xe=(e,t=8,r)=>new Array(t).fill(0).map(n=>en(e,r)).join(""),nn={MT:Jt,toSeed:Ee,rand:Zt,randInt:st,charset:xe,choice:en,choices:tn,shuffle:Yo,base10:(e=6,t)=>xe(Po,e,t),base16:(e=32,t)=>xe(Uo,e,t),base64:(e=32,t)=>xe(Vo,e,t),lcg(e){let t=Ee(e);return()=>(t=(t*1664525+1013904223)%4294967296)/4294967296}};var on={exports:{}};(function(e,t){(function(r,n){e.exports=n(rt())})(se,function(r){return function(n){var a=r,i=a.lib,p=i.WordArray,C=i.Hasher,M=a.algo,o=[];(function(){for(var g=0;g<64;g++)o[g]=n.abs(n.sin(g+1))*4294967296|0})();var S=M.MD5=C.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(g,l){for(var E=0;E<16;E++){var s=l+E,u=g[s];g[s]=(u<<8|u>>>24)&16711935|(u<<24|u>>>8)&4278255360}var m=this._hash.words,y=g[l+0],b=g[l+1],w=g[l+2],R=g[l+3],k=g[l+4],x=g[l+5],I=g[l+6],H=g[l+7],$=g[l+8],V=g[l+9],_=g[l+10],z=g[l+11],q=g[l+12],W=g[l+13],Y=g[l+14],X=g[l+15],f=m[0],d=m[1],v=m[2],h=m[3];f=T(f,d,v,h,y,7,o[0]),h=T(h,f,d,v,b,12,o[1]),v=T(v,h,f,d,w,17,o[2]),d=T(d,v,h,f,R,22,o[3]),f=T(f,d,v,h,k,7,o[4]),h=T(h,f,d,v,x,12,o[5]),v=T(v,h,f,d,I,17,o[6]),d=T(d,v,h,f,H,22,o[7]),f=T(f,d,v,h,$,7,o[8]),h=T(h,f,d,v,V,12,o[9]),v=T(v,h,f,d,_,17,o[10]),d=T(d,v,h,f,z,22,o[11]),f=T(f,d,v,h,q,7,o[12]),h=T(h,f,d,v,W,12,o[13]),v=T(v,h,f,d,Y,17,o[14]),d=T(d,v,h,f,X,22,o[15]),f=c(f,d,v,h,b,5,o[16]),h=c(h,f,d,v,I,9,o[17]),v=c(v,h,f,d,z,14,o[18]),d=c(d,v,h,f,y,20,o[19]),f=c(f,d,v,h,x,5,o[20]),h=c(h,f,d,v,_,9,o[21]),v=c(v,h,f,d,X,14,o[22]),d=c(d,v,h,f,k,20,o[23]),f=c(f,d,v,h,V,5,o[24]),h=c(h,f,d,v,Y,9,o[25]),v=c(v,h,f,d,R,14,o[26]),d=c(d,v,h,f,$,20,o[27]),f=c(f,d,v,h,W,5,o[28]),h=c(h,f,d,v,w,9,o[29]),v=c(v,h,f,d,H,14,o[30]),d=c(d,v,h,f,q,20,o[31]),f=A(f,d,v,h,x,4,o[32]),h=A(h,f,d,v,$,11,o[33]),v=A(v,h,f,d,z,16,o[34]),d=A(d,v,h,f,Y,23,o[35]),f=A(f,d,v,h,b,4,o[36]),h=A(h,f,d,v,k,11,o[37]),v=A(v,h,f,d,H,16,o[38]),d=A(d,v,h,f,_,23,o[39]),f=A(f,d,v,h,W,4,o[40]),h=A(h,f,d,v,y,11,o[41]),v=A(v,h,f,d,R,16,o[42]),d=A(d,v,h,f,I,23,o[43]),f=A(f,d,v,h,V,4,o[44]),h=A(h,f,d,v,q,11,o[45]),v=A(v,h,f,d,X,16,o[46]),d=A(d,v,h,f,w,23,o[47]),f=B(f,d,v,h,y,6,o[48]),h=B(h,f,d,v,H,10,o[49]),v=B(v,h,f,d,Y,15,o[50]),d=B(d,v,h,f,x,21,o[51]),f=B(f,d,v,h,q,6,o[52]),h=B(h,f,d,v,R,10,o[53]),v=B(v,h,f,d,_,15,o[54]),d=B(d,v,h,f,b,21,o[55]),f=B(f,d,v,h,$,6,o[56]),h=B(h,f,d,v,X,10,o[57]),v=B(v,h,f,d,I,15,o[58]),d=B(d,v,h,f,W,21,o[59]),f=B(f,d,v,h,k,6,o[60]),h=B(h,f,d,v,z,10,o[61]),v=B(v,h,f,d,w,15,o[62]),d=B(d,v,h,f,V,21,o[63]),m[0]=m[0]+f|0,m[1]=m[1]+d|0,m[2]=m[2]+v|0,m[3]=m[3]+h|0},_doFinalize:function(){var g=this._data,l=g.words,E=this._nDataBytes*8,s=g.sigBytes*8;l[s>>>5]|=128<<24-s%32;var u=n.floor(E/4294967296),m=E;l[(s+64>>>9<<4)+15]=(u<<8|u>>>24)&16711935|(u<<24|u>>>8)&4278255360,l[(s+64>>>9<<4)+14]=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,g.sigBytes=(l.length+1)*4,this._process();for(var y=this._hash,b=y.words,w=0;w<4;w++){var R=b[w];b[w]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360}return y},clone:function(){var g=C.clone.call(this);return g._hash=this._hash.clone(),g}});function T(g,l,E,s,u,m,y){var b=g+(l&E|~l&s)+u+y;return(b<<m|b>>>32-m)+l}function c(g,l,E,s,u,m,y){var b=g+(l&s|E&~s)+u+y;return(b<<m|b>>>32-m)+l}function A(g,l,E,s,u,m,y){var b=g+(l^E^s)+u+y;return(b<<m|b>>>32-m)+l}function B(g,l,E,s,u,m,y){var b=g+(E^(l|~s))+u+y;return(b<<m|b>>>32-m)+l}a.MD5=C._createHelper(S),a.HmacMD5=C._createHmacHelper(S)}(Math),r.MD5})})(on);var Xo=on.exports;const Ko=nt(Xo),{MT:Le,shuffle:Go,randInt:_e}=nn,{convert:rn,getCharset:sn}=ve,an=(e,t)=>{const r=Go(e,t);return()=>(r.push(r.shift()),r)},ln=(e,t=16,r=1,n)=>{const a=Number.isNaN(+t)?64:+t,i=sn(t),p=Ee(n!==void 0?n:_e(0,a)),C=Le(p),M=an(i,Le(_e(0,1e6,C))),o=typeof e=="string"?e.split(""):e,S=[n!==void 0?i[_e(0,a)]:rn(p,10,t),...o.map(T=>M()[i.indexOf(T)])];return--r<1?S.join(""):ln(S,t,r,n)},cn=(e,t=16,r=1,n)=>{const a=sn(t),i=Ee(n!==void 0?n:+rn(e[0],t,10)),p=Le(i),C=an(a,Le(_e(0,1e6,p))),o=(typeof e=="string"?e.split(""):e).slice(1,e.length).map(S=>a[C().indexOf(S)]);return--r<1?o.join(""):cn(o,t,r,n)},{textToBase64:Fo,base64ToText:Qo,secureBase64:Jo}=ve;function un(e,t=1,r){return typeof e=="object"?e=Qt(e):typeof e!="string"&&(e=ot(e)),ln(Jo(Fo(e)),64,t,r)}function Zo(e,t=1,r,n=!0){if(e=Qo(cn(e,64,t,r)),!n)return e;try{return JSON.parse(e)}catch{return e}}function er(e,t=512,r){const n=un(e,1,r).substring(1);return t==="MD5"?Ko(n).toString():Ft(n,{outputLength:t}).toString()}const tr={e:un,d:Zo,h:er},nr=new Map([["THINKING","Please wait, I am answering another question..."]]);function or(e,t){switch(e){case"model":if(["gpt3","gpt4","gpt-web","claude-2-web","gpt3-fga"].includes(t))return!0;break;case"temperature":if(typeof t=="number"&&t>=0&&t<=1)return!0;break;case"context":if(typeof t=="boolean")return!0;break}return!1}function rr(e){try{return JSON.parse(e)}catch{return e}}function fn(e){try{const t={};for(const r in e){const n=rr(e[r]);or(r,n)&&(t[r]=n)}return t}catch{return{}}}function sr(e){try{return fn(qt.parse(e))}catch{return{}}}function ar(e){try{return qt.stringify(fn(e))}catch{return""}}let at,It="";const dn=O(),it=O(!1),vn=O(""),le=O("gpt4"),he=O(!0),Q=O(.5),L=O([]),ne=O([]);F(it,e=>{e||ee()});const ir=e=>{it.value=!0,dn.value=e,vn.value=e.Q,setTimeout(()=>hn(),0)};function hn(){try{document.querySelector(".EditMessageInput textarea").focus()}catch{}}const ee=()=>{try{document.querySelector(".InputBox textarea").focus()}catch{}},pe=()=>new Promise((e,t)=>{$fetch("/api/curva/check",{method:"POST"}).then(r=>{const{list:n,saved:a}=r;ne.value=n.sort().map(i=>{var p,C,M;return{id:i,name:(p=a[i])==null?void 0:p.name,config:((C=a[i])==null?void 0:C.config)||"",mtime:((M=a[i])==null?void 0:M.mtime)||0}}).sort((i,p)=>i.mtime-p.mtime).reverse(),e(!0)}).catch(r=>{U.error("Initialization Failed"),t(r)})}),lr=e=>new Promise(async(t,r)=>{if(e==null)return t([]);const n=await $fetch("/api/curva/history",{method:"POST",body:{id:e}});(!n||n.length===0)&&$e("/c/");try{t(n.map(a=>tt({...a,t:new Date(a.t),done:!!a.A})))}catch{$e("/c/"),t([])}}),mn=async function(e){return[]},cr=async()=>{try{const e=L.value.at(-1),t=await mn(e.Q),r=Fe()>=document.body.clientHeight;e.more=t,r&&fe()}catch(e){console.error(e)}},lt=(e=!1)=>{le.value="gpt4",he.value=!0,Q.value=.5,e&&U.success("Conversation settings have been reset.")};lt();const re=O(!1),ge=O(re.value),ye=O(re.value),Ie=O(""),ur=oe(()=>le.value.startsWith("gpt3")?16e3:32e3),fr=(()=>{const{h:e}=tr,t=()=>[77,68,53].map(a=>String.fromCharCode(a)).join(""),r=(a,i)=>({hash:e(a,t(),i),timestamp:ot(i)}),n=(a,i,p,C,M,o)=>{let S=P();return S||(S=nn.base64(8),ne.value.push({id:S,name:void 0}),$e(`/c/${S}?feature=new`)),{conv:S,messages:a,model:i,temperature:p,t:C,tz:M,id:o}};return async a=>{const i=new Date,p=i.getTime(),C=i.getTimezoneOffset()/60*-1,M=(()=>{if(!he.value)return[{role:"user",content:(a==null?void 0:a.Q)||""}];const o=L.value.lastIndexOf(a)+1||L.value.length;let S=L.value.slice(0,o);return S=S.slice(S.length-100),S.map(T=>[{role:"user",content:T.Q},{role:"assistant",content:T.A}].filter(c=>c.content)).flat()})();try{const o=n(M,le.value,Q.value,p,C,a==null?void 0:a.id),S=r(M,p);return await $fetch("/api/curva/answer",{method:"POST",headers:S,body:o})}catch{return{answer:"",error:"Error while sending request."}}}})(),dr=(e="",t="",r=!1)=>tt({done:r,Q:e,A:t,queries:[],urls:[],dt:void 0,t:new Date}),He=new Set,vr=()=>{ne.value=[],L.value=[],$e("/c/"),Ze=!0};let Ze=!0;function Rt(){{const e=jn();e.get("feature")==="new"&&(e.delete("feature"),e.save())}}const pn=(e,t)=>{const r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),r.remove()},P=()=>{var e,t;return(t=(e=at._route)==null?void 0:e.params)==null?void 0:t.conv},be=()=>{var t;const e=P();return((t=ne.value.filter(r=>r.id===e)[0])==null?void 0:t.name)||""};async function gn(e,t){return await $fetch("/api/curva/conv",{method:"PUT",body:{id:e||P(),name:t||be(),config:ar({model:le.value,temperature:Q.value,context:he.value})}})}let et=!1;const hr=e=>{var n;if(e===void 0&&(e=P()),e==null)return;const t=sr(((n=ne.value.filter(a=>a.id===e)[0])==null?void 0:n.config)||""),r=Object.keys(t);if(r.length===0)lt();else{et=!0;try{for(const a of r){const i=t[a];switch(a){case"model":le.value=i;break;case"temperature":Q.value=i;break;case"context":he.value=i;break}}}finally{et=!1}}U.info("Conversation settings have been loaded.")};setTimeout(()=>{let e;[le,he,Q].forEach(t=>{F(t,(r,n)=>{at&&!et&&r!==n&&He.size===0&&(clearTimeout(e),e=setTimeout(async()=>{try{await gn(),U.info("Conversation settings have been saved.")}catch(a){console.error(a),U.warning("Failed to save conversation settings.")}finally{clearTimeout(e)}},typeof t.value=="number"?500:0))})})},1e3);const mr=e=>{L.value=L.value.filter(t=>t.id!==e),$fetch("/api/curva/answer",{method:"DELETE",body:{conv:P(),id:e}}).then(()=>U.info("The message has been deleted.")).catch(()=>U.error("An error occurred while deleting the message."))},pr=()=>{let e=0;const t=`${ve.convert(P(),"64w",10)}.md`,r=L.value.map(n=>{e++;try{return(n.t?`${new Date(n.t.getTime()-(n.dt||0)).toLocaleString()}${n.dt===void 0?"":" (Δt: "+n.dt.toString()+"ms)"}

`:"")+(n.Q?`QUESTION ${e}:

${n.Q.replaceAll(`
`,`

`)}`:"")+(n.Q&&n.A?`

`:"")+(n.A?`ANSWER ${e}:

${n.A}`:"")}catch{return"(Unknown message)"}}).join(`

---

`)+`

---

`;pn(t,r)},gr=()=>{pn(`${ve.convert(P(),"64w",10)}.json`,JSON.stringify(L.value.map(e=>({question:e.Q,answer:e.A,created:new Date(e.t.getTime()).toUTCString(),timeUsed:e.dt||void 0,queries:e.queries||void 0,urls:e.urls||void 0})),null,4))};function Tr(){const e=Et("appName").value,t=Pn(),r=+(t.has(Ue)?t.get(Ue):.5);t.delete(At,{path:"/"}),t.delete(At),t.delete(kt,{path:"/"}),t.delete(kt),r>=0&&r<=1&&(Q.value=r),F(Q,c=>{Q.value=Math.round(c*10)/10,t.set(Ue,`${c}`,{path:"/"})}),at=Vn(),F(re,c=>{Tt().isMobileScreen?(ge.value=!1,ye.value!==c&&(ye.value=c)):(ye.value=!1,ge.value!==c&&(ge.value=c)),setTimeout(()=>{try{ee()}catch{}},0)}),F(ye,c=>{re.value=c}),F(ge,c=>{re.value=c});const n=async c=>{Tt().isMobileScreen&&(re.value=!1),L.value=[];const A=qe.service();try{const B=await Promise.all([c===null&&ne.value.length>0?null:pe(),c===null?null:lr(c)]);hr(c);const g=B[1];g!==null&&P()===c&&(L.value=g,cr())}finally{try{ke(`${be()||"Chat"} - ${e}`)}catch{ke(`Chat - ${e}`)}if(fe(),A!==null)try{await fe(500)}finally{A.close();try{await fe(500)}finally{}}}setTimeout(()=>ee(),500)},a=async(c,A=!1)=>{const B=Promise.all([...He]),g=Ze&&A?new Promise(async l=>{await n(c),Rt(),l(null)}):A?new Promise(l=>l(null)):n(c);Ze=!1,He.add(g);try{await B}catch{}try{await g}finally{He.delete(g)}},i=Un().t,p=Et("version"),C=async(c,A)=>{if(document.querySelectorAll(".Message.T").length>0)return U.info("Please wait for the completion of the previous question."),ee(),!1;const g=(c!==void 0?c:Ie.value).trim();if(c===void 0&&(Ie.value="",g===""))return ee(),!1;const l=(A?L.value.filter($=>$.id===A).at(-1):void 0)||dr(g,"",!1);L.value.includes(l)||L.value.push(l),l.done=!1,l.Q=g,l.A="",l.urls=[],l.queries=[];const E=mn(),s=Fe()>=document.body.clientHeight,u=P(),m=await fr(l);Rt(),It!==u&&(It=u,pe().then(()=>{try{document.querySelector(".ConversationList").scrollTop=0}catch{}}));const{id:y,answer:b="",error:w,urls:R=[],queries:k=[],dt:x=0,version:I}=m;l.done=!0,l.t=new Date,l.dt=x||void 0,l.id=y||void 0,l.A=b||"",l.urls=R||[],l.queries=k||[];const H=($=>$?($.type==="warning"?U.warning($.content):U.error($.content),l.A="Oops! Something went wrong!",!0):!1)((()=>{if(b===""){if(w){const $=L.value.indexOf(l);switch(w){case"THINKING":return L.value.splice($,1),Ie.value=g,{type:"warning",content:nr.get(w)};default:return{type:"error",content:w}}}return{type:"error",content:i("error.plzRefresh")}}})());return setTimeout(async()=>{!A&&s&&await fe(),ee(),I&&I!==p.value&&Pe.confirm(i("action.newVersion"),i("message.notice"),{confirmButtonText:i("message.ok"),cancelButtonText:i("message.cancel"),type:"warning"}).then(()=>{const $=qe.service();location.reload(),setTimeout(()=>$.close(),3e3)}).catch(()=>ee())},0),E.then($=>{const V=Fe()>=document.body.clientHeight;l.more=$,V&&fe()}),H};return{isEditingMessage:it,editingMessage:dn,callEditMessageDialog:ir,editingMessageContent:vn,focusEditMessageInput:hn,model:le,conversations:ne,messages:L,temperature:Q,contextMode:he,openMenu:re,openSidebar:ge,openDrawer:ye,inputValue:Ie,inputMaxLength:ur,getCurrentConvId:P,getCurrentConvName:be,checkTokenAndGetConversations:pe,loadChat:a,sendMessage:C,deleteMessage:mr,regenerateMessage:async c=>{if(L.value.length===0)return;const{Q:A,id:B}=c||L.value.at(-1);C(A||"",B)},focusInput:ee,refreshConversation:()=>{a(P())},renameConversation:(c,A="")=>{c||(c=P(),A=be()),Pe.prompt(i("message.renameConvHint"),i("message.setting"),{confirmButtonText:i("message.ok"),cancelButtonText:i("message.cancel"),inputValue:A,inputPlaceholder:ve.convert(c,"64w",10)}).then(async({value:B})=>{try{await gn(c,B),U({type:"success",message:i("message.renameSuccess")}),await pe();try{ke(`${be()||"Chat"} - ${e}`)}catch{ke(`Chat - ${e}`)}}catch{U({type:"error",message:"Oops! Something went wrong!"})}}).catch(()=>{})},deleteConversation:c=>{var E,s;const A=c||P(),B=[...ne.value];let g=-1,l="createNewChat";for(let u=0;u<B.length;u++)if(B[u].id===A){g=u;break}if(g!==-1){const u=(E=B[g-1])==null?void 0:E.id,m=(s=B[g+1])==null?void 0:s.id;u!==void 0?l=u:m!==void 0&&(l=m)}Pe.confirm(i("message.deleteConvConfirm"),i("message.warning"),{confirmButtonText:i("message.ok"),cancelButtonText:i("message.cancel"),type:"warning"}).then(()=>{const u=qe.service();$fetch("/api/curva/conv",{method:"DELETE",body:{id:A}}).finally(async()=>{var m;u.close(),c===P()?(m=document.getElementById(l))==null||m.click():await pe()})})},resetConvConfig:lt,exportAsMarkdown:pr,exportAsJson:gr,clear:vr}}export{Pe as E,fe as a,no as b,oo as c,co as d,Wt as e,ve as f,Tt as g,nn as r,Tr as u};
