import{E as A}from"./el-input.8c6d3326.js";import{E as F,a as L}from"./el-form.95e2588a.js";import{f as N,g as O,r as k,m as $,i as W,o as p,j as x,w as n,b as c,a as u,t as f,n as U,k as e,c as C,q as h,d as v,E as m,s as z,v as j,x as M,y as D,z as G,A as H,B as J}from"./entry.c8d59687.js";import{E as K}from"./el-link.e17eded7.js";import{E as Q}from"./el-text.1313fb10.js";import{E as X}from"./el-button.9cf1b9e4.js";import{_ as Y}from"./client-only.8bf95797.js";/* empty css                */import{E as Z}from"./el-overlay.d4b13c41.js";import{u as ee}from"./useTitle.22e79668.js";import"./_Uint8Array.bd14c3e8.js";import"./_initCloneObject.dba67074.js";import"./focus-trap.145bbd45.js";import"./scroll.fc9c0e8e.js";const te={class:"mt-0 mb-6"},ae={key:0,class:"-mt-1 mb-2 w-full text-right"},se={key:3,class:"flex-center flex-col gap-1 w-full"},oe={class:"flex justify-end gap-1 w-full"},re=u("div",{class:"p-6"},null,-1),le={key:4,class:"flex-center"},ie={key:5,class:"flex-center"},ne=u("div",{class:"p-2"},null,-1),ce={class:"flex-center flex-col gap-1"},me={class:"flex-center flex-wrap gap-1",style:{"line-height":"1rem"}},de=u("div",{class:"p-8"},null,-1),ze=N({__name:"reset-password",setup(pe){const a=O().t,E=k(!1),r=k(0),w=k(),o=$({email:"",password:"",veriCode:""}),S=()=>{history.back()},B=$({email:[{required:!0,message:a("auth.emailRequired"),trigger:"change"},{type:"email",message:a("auth.emailInvalid"),trigger:"change"}],password:[{required:!0,message:a("auth.passwdRequired"),trigger:"change"},{min:8,max:64,message:a("auth.passwdLength"),trigger:"change"}],veriCode:[{required:!0,message:a("auth.veriCodeRequired"),trigger:"change"},{min:6,max:6,message:a("auth.veriCodeRequired"),trigger:"change"}]}),I=()=>{Z.confirm(a("auth.confirmChangeEmail"),"",{confirmButtonText:a("message.ok"),cancelButtonText:a("message.cancel"),type:"warning"}).then(()=>{r.value=0,o.email="",o.veriCode="",m.success(a("action.opExecuted"))}).catch(()=>{m.info(a("action.opCanceled"))})},P=()=>{E.value=!0,b(w.value,!0)},b=async(s,t=!1)=>{await s.validate((g,_)=>{if(g||t){const y=z.service({text:a("auth.sendingVeriCode")});$fetch(t?"/api/auth/resendCode":"/api/auth/createVerification",{method:"POST",body:{email:o.email}}).then(l=>{const d=l;d!=null&&d.error?m.error(d==null?void 0:d.error):(m.success("Email sent, please check your inbox."),r.value=1)}).catch(()=>{m.error("Oops! Something went wrong.")}).finally(()=>{y.close()})}else m.error(a("auth.formIncomplete"))})},q=async s=>{await s.validate((t,g)=>{if(t){const _=z.service({text:a("action.submitting")+"..."});$fetch("/api/auth/resetPassword",{method:"POST",body:{email:o.email,password:o.password,code:o.veriCode}}).then(y=>{const l=y;l!=null&&l.error?m.error(l==null?void 0:l.error):(m.success("Password reset successful."),j("/acc/profile"))}).catch(()=>{m.error("Oops! Something went wrong.")}).finally(()=>{_.close()})}else m.error(a("auth.formIncomplete"))})};return ee(`${a("auth.resetPw")} - ${W("appName").value}`),(s,t)=>{const g=A,_=F,y=M,l=K,d=Q,V=X,T=L,R=Y;return p(),x(R,null,{default:n(()=>[c(T,{ref_key:"ruleFormRef",ref:w,model:e(o),rules:e(B),"label-position":"top",class:"flex-col flex-center w-full max-w-xs px-4 m-auto",style:{height:"calc(100vh - 56px)"}},{default:n(()=>[u("h1",te,f(s.$t("auth.resetPw")),1),c(_,{label:s.$t("auth.email"),style:U(e(r)===1?"margin-bottom: 0;":""),prop:"email",class:"inputWrapper SignupInputAnim1"},{default:n(()=>[(p(),x(g,{key:e(r),modelValue:e(o).email,"onUpdate:modelValue":t[0]||(t[0]=i=>e(o).email=i),type:"email",size:"large","prefix-icon":e(D),readonly:e(r)>0,disabled:e(r)>0},null,8,["modelValue","prefix-icon","readonly","disabled"]))]),_:1},8,["label","style"]),e(r)===1?(p(),C("div",ae,[c(l,{type:"primary",onClick:I,style:{"font-size":"small"}},{default:n(()=>[c(y,{size:"small",class:"mr-1"},{default:n(()=>[c(e(G))]),_:1}),u("span",null,f(s.$t("action.change")),1)]),_:1})])):h("",!0),e(r)===1?(p(),x(_,{key:1,label:s.$t("auth.passwd"),prop:"password",class:"inputWrapper SignupInputAnim2 SignupPasswordInputWrapper"},{default:n(()=>[c(g,{modelValue:e(o).password,"onUpdate:modelValue":t[1]||(t[1]=i=>e(o).password=i),type:"password",size:"large","prefix-icon":e(H),formatter:i=>i.trim(),parser:i=>i.trim(),"show-password":""},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):h("",!0),e(r)===1?(p(),x(_,{key:2,label:s.$t("auth.veriCode"),prop:"veriCode",class:"inputWrapper SignupInputAnim2"},{default:n(()=>[c(g,{modelValue:e(o).veriCode,"onUpdate:modelValue":t[2]||(t[2]=i=>e(o).veriCode=i),type:"text",size:"large",maxLength:"6","prefix-icon":e(J)},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"])):h("",!0),e(r)===1&&!e(E)?(p(),C("div",se,[u("div",oe,[c(d,{type:"info",style:{"font-size":"small"}},{default:n(()=>[v(f(s.$t("auth.notReceiveVeriCode")),1)]),_:1}),c(l,{type:"primary",style:{"font-size":"small"},onClick:P},{default:n(()=>[v(f(s.$t("action.resend")),1)]),_:1})])])):h("",!0),re,e(r)===0?(p(),C("div",le,[c(V,{size:"large",type:"primary",onClick:t[3]||(t[3]=i=>b(e(w)))},{default:n(()=>[v(f(s.$t("auth.getVeriCode")),1)]),_:1})])):h("",!0),e(r)===1?(p(),C("div",ie,[c(V,{size:"large",type:"primary",onClick:t[4]||(t[4]=i=>q(e(w)))},{default:n(()=>[v(f(s.$t("action.submit")),1)]),_:1})])):h("",!0),ne,u("div",ce,[u("div",me,[c(l,{type:"primary",onClick:t[5]||(t[5]=i=>S())},{default:n(()=>[v(f(s.$t("action.back")),1)]),_:1})])]),de]),_:1},8,["model","rules"])]),_:1})}}});export{ze as default};
