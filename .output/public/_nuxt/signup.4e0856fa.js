import{E as F}from"./el-input.27303907.js";import{E as O,a as U}from"./el-form.82526620.js";import{f as W,g as M,r as k,m as $,i as P,o as d,j as x,w as l,b as a,a as p,t as f,n as j,k as e,c as C,q as y,d as g,E as c,s as z,v as D,x as H,y as G,z as J,aI as K,A as Q,B as X}from"./entry.60a981b0.js";import{E as Y}from"./el-link.f8a4c960.js";import{E as Z}from"./el-text.d1e666e3.js";import{E as ee}from"./el-button.937a3f62.js";import{_ as te}from"./nuxt-link.69d8bf5d.js";import{_ as ae}from"./LanguageSelect.afa46529.js";import{_ as se}from"./client-only.e7cce59c.js";/* empty css                */import{E as oe}from"./el-overlay.8234fffe.js";import{u as re}from"./useAuth.4554ef87.js";import{u as le}from"./useTitle.5a79fd11.js";import"./isEqual.402a2aab.js";import"./_initCloneObject.f5ee12ff.js";import"./el-popper.78981021.js";import"./focus-trap.45b2fae2.js";import"./el-scrollbar.607bccfd.js";import"./scroll.22698584.js";import"./useChat.fb420c67.js";import"./str.d457f5f4.js";const ne={class:"mt-0 mb-6"},ie={key:0,class:"-mt-1 mb-2 w-full text-right"},ue={key:4,class:"flex-center flex-col gap-1 w-full"},me={class:"flex justify-end gap-1 w-full"},pe=p("div",{class:"p-6"},null,-1),ce={key:5,class:"flex-center"},de={key:6,class:"flex-center"},fe=p("div",{class:"p-2"},null,-1),ge={class:"flex-center flex-col gap-1"},_e={class:"flex-center flex-wrap gap-1",style:{"line-height":"1rem"}},he={style:{"line-height":"1rem"},class:"mt-2 text-center"},ye=p("div",{class:"p-8"},null,-1),ve={class:"absolute w-screen flex-center gap-2 p-3",style:{bottom:"0"}},xe={style:{width:"120px"}},je=W({__name:"signup",setup(we){const I=re(),t=M().t,V=k(!1),i=k(0),w=k(),n=$({email:"",username:"",password:"",veriCode:""}),S=$({email:[{required:!0,message:t("auth.emailRequired"),trigger:"change"},{type:"email",message:t("auth.emailInvalid"),trigger:"change"}],username:[{required:!0,message:t("auth.usernameRequired"),trigger:"change"},{min:5,max:32,message:t("auth.usernameLength"),trigger:"change"}],password:[{required:!0,message:t("auth.passwdRequired"),trigger:"change"},{min:8,max:64,message:t("auth.passwdLength"),trigger:"change"}],veriCode:[{required:!0,message:t("auth.veriCodeRequired"),trigger:"change"},{min:6,max:6,message:t("auth.veriCodeRequired"),trigger:"change"}]}),q=()=>{oe.confirm(t("auth.confirmChangeEmail"),"",{confirmButtonText:t("message.ok"),cancelButtonText:t("message.cancel"),type:"warning"}).then(()=>{i.value=0,n.email="",n.veriCode="",c.success(t("action.opExecuted"))}).catch(()=>{c.info(t("action.opCanceled"))})},A=()=>{V.value=!0,b(w.value,!0)},b=async(s,o=!1)=>{await s.validate((_,h)=>{if(_||o){const v=z.service({text:t("auth.sendingVeriCode")});$fetch(o?"/api/auth/resendCode":"/api/auth/createVerification",{method:"POST",body:{email:n.email}}).then(u=>{const m=u;m!=null&&m.error?c.error(m==null?void 0:m.error):(c.success("Email sent, please check your inbox."),i.value=1)}).catch(()=>{c.error("Oops! Something went wrong.")}).finally(()=>{v.close()})}else c.error(t("auth.formIncomplete"))})},B=async s=>{await s.validate((o,_)=>{if(o){const h=z.service({text:t("auth.sendingVeriCode")});$fetch("/api/auth/signup",{method:"POST",body:{email:n.email,username:n.username,password:n.password,code:n.veriCode}}).then(v=>{const u=v;u!=null&&u.error?c.error(u==null?void 0:u.error):(c.success("Sign up successful."),D("/c/"),I.setIsLoggedIn(!0))}).catch(()=>{c.error("Oops! Something went wrong.")}).finally(()=>{h.close()})}else c.error(t("auth.formIncomplete"))})};return le(`${t("auth.signup")} - ${P("appName").value}`),(s,o)=>{const _=F,h=O,v=H,u=Y,m=Z,E=ee,L=te,T=U,R=ae,N=se;return d(),x(N,null,{default:l(()=>[a(T,{ref_key:"ruleFormRef",ref:w,model:e(n),rules:e(S),"label-position":"top",class:"flex-col flex-center w-full max-w-xs px-4 m-auto",style:{height:"calc(100vh - 56px)"}},{default:l(()=>[p("h1",ne,f(s.$t("auth.signup")),1),a(h,{label:s.$t("auth.email"),style:j(e(i)===1?"margin-bottom: 0;":""),prop:"email",class:"inputWrapper SignupInputAnim1"},{default:l(()=>[(d(),x(_,{key:e(i),modelValue:e(n).email,"onUpdate:modelValue":o[0]||(o[0]=r=>e(n).email=r),type:"email",size:"large","prefix-icon":e(G),readonly:e(i)>0,disabled:e(i)>0},null,8,["modelValue","prefix-icon","readonly","disabled"]))]),_:1},8,["label","style"]),e(i)===1?(d(),C("div",ie,[a(u,{type:"primary",onClick:q,style:{"font-size":"small"}},{default:l(()=>[a(v,{size:"small",class:"mr-1"},{default:l(()=>[a(e(J))]),_:1}),p("span",null,f(s.$t("action.change")),1)]),_:1})])):y("",!0),e(i)===1?(d(),x(h,{key:1,label:s.$t("auth.username"),prop:"username",class:"inputWrapper SignupInputAnim1"},{default:l(()=>[a(_,{modelValue:e(n).username,"onUpdate:modelValue":o[1]||(o[1]=r=>e(n).username=r),type:"text",size:"large","prefix-icon":e(K),formatter:r=>r.replace(/[^\w]+/g,""),parser:r=>r.replace(/[^\w]+/g,"")},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):y("",!0),e(i)===1?(d(),x(h,{key:2,label:s.$t("auth.passwd"),prop:"password",class:"inputWrapper SignupInputAnim2 SignupPasswordInputWrapper"},{default:l(()=>[a(_,{modelValue:e(n).password,"onUpdate:modelValue":o[2]||(o[2]=r=>e(n).password=r),type:"password",size:"large","prefix-icon":e(Q),formatter:r=>r.trim(),parser:r=>r.trim(),"show-password":""},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):y("",!0),e(i)===1?(d(),x(h,{key:3,label:s.$t("auth.veriCode"),prop:"veriCode",class:"inputWrapper SignupInputAnim2"},{default:l(()=>[a(_,{modelValue:e(n).veriCode,"onUpdate:modelValue":o[3]||(o[3]=r=>e(n).veriCode=r),type:"text",size:"large",maxLength:"6","prefix-icon":e(X)},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"])):y("",!0),e(i)===1&&!e(V)?(d(),C("div",ue,[p("div",me,[a(m,{type:"info",style:{"font-size":"small"}},{default:l(()=>[g(f(s.$t("auth.notReceiveVeriCode")),1)]),_:1}),a(u,{type:"primary",style:{"font-size":"small"},onClick:A},{default:l(()=>[g(f(s.$t("action.resend")),1)]),_:1})])])):y("",!0),pe,e(i)===0?(d(),C("div",ce,[a(E,{size:"large",type:"primary",onClick:o[4]||(o[4]=r=>b(e(w)))},{default:l(()=>[g(f(s.$t("auth.getVeriCode")),1)]),_:1})])):y("",!0),e(i)===1?(d(),C("div",de,[a(E,{size:"large",type:"primary",onClick:o[5]||(o[5]=r=>B(e(w)))},{default:l(()=>[g(f(s.$t("auth.signup")),1)]),_:1})])):y("",!0),fe,p("div",ge,[p("div",_e,[a(m,{type:"info"},{default:l(()=>[g(f(s.$t("auth.alreadyHaveAnAcc")),1)]),_:1}),a(u,{type:"primary"},{default:l(()=>[a(L,{to:"/login"},{default:l(()=>[g(f(s.$t("auth.login")),1)]),_:1})]),_:1})])]),p("div",he,[a(m,{size:"small",type:"info"},{default:l(()=>[g(f(s.$t("auth.loginTip1")),1)]),_:1})]),ye]),_:1},8,["model","rules"]),p("div",ve,[a(m,{type:"info",class:"opacity-75"},{default:l(()=>[g("More languages:")]),_:1}),p("span",xe,[a(R,{size:"small"})])])]),_:1})}}});export{je as default};
