var rn=Object.defineProperty;var sn=(e,t,r)=>t in e?rn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var we=(e,t,r)=>(sn(e,typeof t!="symbol"?t+"":t,r),r);import{a4 as Ct,a6 as an,b4 as St,a3 as ot,i as ln,Z as Bt,c5 as cn,aY as Tt,c6 as rt,q as ee,c7 as un,aw as fn,c8 as dn,av as hn,bK as He,af as me,aE as vn,V as mn,W as st,K as At,b as Q,a7 as je,au as pn,a8 as gn,m as yn,c9 as wn,ca as bn,a2 as se,r as W,n as Fe,cb as at,aU as it,ao as En,az as ae,o as j,g as K,w as Y,ak as Re,a as X,D as O,s as lt,aB as be,c as $e,am as Ee,A as ie,t as ue,b5 as Ce,d as Le,aA as Oe,as as Cn,ab as kt,cc as xt,cd as _t,at as ct,ah as Sn,ad as Bn,aC as ut,bx as ft,ce as Tn,cf as te,cg as Mt,f as dt,ch as An,L as kn,E as G,aI as _e,ci as Ye,aH as ht,cj as xn,j as It}from"./entry.419529d0.js";import{E as _n}from"./el-button.8b05df2a.js";import{t as Mn,E as In}from"./el-input.2504c3ea.js";import{u as Se}from"./useTitle.becf5c34.js";import{E as Hn,i as Rn}from"./focus-trap.0afcbbbd.js";import{a as $n}from"./scroll.079c3b0b.js";const Ln='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',On=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,vt=e=>Array.from(e.querySelectorAll(Ln)).filter(t=>Nn(t)&&On(t)),Nn=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}};var ke=(e=>(e[e.TEXT=1]="TEXT",e[e.CLASS=2]="CLASS",e[e.STYLE=4]="STYLE",e[e.PROPS=8]="PROPS",e[e.FULL_PROPS=16]="FULL_PROPS",e[e.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",e[e.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",e[e.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",e[e.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",e[e.NEED_PATCH=512]="NEED_PATCH",e[e.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",e[e.HOISTED=-1]="HOISTED",e[e.BAIL=-2]="BAIL",e))(ke||{});const Dn=(e,t,r)=>{let s={offsetX:0,offsetY:0};const i=b=>{const C=b.clientX,n=b.clientY,{offsetX:T,offsetY:k}=s,w=e.value.getBoundingClientRect(),I=w.left,M=w.top,S=w.width,g=w.height,B=document.documentElement.clientWidth,a=document.documentElement.clientHeight,o=-I+T,l=-M+k,m=B-I-S+T,f=a-M-g+k,y=A=>{const E=Math.min(Math.max(T+A.clientX-C,o),m),_=Math.min(Math.max(k+A.clientY-n,l),f);s={offsetX:E,offsetY:_},e.value.style.transform=`translate(${ot(E)}, ${ot(_)})`},x=()=>{document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",x)};document.addEventListener("mousemove",y),document.addEventListener("mouseup",x)},c=()=>{t.value&&e.value&&t.value.addEventListener("mousedown",i)},p=()=>{t.value&&e.value&&t.value.removeEventListener("mousedown",i)};Ct(()=>{an(()=>{r.value?c():p()})}),St(()=>{p()})},zn=(e,t={})=>{ln(e)||Mn("[useLockscreen]","You need to pass a ref param to this function");const r=t.ns||Bt("popup"),s=cn(()=>r.bm("parent","hidden"));if(!Tt||rt(document.body,s.value))return;let i=0,c=!1,p="0";const b=()=>{setTimeout(()=>{hn(document==null?void 0:document.body,s.value),c&&document&&(document.body.style.width=p)},200)};ee(e,C=>{if(!C){b();return}c=!rt(document.body,s.value),c&&(p=document.body.style.width),i=$n(r.namespace.value);const n=document.documentElement.clientHeight<document.body.scrollHeight,T=un(document.body,"overflowY");i>0&&(n||T==="scroll")&&c&&(document.body.style.width=`calc(100% - ${i}px)`),fn(document.body,s.value)}),dn(()=>b())},Ht=e=>{if(!e)return{onClick:He,onMousedown:He,onMouseup:He};let t=!1,r=!1;return{onClick:p=>{t&&r&&e(p),t=r=!1},onMousedown:p=>{t=p.target===p.currentTarget},onMouseup:p=>{r=p.target===p.currentTarget}}},Xe="_trap-focus-children",ne=[],mt=e=>{if(ne.length===0)return;const t=ne[ne.length-1][Xe];if(t.length>0&&e.code===vn.tab){if(t.length===1){e.preventDefault(),document.activeElement!==t[0]&&t[0].focus();return}const r=e.shiftKey,s=e.target===t[0],i=e.target===t[t.length-1];s&&r&&(e.preventDefault(),t[t.length-1].focus()),i&&!r&&(e.preventDefault(),t[0].focus())}},Wn={beforeMount(e){e[Xe]=vt(e),ne.push(e),ne.length<=1&&document.addEventListener("keydown",mt)},updated(e){me(()=>{e[Xe]=vt(e)})},unmounted(){ne.shift(),ne.length===0&&document.removeEventListener("keydown",mt)}},Pn=mn({mask:{type:Boolean,default:!0},customMaskEvent:{type:Boolean,default:!1},overlayClass:{type:st([String,Array,Object])},zIndex:{type:st([String,Number])}}),Un={click:e=>e instanceof MouseEvent},Vn="overlay";var qn=At({name:"ElOverlay",props:Pn,emits:Un,setup(e,{slots:t,emit:r}){const s=Bt(Vn),i=C=>{r("click",C)},{onClick:c,onMousedown:p,onMouseup:b}=Ht(e.customMaskEvent?void 0:i);return()=>e.mask?Q("div",{class:[s.b(),e.overlayClass],style:{zIndex:e.zIndex},onClick:c,onMousedown:p,onMouseup:b},[je(t,"default")],ke.STYLE|ke.CLASS|ke.PROPS,["onClick","onMouseup","onMousedown"]):pn("div",{class:e.overlayClass,style:{zIndex:e.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[je(t,"default")])}});const jn=qn,Yn=At({name:"ElMessageBox",directives:{TrapFocus:Wn},components:{ElButton:_n,ElFocusTrap:Hn,ElInput:In,ElOverlay:jn,ElIcon:yn,...wn},inheritAttrs:!1,props:{buttonSize:{type:String,validator:Rn},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:t}){const{locale:r,zIndex:s,ns:i,size:c}=bn("message-box",se(()=>e.buttonSize)),{t:p}=r,{nextZIndex:b}=s,C=W(!1),n=Fe({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:null,inputValidator:null,inputErrorMessage:"",message:null,modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:b()}),T=se(()=>{const H=n.type;return{[i.bm("icon",H)]:H&&at[H]}}),k=it(),w=it(),I=se(()=>n.icon||at[n.type]||""),M=se(()=>!!n.message),S=W(),g=W(),B=W(),a=W(),o=W(),l=se(()=>n.confirmButtonClass);ee(()=>n.inputValue,async H=>{await me(),e.boxType==="prompt"&&H!==null&&_()},{immediate:!0}),ee(()=>C.value,H=>{var $,D;H&&(e.boxType!=="prompt"&&(n.autofocus?B.value=(D=($=o.value)==null?void 0:$.$el)!=null?D:S.value:B.value=S.value),n.zIndex=b()),e.boxType==="prompt"&&(H?me().then(()=>{var L;a.value&&a.value.$el&&(n.autofocus?B.value=(L=R())!=null?L:S.value:B.value=S.value)}):(n.editorErrorMessage="",n.validateError=!1))});const m=se(()=>e.draggable);Dn(S,g,m),Ct(async()=>{await me(),e.closeOnHashChange&&window.addEventListener("hashchange",f)}),St(()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",f)});function f(){C.value&&(C.value=!1,me(()=>{n.action&&t("action",n.action)}))}const y=()=>{e.closeOnClickModal&&E(n.distinguishCancelAndClose?"close":"cancel")},x=Ht(y),A=H=>{if(n.inputType!=="textarea")return H.preventDefault(),E("confirm")},E=H=>{var $;e.boxType==="prompt"&&H==="confirm"&&!_()||(n.action=H,n.beforeClose?($=n.beforeClose)==null||$.call(n,H,n,f):f())},_=()=>{if(e.boxType==="prompt"){const H=n.inputPattern;if(H&&!H.test(n.inputValue||""))return n.editorErrorMessage=n.inputErrorMessage||p("el.messagebox.error"),n.validateError=!0,!1;const $=n.inputValidator;if(typeof $=="function"){const D=$(n.inputValue);if(D===!1)return n.editorErrorMessage=n.inputErrorMessage||p("el.messagebox.error"),n.validateError=!0,!1;if(typeof D=="string")return n.editorErrorMessage=D,n.validateError=!0,!1}}return n.editorErrorMessage="",n.validateError=!1,!0},R=()=>{const H=a.value.$refs;return H.input||H.textarea},U=()=>{E("close")},P=()=>{e.closeOnPressEscape&&U()};return e.lockScroll&&zn(C),{...En(n),ns:i,overlayEvent:x,visible:C,hasMessage:M,typeClass:T,contentId:k,inputId:w,btnSize:c,iconComponent:I,confirmButtonClasses:l,rootRef:S,focusStartRef:B,headerRef:g,inputRef:a,confirmRef:o,doClose:f,handleClose:U,onCloseRequested:P,handleWrapperClick:y,handleInputEnter:A,handleAction:E,t:p}}}),Xn=["aria-label","aria-describedby"],Kn=["aria-label"],Gn=["id"];function Fn(e,t,r,s,i,c){const p=ae("el-icon"),b=ae("close"),C=ae("el-input"),n=ae("el-button"),T=ae("el-focus-trap"),k=ae("el-overlay");return j(),K(Cn,{name:"fade-in-linear",onAfterLeave:t[11]||(t[11]=w=>e.$emit("vanish")),persisted:""},{default:Y(()=>[Re(Q(k,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:Y(()=>[X("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:O(`${e.ns.namespace.value}-overlay-message-box`),onClick:t[8]||(t[8]=(...w)=>e.overlayEvent.onClick&&e.overlayEvent.onClick(...w)),onMousedown:t[9]||(t[9]=(...w)=>e.overlayEvent.onMousedown&&e.overlayEvent.onMousedown(...w)),onMouseup:t[10]||(t[10]=(...w)=>e.overlayEvent.onMouseup&&e.overlayEvent.onMouseup(...w))},[Q(T,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:Y(()=>[X("div",{ref:"rootRef",class:O([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),{[e.ns.m("center")]:e.center}]),style:lt(e.customStyle),tabindex:"-1",onClick:t[7]||(t[7]=be(()=>{},["stop"]))},[e.title!==null&&e.title!==void 0?(j(),$e("div",{key:0,ref:"headerRef",class:O(e.ns.e("header"))},[X("div",{class:O(e.ns.e("title"))},[e.iconComponent&&e.center?(j(),K(p,{key:0,class:O([e.ns.e("status"),e.typeClass])},{default:Y(()=>[(j(),K(Ee(e.iconComponent)))]),_:1},8,["class"])):ie("v-if",!0),X("span",null,ue(e.title),1)],2),e.showClose?(j(),$e("button",{key:0,type:"button",class:O(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:t[0]||(t[0]=w=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel")),onKeydown:t[1]||(t[1]=Ce(be(w=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"]))},[Q(p,{class:O(e.ns.e("close"))},{default:Y(()=>[Q(b)]),_:1},8,["class"])],42,Kn)):ie("v-if",!0)],2)):ie("v-if",!0),X("div",{id:e.contentId,class:O(e.ns.e("content"))},[X("div",{class:O(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?(j(),K(p,{key:0,class:O([e.ns.e("status"),e.typeClass])},{default:Y(()=>[(j(),K(Ee(e.iconComponent)))]),_:1},8,["class"])):ie("v-if",!0),e.hasMessage?(j(),$e("div",{key:1,class:O(e.ns.e("message"))},[je(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?(j(),K(Ee(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):(j(),K(Ee(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0},{default:Y(()=>[Le(ue(e.dangerouslyUseHTMLString?"":e.message),1)]),_:1},8,["for"]))])],2)):ie("v-if",!0)],2),Re(X("div",{class:O(e.ns.e("input"))},[Q(C,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":t[2]||(t[2]=w=>e.inputValue=w),type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:O({invalid:e.validateError}),onKeydown:Ce(e.handleInputEnter,["enter"])},null,8,["id","modelValue","type","placeholder","aria-invalid","class","onKeydown"]),X("div",{class:O(e.ns.e("errormsg")),style:lt({visibility:e.editorErrorMessage?"visible":"hidden"})},ue(e.editorErrorMessage),7)],2),[[Oe,e.showInput]])],10,Gn),X("div",{class:O(e.ns.e("btns"))},[e.showCancelButton?(j(),K(n,{key:0,loading:e.cancelButtonLoading,class:O([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:t[3]||(t[3]=w=>e.handleAction("cancel")),onKeydown:t[4]||(t[4]=Ce(be(w=>e.handleAction("cancel"),["prevent"]),["enter"]))},{default:Y(()=>[Le(ue(e.cancelButtonText||e.t("el.messagebox.cancel")),1)]),_:1},8,["loading","class","round","size"])):ie("v-if",!0),Re(Q(n,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,class:O([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:t[5]||(t[5]=w=>e.handleAction("confirm")),onKeydown:t[6]||(t[6]=Ce(be(w=>e.handleAction("confirm"),["prevent"]),["enter"]))},{default:Y(()=>[Le(ue(e.confirmButtonText||e.t("el.messagebox.confirm")),1)]),_:1},8,["loading","class","round","disabled","size"]),[[Oe,e.showConfirmButton]])],2)],6)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,Xn)]),_:3},8,["z-index","overlay-class","mask"]),[[Oe,e.visible]])]),_:3})}var Qn=gn(Yn,[["render",Fn],["__file","/home/runner/work/element-plus/element-plus/packages/components/message-box/src/index.vue"]]);const ge=new Map,Jn=e=>{let t=document.body;return e.appendTo&&(kt(e.appendTo)&&(t=document.querySelector(e.appendTo)),ft(e.appendTo)&&(t=e.appendTo),ft(t)||(t=document.body)),t},Zn=(e,t,r=null)=>{const s=Q(Qn,e,ut(e.message)||xt(e.message)?{default:ut(e.message)?e.message:()=>e.message}:null);return s.appContext=r,_t(s,t),Jn(e).appendChild(t.firstElementChild),s.component},eo=()=>document.createElement("div"),to=(e,t)=>{const r=eo();e.onVanish=()=>{_t(null,r),ge.delete(i)},e.onAction=c=>{const p=ge.get(i);let b;e.showInput?b={value:i.inputValue,action:c}:b=c,e.callback?e.callback(b,s.proxy):c==="cancel"||c==="close"?e.distinguishCancelAndClose&&c!=="cancel"?p.reject("close"):p.reject("cancel"):p.resolve(b)};const s=Zn(e,r,t),i=s.proxy;for(const c in e)ct(e,c)&&!ct(i.$props,c)&&(i[c]=e[c]);return i.visible=!0,i};function ce(e,t=null){if(!Tt)return Promise.reject();let r;return kt(e)||xt(e)?e={message:e}:r=e.callback,new Promise((s,i)=>{const c=to(e,t??ce._context);ge.set(c,{options:e,callback:r,resolve:s,reject:i})})}const no=["alert","confirm","prompt"],oo={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};no.forEach(e=>{ce[e]=ro(e)});function ro(e){return(t,r,s,i)=>{let c="";return Sn(r)?(s=r,c=""):Bn(r)?c="":c=r,ce(Object.assign({title:c,message:t,type:"",...oo[e]},s,{boxType:e}),i)}}ce.close=()=>{ge.forEach((e,t)=>{t.doClose()}),ge.clear()};ce._context=null;const F=ce;F.install=e=>{F._context=e._context,e.config.globalProperties.$msgbox=F,e.config.globalProperties.$messageBox=F,e.config.globalProperties.$alert=F.alert,e.config.globalProperties.$confirm=F.confirm,e.config.globalProperties.$prompt=F.prompt};const Ne=F,so={},ao=Object.freeze(Object.defineProperty({__proto__:null,default:so},Symbol.toStringTag,{value:"Module"})),io=Tn(ao);async function J(e=0){return await new Promise((t,r)=>{setTimeout(()=>{try{window.scrollTo(0,document.body.scrollHeight),t(null)}catch(s){r(s)}},+e||0)})}const lo={get isMobileScreen(){return window.innerWidth<600},get isTouchScreen(){return"ontouchstart"in document||navigator.maxTouchPoints>0}};function pt(){return lo}const gt="web-browsing",yt="temperature-suffix",De="temperature",Ie=e=>(e==null?void 0:e.toString)===void 0?"":e.toString(),co=e=>Ie(e).toLowerCase(),Rt="01",$t="0123456789",Lt="0123456789abcdef",Ot="0123456789abcdefghijklmnopqrstuvwxyz",Nt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Dt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",Ke=e=>{switch(typeof e!="string"&&(e=co(e)),e){case"2":return Rt;case"10":return $t;case"16":return Lt;case"36":return Ot;case"62":return Nt;case"64":return oe;case"64w":case"64+":return Dt;default:return e}},uo=(e,t,r,s=0)=>{typeof e!="string"&&(e=Ie(e));let i=BigInt(0);t=Ke(t);const c=t.length;for(let b=0;b<e.length;b++)i+=BigInt(t.indexOf(e[b])*Math.pow(c,e.length-1-b));let p="";if(r=Ke(r),p===""){const b=BigInt(r.length);for(;i>0;)p=r.charAt(+BigInt(i%b).toString())+p,i=BigInt(i/b)}return(p===""?r.charAt(0):p).padStart(s,r[0])},fo=e=>{const t=e.split("").map(c=>c.charCodeAt(0)),r=[];let s=0;for(;s<t.length;){const[c,p=0,b=0]=t.slice(s,s+=3),C=(c<<16)+(p<<8)+b,n=C>>18,T=C>>12&63,k=C>>6&63,w=C&63;r.push(oe[n],oe[T],oe[k],oe[w])}const i=t.length%3;return r.join("").slice(0,1+r.length-i)+(i===2?"==":i===1?"=":"")},ho=/[^A-Za-z0-9+/]/g,zt=e=>e.replace(ho,""),ze=e=>String.fromCharCode(+e),vo=e=>{const t=zt(e).split(""),r=[];let s=0;for(;s<t.length;){const[i,c,p,b]=t.slice(s,s+=4).map(C=>oe.indexOf(C));r.push(ze(i<<2|c>>4)),p!==64&&r.push(ze((c&15)<<4|p>>2)),b!==64&&r.push(ze((p&3)<<6|b))}return r.join("").replaceAll("\0","")},le={BASE2_CHARSET:Rt,BASE10_CHARSET:$t,BASE16_CHARSET:Lt,BASE36_CHARSET:Ot,BASE62_CHARSET:Nt,BASE64_CHARSET:oe,BASE64WEB_CHARSET:Dt,convert:uo,getCharset:Ke,secureBase64:zt,textToBase64:fo,base64ToText:vo};var Wt={exports:{}};function mo(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var We={exports:{}},wt;function Qe(){return wt||(wt=1,function(e,t){(function(r,s){e.exports=s()})(te,function(){var r=r||function(s,i){var c;if(typeof window<"u"&&window.crypto&&(c=window.crypto),typeof self<"u"&&self.crypto&&(c=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(c=globalThis.crypto),!c&&typeof window<"u"&&window.msCrypto&&(c=window.msCrypto),!c&&typeof te<"u"&&te.crypto&&(c=te.crypto),!c&&typeof mo=="function")try{c=io}catch{}var p=function(){if(c){if(typeof c.getRandomValues=="function")try{return c.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof c.randomBytes=="function")try{return c.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},b=Object.create||function(){function a(){}return function(o){var l;return a.prototype=o,l=new a,a.prototype=null,l}}(),C={},n=C.lib={},T=n.Base=function(){return{extend:function(a){var o=b(this);return a&&o.mixIn(a),(!o.hasOwnProperty("init")||this.init===o.init)&&(o.init=function(){o.$super.init.apply(this,arguments)}),o.init.prototype=o,o.$super=this,o},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var o in a)a.hasOwnProperty(o)&&(this[o]=a[o]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),k=n.WordArray=T.extend({init:function(a,o){a=this.words=a||[],o!=i?this.sigBytes=o:this.sigBytes=a.length*4},toString:function(a){return(a||I).stringify(this)},concat:function(a){var o=this.words,l=a.words,m=this.sigBytes,f=a.sigBytes;if(this.clamp(),m%4)for(var y=0;y<f;y++){var x=l[y>>>2]>>>24-y%4*8&255;o[m+y>>>2]|=x<<24-(m+y)%4*8}else for(var A=0;A<f;A+=4)o[m+A>>>2]=l[A>>>2];return this.sigBytes+=f,this},clamp:function(){var a=this.words,o=this.sigBytes;a[o>>>2]&=4294967295<<32-o%4*8,a.length=s.ceil(o/4)},clone:function(){var a=T.clone.call(this);return a.words=this.words.slice(0),a},random:function(a){for(var o=[],l=0;l<a;l+=4)o.push(p());return new k.init(o,a)}}),w=C.enc={},I=w.Hex={stringify:function(a){for(var o=a.words,l=a.sigBytes,m=[],f=0;f<l;f++){var y=o[f>>>2]>>>24-f%4*8&255;m.push((y>>>4).toString(16)),m.push((y&15).toString(16))}return m.join("")},parse:function(a){for(var o=a.length,l=[],m=0;m<o;m+=2)l[m>>>3]|=parseInt(a.substr(m,2),16)<<24-m%8*4;return new k.init(l,o/2)}},M=w.Latin1={stringify:function(a){for(var o=a.words,l=a.sigBytes,m=[],f=0;f<l;f++){var y=o[f>>>2]>>>24-f%4*8&255;m.push(String.fromCharCode(y))}return m.join("")},parse:function(a){for(var o=a.length,l=[],m=0;m<o;m++)l[m>>>2]|=(a.charCodeAt(m)&255)<<24-m%4*8;return new k.init(l,o)}},S=w.Utf8={stringify:function(a){try{return decodeURIComponent(escape(M.stringify(a)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(a){return M.parse(unescape(encodeURIComponent(a)))}},g=n.BufferedBlockAlgorithm=T.extend({reset:function(){this._data=new k.init,this._nDataBytes=0},_append:function(a){typeof a=="string"&&(a=S.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(a){var o,l=this._data,m=l.words,f=l.sigBytes,y=this.blockSize,x=y*4,A=f/x;a?A=s.ceil(A):A=s.max((A|0)-this._minBufferSize,0);var E=A*y,_=s.min(E*4,f);if(E){for(var R=0;R<E;R+=y)this._doProcessBlock(m,R);o=m.splice(0,E),l.sigBytes-=_}return new k.init(o,_)},clone:function(){var a=T.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});n.Hasher=g.extend({cfg:T.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var o=this._doFinalize();return o},blockSize:16,_createHelper:function(a){return function(o,l){return new a.init(l).finalize(o)}},_createHmacHelper:function(a){return function(o,l){return new B.HMAC.init(a,l).finalize(o)}}});var B=C.algo={};return C}(Math);return r})}(We)),We.exports}var Pe={exports:{}},bt;function po(){return bt||(bt=1,function(e,t){(function(r,s){e.exports=s(Qe())})(te,function(r){return function(s){var i=r,c=i.lib,p=c.Base,b=c.WordArray,C=i.x64={};C.Word=p.extend({init:function(n,T){this.high=n,this.low=T}}),C.WordArray=p.extend({init:function(n,T){n=this.words=n||[],T!=s?this.sigBytes=T:this.sigBytes=n.length*8},toX32:function(){for(var n=this.words,T=n.length,k=[],w=0;w<T;w++){var I=n[w];k.push(I.high),k.push(I.low)}return b.create(k,this.sigBytes)},clone:function(){for(var n=p.clone.call(this),T=n.words=this.words.slice(0),k=T.length,w=0;w<k;w++)T[w]=T[w].clone();return n}})}(),r})}(Pe)),Pe.exports}(function(e,t){(function(r,s,i){e.exports=s(Qe(),po())})(te,function(r){return function(s){var i=r,c=i.lib,p=c.WordArray,b=c.Hasher,C=i.x64,n=C.Word,T=i.algo,k=[],w=[],I=[];(function(){for(var g=1,B=0,a=0;a<24;a++){k[g+5*B]=(a+1)*(a+2)/2%64;var o=B%5,l=(2*g+3*B)%5;g=o,B=l}for(var g=0;g<5;g++)for(var B=0;B<5;B++)w[g+5*B]=B+(2*g+3*B)%5*5;for(var m=1,f=0;f<24;f++){for(var y=0,x=0,A=0;A<7;A++){if(m&1){var E=(1<<A)-1;E<32?x^=1<<E:y^=1<<E-32}m&128?m=m<<1^113:m<<=1}I[f]=n.create(y,x)}})();var M=[];(function(){for(var g=0;g<25;g++)M[g]=n.create()})();var S=T.SHA3=b.extend({cfg:b.cfg.extend({outputLength:512}),_doReset:function(){for(var g=this._state=[],B=0;B<25;B++)g[B]=new n.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(g,B){for(var a=this._state,o=this.blockSize/2,l=0;l<o;l++){var m=g[B+2*l],f=g[B+2*l+1];m=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,f=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360;var y=a[l];y.high^=f,y.low^=m}for(var x=0;x<24;x++){for(var A=0;A<5;A++){for(var E=0,_=0,R=0;R<5;R++){var y=a[A+5*R];E^=y.high,_^=y.low}var U=M[A];U.high=E,U.low=_}for(var A=0;A<5;A++)for(var P=M[(A+4)%5],H=M[(A+1)%5],$=H.high,D=H.low,E=P.high^($<<1|D>>>31),_=P.low^(D<<1|$>>>31),R=0;R<5;R++){var y=a[A+5*R];y.high^=E,y.low^=_}for(var L=1;L<25;L++){var E,_,y=a[L],V=y.high,q=y.low,u=k[L];u<32?(E=V<<u|q>>>32-u,_=q<<u|V>>>32-u):(E=q<<u-32|V>>>64-u,_=V<<u-32|q>>>64-u);var d=M[w[L]];d.high=E,d.low=_}var h=M[0],v=a[0];h.high=v.high,h.low=v.low;for(var A=0;A<5;A++)for(var R=0;R<5;R++){var L=A+5*R,y=a[L],Ze=M[L],et=M[(A+1)%5+5*R],tt=M[(A+2)%5+5*R];y.high=Ze.high^~et.high&tt.high,y.low=Ze.low^~et.low&tt.low}var y=a[0],nt=I[x];y.high^=nt.high,y.low^=nt.low}},_doFinalize:function(){var g=this._data,B=g.words;this._nDataBytes*8;var a=g.sigBytes*8,o=this.blockSize*32;B[a>>>5]|=1<<24-a%32,B[(s.ceil((a+1)/o)*o>>>5)-1]|=128,g.sigBytes=B.length*4,this._process();for(var l=this._state,m=this.cfg.outputLength/8,f=m/8,y=[],x=0;x<f;x++){var A=l[x],E=A.high,_=A.low;E=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,_=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,y.push(_),y.push(E)}return new p.init(y,m)},clone:function(){for(var g=b.clone.call(this),B=g._state=this._state.slice(0),a=0;a<25;a++)B[a]=B[a].clone();return g}});i.SHA3=b._createHelper(S),i.HmacSHA3=b._createHmacHelper(S)}(Math),r.SHA3})})(Wt);var go=Wt.exports;const Pt=Mt(go);function yo(...e){return e.reduce((t,r)=>t+r,0)}function wo(e){try{return typeof e[Symbol==null?void 0:Symbol.iterator]=="function"}catch{return!1}}function Ut(e){const t=new Set;return JSON.stringify(e,(s,i)=>{if(typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i),wo(i)&&(i=[...i])}return i})}const bo=e=>Pt(e,{outputLength:256}).toString(),Eo=/0b[0-1]+/i;function ye(e){if(typeof e=="number")return Math.round(e);if(e instanceof Object&&(e=Ut(e)),typeof e=="string"){if(Eo.test(e))return parseInt(e.substring(2,e.length-1),2);const t=parseInt(e);return Number.isNaN(t)?t:yo(parseInt(bo(e),16))}else return Date.now()}const N=624,Be=397,Co=2567483615,Ue=2147483648,Ve=2147483647;class So{constructor(t){we(this,"mt",new Array(N));we(this,"mti",N+1);we(this,"seed");return this.seed=t=ye(t),Array.isArray(t)?this.init_by_array(t,t.length):this.init_seed(t),this}init_seed(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<N;this.mti++)t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(((t&4294901760)>>>16)*1812433253<<16)+(t&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}init_by_array(t,r){let s,i,c;for(this.init_seed(19650218),s=1,i=0,c=N>r?N:r;c!==0;c--){const p=this.mt[s-1]^this.mt[s-1]>>>30;this.mt[s]=(this.mt[s]^(((p&4294901760)>>>16)*1664525<<16)+(p&65535)*1664525)+t[i]+i,this.mt[s]>>>=0,s++,i++,s>=N&&(this.mt[0]=this.mt[N-1],s=1),i>=r&&(i=0)}for(c=N-1;c!==0;c--){const p=this.mt[s-1]^this.mt[s-1]>>>30;this.mt[s]=(this.mt[s]^(((p&4294901760)>>>16)*1566083941<<16)+(p&65535)*1566083941)-s,this.mt[s]>>>=0,s++,s>=N&&(this.mt[0]=this.mt[N-1],s=1)}this.mt[0]=2147483648}random_int(){let t;const r=new Array(0,Co);if(this.mti>=N){let s;for(this.mti===N+1&&this.init_seed(5489),s=0;s<N-Be;s++)t=this.mt[s]&Ue|this.mt[s+1]&Ve,this.mt[s]=this.mt[s+Be]^t>>>1^r[t&1];for(;s<N-1;s++)t=this.mt[s]&Ue|this.mt[s+1]&Ve,this.mt[s]=this.mt[s+(Be-N)]^t>>>1^r[t&1];t=this.mt[N-1]&Ue|this.mt[0]&Ve,this.mt[N-1]=this.mt[Be-1]^t>>>1^r[t&1],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0}random_int31(){return this.random_int()>>>1}random_incl(){return this.random_int()*(1/4294967295)}random(){return this.random_int()*(1/4294967296)}random_excl(){return(this.random_int()+.5)*(1/4294967296)}random_long(){return((this.random_int()>>>5)*67108864+(this.random_int()>>>6))*(1/9007199254740992)}}function Vt(e){return new So(e)}const{BASE10_CHARSET:Bo,BASE16_CHARSET:To,BASE64WEB_CHARSET:Ao}=le,ko=Vt(),qt=(e=ko)=>e.random(),Je=(e,t,r)=>((t===void 0||t===0)&&(t=e,e=0),Math.floor(e+qt(r)*t)),jt=(e,t)=>e[Je(0,e.length,t)],Yt=(e,t=1,r)=>{const s=[],i=[];for(let c=0;c<t;c++)i.length===0&&i.push(...e),s.push(i.splice(Je(0,i.length,r),1)[0]);return s},xo=(e,t)=>Yt(e,e.length,t),Te=(e,t=8,r)=>new Array(t).fill(0).map(s=>jt(e,r)).join(""),Xt={MT:Vt,toSeed:ye,rand:qt,randInt:Je,charset:Te,choice:jt,choices:Yt,shuffle:xo,base10:(e=6,t)=>Te(Bo,e,t),base16:(e=32,t)=>Te(To,e,t),base64:(e=32,t)=>Te(Ao,e,t),lcg(e){let t=ye(e);return()=>(t=(t*1664525+1013904223)%4294967296)/4294967296}};var Kt={exports:{}};(function(e,t){(function(r,s){e.exports=s(Qe())})(te,function(r){return function(s){var i=r,c=i.lib,p=c.WordArray,b=c.Hasher,C=i.algo,n=[];(function(){for(var S=0;S<64;S++)n[S]=s.abs(s.sin(S+1))*4294967296|0})();var T=C.MD5=b.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(S,g){for(var B=0;B<16;B++){var a=g+B,o=S[a];S[a]=(o<<8|o>>>24)&16711935|(o<<24|o>>>8)&4278255360}var l=this._hash.words,m=S[g+0],f=S[g+1],y=S[g+2],x=S[g+3],A=S[g+4],E=S[g+5],_=S[g+6],R=S[g+7],U=S[g+8],P=S[g+9],H=S[g+10],$=S[g+11],D=S[g+12],L=S[g+13],V=S[g+14],q=S[g+15],u=l[0],d=l[1],h=l[2],v=l[3];u=k(u,d,h,v,m,7,n[0]),v=k(v,u,d,h,f,12,n[1]),h=k(h,v,u,d,y,17,n[2]),d=k(d,h,v,u,x,22,n[3]),u=k(u,d,h,v,A,7,n[4]),v=k(v,u,d,h,E,12,n[5]),h=k(h,v,u,d,_,17,n[6]),d=k(d,h,v,u,R,22,n[7]),u=k(u,d,h,v,U,7,n[8]),v=k(v,u,d,h,P,12,n[9]),h=k(h,v,u,d,H,17,n[10]),d=k(d,h,v,u,$,22,n[11]),u=k(u,d,h,v,D,7,n[12]),v=k(v,u,d,h,L,12,n[13]),h=k(h,v,u,d,V,17,n[14]),d=k(d,h,v,u,q,22,n[15]),u=w(u,d,h,v,f,5,n[16]),v=w(v,u,d,h,_,9,n[17]),h=w(h,v,u,d,$,14,n[18]),d=w(d,h,v,u,m,20,n[19]),u=w(u,d,h,v,E,5,n[20]),v=w(v,u,d,h,H,9,n[21]),h=w(h,v,u,d,q,14,n[22]),d=w(d,h,v,u,A,20,n[23]),u=w(u,d,h,v,P,5,n[24]),v=w(v,u,d,h,V,9,n[25]),h=w(h,v,u,d,x,14,n[26]),d=w(d,h,v,u,U,20,n[27]),u=w(u,d,h,v,L,5,n[28]),v=w(v,u,d,h,y,9,n[29]),h=w(h,v,u,d,R,14,n[30]),d=w(d,h,v,u,D,20,n[31]),u=I(u,d,h,v,E,4,n[32]),v=I(v,u,d,h,U,11,n[33]),h=I(h,v,u,d,$,16,n[34]),d=I(d,h,v,u,V,23,n[35]),u=I(u,d,h,v,f,4,n[36]),v=I(v,u,d,h,A,11,n[37]),h=I(h,v,u,d,R,16,n[38]),d=I(d,h,v,u,H,23,n[39]),u=I(u,d,h,v,L,4,n[40]),v=I(v,u,d,h,m,11,n[41]),h=I(h,v,u,d,x,16,n[42]),d=I(d,h,v,u,_,23,n[43]),u=I(u,d,h,v,P,4,n[44]),v=I(v,u,d,h,D,11,n[45]),h=I(h,v,u,d,q,16,n[46]),d=I(d,h,v,u,y,23,n[47]),u=M(u,d,h,v,m,6,n[48]),v=M(v,u,d,h,R,10,n[49]),h=M(h,v,u,d,V,15,n[50]),d=M(d,h,v,u,E,21,n[51]),u=M(u,d,h,v,D,6,n[52]),v=M(v,u,d,h,x,10,n[53]),h=M(h,v,u,d,H,15,n[54]),d=M(d,h,v,u,f,21,n[55]),u=M(u,d,h,v,U,6,n[56]),v=M(v,u,d,h,q,10,n[57]),h=M(h,v,u,d,_,15,n[58]),d=M(d,h,v,u,L,21,n[59]),u=M(u,d,h,v,A,6,n[60]),v=M(v,u,d,h,$,10,n[61]),h=M(h,v,u,d,y,15,n[62]),d=M(d,h,v,u,P,21,n[63]),l[0]=l[0]+u|0,l[1]=l[1]+d|0,l[2]=l[2]+h|0,l[3]=l[3]+v|0},_doFinalize:function(){var S=this._data,g=S.words,B=this._nDataBytes*8,a=S.sigBytes*8;g[a>>>5]|=128<<24-a%32;var o=s.floor(B/4294967296),l=B;g[(a+64>>>9<<4)+15]=(o<<8|o>>>24)&16711935|(o<<24|o>>>8)&4278255360,g[(a+64>>>9<<4)+14]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360,S.sigBytes=(g.length+1)*4,this._process();for(var m=this._hash,f=m.words,y=0;y<4;y++){var x=f[y];f[y]=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360}return m},clone:function(){var S=b.clone.call(this);return S._hash=this._hash.clone(),S}});function k(S,g,B,a,o,l,m){var f=S+(g&B|~g&a)+o+m;return(f<<l|f>>>32-l)+g}function w(S,g,B,a,o,l,m){var f=S+(g&a|B&~a)+o+m;return(f<<l|f>>>32-l)+g}function I(S,g,B,a,o,l,m){var f=S+(g^B^a)+o+m;return(f<<l|f>>>32-l)+g}function M(S,g,B,a,o,l,m){var f=S+(B^(g|~a))+o+m;return(f<<l|f>>>32-l)+g}i.MD5=b._createHelper(T),i.HmacMD5=b._createHmacHelper(T)}(Math),r.MD5})})(Kt);var _o=Kt.exports;const Mo=Mt(_o),{MT:Me,shuffle:Io,randInt:xe}=Xt,{convert:Gt,getCharset:Ft}=le,Qt=(e,t)=>{const r=Io(e,t);return()=>(r.push(r.shift()),r)},Jt=(e,t=16,r=1,s)=>{const i=Number.isNaN(+t)?64:+t,c=Ft(t),p=ye(s!==void 0?s:xe(0,i)),b=Me(p),C=Qt(c,Me(xe(0,1e6,b))),n=typeof e=="string"?e.split(""):e,T=[s!==void 0?c[xe(0,i)]:Gt(p,10,t),...n.map(k=>C()[c.indexOf(k)])];return--r<1?T.join(""):Jt(T,t,r,s)},Zt=(e,t=16,r=1,s)=>{const i=Ft(t),c=ye(s!==void 0?s:+Gt(e[0],t,10)),p=Me(c),b=Qt(i,Me(xe(0,1e6,p))),n=(typeof e=="string"?e.split(""):e).slice(1,e.length).map(T=>i[b().indexOf(T)]);return--r<1?n.join(""):Zt(n,t,r,s)},{textToBase64:Ho,base64ToText:Ro,secureBase64:$o}=le;function en(e,t=1,r){return typeof e=="object"?e=Ut(e):typeof e!="string"&&(e=Ie(e)),Jt($o(Ho(e)),64,t,r)}function Lo(e,t=1,r,s=!0){if(e=Ro(Zt(e,64,t,r)),!s)return e;try{return JSON.parse(e)}catch{return e}}function Oo(e,t=512,r){const s=en(e,1,r).substring(1);return t==="MD5"?Mo(s).toString():Pt(s,{outputLength:t}).toString()}const No={e:en,d:Lo,h:Oo},Do=new Map([["THINKING","Please wait, I am answering another question..."]]),tn=W("gpt4"),zo=4e3,Wo=()=>{if(!on.value)return"";const e=z.value.filter(r=>r.done).map(r=>(r.Q?`Question:
${r.Q}`:"")+(r.Q&&r.A?`

`:"")+(r.A?`Answer:
${r.A}`:""));for(;e.length>1&&e.slice(1,e.length).join("").length>zo;)e.shift();const t=e.join(`
---
`);return t.length===0?"":(e.push(),`Conversation History
===
${t}`)},z=W([]),re=W([]),fe=()=>{try{document.querySelector(".InputBox textarea").focus()}catch{}},Ae=()=>new Promise((e,t)=>{$fetch("/api/curva/check",{method:"POST"}).then(r=>{const{list:s,named:i}=r;re.value=s.sort().map(c=>({id:c,name:i[c]})),e(!0)}).catch(r=>{G.error("Initialization Failed"),t(r)})}),Po=e=>new Promise(async(t,r)=>{if(e==null)return t([]);const s=await $fetch("/api/curva/history",{method:"POST",body:{id:e}});(!s||s.length===0)&&_e("/c/");try{t(s.map(i=>Fe({...i,t:new Date(i.t),done:!!i.A})))}catch{_e("/c/"),t([])}}),nn=async function(e){return await $fetch("/api/curva/suggestions",{method:"POST",body:{question:e}})},Uo=async()=>{try{const e=z.value.at(-1),t=await nn(e.Q),r=Ye()>=document.body.clientHeight;e.more=t,r&&J()}catch(e){console.error(e)}},pe=W(.5),on=W(!0),Z=W(!1),de=W(Z.value),he=W(Z.value),ve=W(""),Vo=(()=>{const{h:e}=No,t=()=>[77,68,53].map(i=>String.fromCharCode(i)).join(""),r=(i,c,p)=>({hash:e(`${i}${c}`,t(),p),timestamp:Ie(p)}),s=(i,c,p,b,C,n)=>{var k,w;let T=(w=(k=It()._route)==null?void 0:k.params)==null?void 0:w.conv;return T||(T=Xt.base64(8),re.value.push({id:T,name:void 0}),_e(`/c/${T}?feature=new`)),{conv:T,context:Wo(),prompt:i,model:c,temperature:p,t:b,tz:C,id:n}};return(i,c)=>{const p=new Date,b=p.getTime(),C=p.getTimezoneOffset()/60*-1,n=s(i,tn.value,pe.value,b,C,c),T=r(i,n.context,b);return $fetch("/api/curva/answer",{method:"POST",headers:T,body:n})}})(),qo=(e="",t="",r=!1)=>Fe({done:r,Q:e,A:t,queries:[],urls:[],dt:void 0,t:new Date});let qe=new Set;const jo=()=>{re.value=[],z.value=[],_e("/c/"),Ge=!0};let Ge=!0;function Et(){{const e=xn();e.get("feature")==="new"&&(e.delete("feature"),e.save())}}function Zo(){const e=dt("appName").value,t=An(),r=+(t.has(De)?t.get(De):.5);t.delete(gt,{path:"/"}),t.delete(gt),t.delete(yt,{path:"/"}),t.delete(yt),r>=0&&r<=1&&(pe.value=r),ee(pe,o=>{pe.value=Math.round(o*10)/10,t.set(De,`${o}`,{path:"/"})});const s=It(),i=()=>{var o,l;return(l=(o=s._route)==null?void 0:o.params)==null?void 0:l.conv},c=()=>{const o=i();return re.value.filter(l=>l.id===o)[0].name||""};ee(Z,o=>{pt().isMobileScreen?(de.value=!1,he.value!==o&&(he.value=o)):(he.value=!1,de.value!==o&&(de.value=o)),setTimeout(()=>{try{fe()}catch{}},0)}),ee(he,o=>{Z.value=o}),ee(de,o=>{Z.value=o});const p=async o=>{pt().isMobileScreen&&(Z.value=!1),z.value=[];const l=ht.service();try{const f=(await Promise.all([o===null&&re.value.length>0?null:Ae(),o===null?null:Po(o)]))[1];f!==null&&i()===o&&(z.value=f,Uo())}finally{try{Se(`${c()||"Chat"} - ${e}`)}catch{Se(`Chat - ${e}`)}if(J(),l!==null)try{await J(500)}finally{l.close();try{await J(500)}finally{}}}setTimeout(()=>fe(),500)},b=async(o,l=!1)=>{const m=Promise.all([...qe]),f=Ge&&l?new Promise(async y=>{await p(o),Et(),y(null)}):l?new Promise(y=>y(null)):p(o);Ge=!1,qe.add(f);try{await m}catch{}try{await f}finally{qe.delete(f)}},C=kn().t,n=dt("version"),T=(o,l)=>{if(document.querySelectorAll(".Message.T").length>0)return G.info("Thinking too many questions."),!1;const f=o===void 0?ve.value:o,y=f.trim();if(f===ve.value&&(ve.value="",y===""))return!1;const x=qo(y,"",!1);z.value.push(x),J(),setTimeout(()=>{fe()},500);const A=nn(y);return Vo(y,l).then(E=>{Et();const _=Ye()>=document.body.clientHeight,R=E.id,U=E.answer,P=E.error,H=E.urls,$=E.queries,D=E.dt,L=E.version;if(!U){if(P){const V=z.value.indexOf(x);switch(P){case"THINKING":z.value.splice(V,1),G.warning(Do.get(P)),ve.value=y;return;default:throw P}}throw C("error.plzRefresh")}x.id=R,x.A=U,x.urls=H||[],x.queries=$||[],x.dt=D||void 0,L!==n.value&&Ne.confirm(C("action.newVersion"),C("message.notice"),{confirmButtonText:C("message.ok"),cancelButtonText:C("message.cancel"),type:"warning"}).then(()=>{location.reload()}).finally(()=>{fe()}),_&&J(),A.then(V=>{const q=Ye()>=document.body.clientHeight;x.more=V,q&&J()}).catch(()=>{})}).catch(E=>{G.error(E||"Oops! Something went wrong!"),x.A="Oops! Something went wrong!"}).finally(()=>{x.done=!0,x.t=new Date}),!0},k=async()=>{const o=z.value.pop();o!==void 0&&(T(o.Q,o.id)||z.value.push(o))},w=o=>{z.value=z.value.filter(l=>l.id!==o),$fetch("/api/curva/answer",{method:"DELETE",body:{conv:i(),id:o}}).then(()=>G.info("The message has been deleted.")).catch(()=>G.error("An error occurred while deleting the message."))},I=()=>{b(i())},M=(o,l="")=>{o||(o=i(),l=c()),Ne.prompt(C("message.renameConvHint"),C("message.setting"),{confirmButtonText:C("message.ok"),cancelButtonText:C("message.cancel"),inputValue:l,inputPlaceholder:le.convert(o,"64w",10)}).then(({value:m})=>{$fetch("/api/curva/conv",{method:"PUT",body:{id:o,name:m}}).then(async()=>{G({type:"success",message:C("message.renameSuccess")}),await Ae();try{Se(`${c()||"Chat"} - ${e}`)}catch{Se(`Chat - ${e}`)}}).catch(()=>{G({type:"error",message:"Oops! Something went wrong!"})})}).catch(()=>{})},S=o=>{var x,A;const l=o||i(),m=[...re.value];let f=-1,y="createNewChat";for(let E=0;E<m.length;E++)if(m[E].id===l){f=E;break}if(f!==-1){const E=(x=m[f-1])==null?void 0:x.id,_=(A=m[f+1])==null?void 0:A.id;E!==void 0?y=E:_!==void 0&&(y=_)}Ne.confirm(C("message.deleteConvConfirm"),C("message.warning"),{confirmButtonText:C("message.ok"),cancelButtonText:C("message.cancel"),type:"warning"}).then(()=>{const E=ht.service();$fetch("/api/curva/conv",{method:"DELETE",body:{id:l}}).finally(async()=>{var _;E.close(),o===i()?(_=document.getElementById(y))==null||_.click():await Ae()})})},g=(o,l)=>{const m=document.createElement("a");m.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(l)),m.setAttribute("download",o),m.style.display="none",document.body.appendChild(m),m.click(),m.remove()};return{model:tn,conversations:re,messages:z,temperature:pe,contextMode:on,openMenu:Z,openSidebar:de,openDrawer:he,inputValue:ve,getCurrentConvId:i,getCurrentConvName:c,checkTokenAndGetConversations:Ae,loadChat:b,sendMessage:T,deleteMessage:w,regenerateMessage:k,focusInput:fe,refreshConversation:I,renameConversation:M,deleteConversation:S,exportAsMarkdown:()=>{let o=0;const l=`${le.convert(i(),"64w",10)}.md`,m=z.value.map(f=>{o++;try{return(f.t?`${new Date(f.t.getTime()-(f.dt||0)).toLocaleString()}${f.dt===void 0?"":" (Δt: "+f.dt.toString()+"ms)"}

`:"")+(f.Q?`QUESTION ${o}:

${f.Q.replaceAll(`
`,`

`)}`:"")+(f.Q&&f.A?`

`:"")+(f.A?`ANSWER ${o}:

${f.A}`:"")}catch{return"(Unknown message)"}}).join(`

---

`)+`

---

`;g(l,m)},exportAsJson:()=>{g(`${le.convert(i(),"64w",10)}.json`,JSON.stringify(z.value.map(o=>({question:o.Q,answer:o.A,created:new Date(o.t.getTime()).toUTCString(),timeUsed:o.dt||void 0,queries:o.queries||void 0,urls:o.urls||void 0})),null,4))},clear:jo}}export{Ne as E,Dn as a,zn as b,jn as c,Ht as d,le as e,pt as f,Xt as r,Ie as s,Zo as u};
