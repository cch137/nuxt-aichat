import{r as u,g as w,D as m,E as s,z as p,A as v}from"./entry.a069275b.js";import{u as L}from"./useChat.603b42aa.js";const l=u(""),i=u(""),o=u(!1),g=u(!1);function h(e){g.value=e}const I=async()=>{o.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"}),l.value="",i.value="",h(!1),s.success("Logged out."),L().clear()}catch{s.error("Log out failed.")}finally{o.value=!1}};let d=0;const c=async(e=!1)=>{const a=Date.now();if(!e&&a-d<6e4)return g.value;o.value=!0;try{const{isLoggedIn:r,user:t}=await $fetch("/api/auth/check",{method:"POST"});return d=a,l.value=(t==null?void 0:t.email)||"",i.value=(t==null?void 0:t.username)||"",o.value=!1,setTimeout(()=>h(r),0),r}catch{o.value=!1}};(async()=>{try{await c()}catch(e){console.error(e)}finally{}})();const T=async e=>{try{const{error:a}=await $fetch("/api/auth/username",{method:"PUT",body:{username:e}});if(a)throw a;return await c(!0),s.success("The username has been changed."),!0}catch(a){return s.error(typeof a=="string"?a:"Oops! Something went wrong."),!1}};function S(){const e=w().t;return{authIsLoading:o,isLoggedIn:g,email:l,username:i,login:async(r,t)=>{const y=p.service({text:e("auth.loggingIn")});o.value=!0;try{const n=await $fetch("/api/auth/login",{method:"POST",body:{usernameOrEmail:r,password:t}}),{error:f}=n;if(f)throw f;v("/c/"),await c(!0),s.success("Logged in.")}catch(n){s.error(typeof n=="string"?n:"Oops! Something went wrong.")}finally{y.close(),o.value=!1}},logout:I,checkIsLoggedIn:c,setIsLoggedIn:h,changeUsername:T,goToHome(){m().$router.replace("/")},goToNewChat(){m().$router.replace("/c/")}}}export{S as u};
