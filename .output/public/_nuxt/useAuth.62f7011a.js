var P=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var v=(t,e,r)=>(P(t,e,"read from private field"),r?r.call(t):e.get(t)),b=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},I=(t,e,r,s)=>(P(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r);import{r as g,g as M,D as W,E as l,z as N,A as _}from"./entry.c4882665.js";var i;class R{constructor(){b(this,i,void 0);I(this,i,new EventTarget)}addListener(e,r){try{v(this,i).addEventListener(e,r)}catch{}}removeListener(e,r){try{v(this,i).removeEventListener(e,r)}catch{}}dispatchEvent(e){v(this,i).dispatchEvent(new Event(e))}}i=new WeakMap;const w=new R,y=g(""),L=g(""),E=g(0),o=g(!1),T=g(!1),U=(()=>{const t=(n="")=>n.startsWith("Win")?"Win":n.startsWith("Linux")?"Linux":n.startsWith("Mac")?"Mac":n,e=n=>(n=!!n,n?!0:Object.keys(Object.getOwnPropertyDescriptors(navigator)).includes("webdriver")),r=(n="",a="")=>!n.includes(t(a)),s=(n,a=!1)=>{if(a)return!1;if(!n||n.length===0)return!0;const f=Object.values(Object.getOwnPropertyDescriptors(n)).map(c=>c.value);if(f.length===n.length)return!0;const d=f.map(c=>c.constructor===Plugin);return d.filter(c=>c).length!==d.length},p=(n="",a=[])=>!n||!a||a.length===0,u=(n="",a)=>n.includes("Chrome")?!a:!1,h=()=>"ontouchstart"in document||navigator.maxTouchPoints>0;return()=>{const{userAgent:n="",platform:a="",plugins:f=[],webdriver:d=!1,language:c="",languages:x=[]}=navigator,C=h(),$=e(d),j=s(f,C),k=p(c,x),A=r(n,a),D=u(n,window==null?void 0:window.chrome);return{wd:$,pg:j,lg:k,pf:A,cr:D}}})();function O(t){T.value=t}const z=async()=>{o.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"}),y.value="",L.value="",E.value=0,O(!1),w.dispatchEvent("logout"),l.success("Logged out.")}catch{l.error("Log out failed.")}finally{o.value=!1}};let S=0;const m=async(t=!1)=>{const e=Date.now();if(!t&&e-S<6e4)return T.value;o.value=!0;try{const{isLoggedIn:r,user:s}=await $fetch("/api/auth/check",{method:"POST"});return S=e,y.value=(s==null?void 0:s.email)||"",L.value=(s==null?void 0:s.username)||"",E.value=(s==null?void 0:s.authlvl)||0,o.value=!1,setTimeout(()=>O(r),0),r}catch{o.value=!1}};(async()=>{try{await m()}catch(t){console.error(t)}finally{}})();const B=async t=>{try{const{error:e}=await $fetch("/api/auth/username",{method:"PUT",body:{username:t}});if(e)throw e;return await m(!0),l.success("The username has been changed."),!0}catch(e){return l.error(typeof e=="string"?e:"Oops! Something went wrong."),!1}};function F(){const t=M().t;async function e(r,s){const p=N.service({text:t("auth.loggingIn")});o.value=!0;try{const u=await $fetch("/api/auth/login",{method:"POST",body:{usernameOrEmail:r,password:s}}),{error:h}=u;if(h)throw h;w.dispatchEvent("login"),await _("/"),await m(!0),l.success("Logged in.")}catch(u){l.error(typeof u=="string"?u:"Oops! Something went wrong.")}finally{p.close(),o.value=!1}}return{authEventTarget:w,authIsLoading:o,isLoggedIn:T,email:y,username:L,authlvl:E,login:e,logout:z,checkIsLoggedIn:m,setIsLoggedIn:O,changeUsername:B,mousetrap:U,goToHome(){W().$router.replace("/")},goToNewChat(){W().$router.replace("/c/")}}}export{F as u};
