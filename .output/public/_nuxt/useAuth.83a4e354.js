var y=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)};var i=(t,e,a)=>(y(t,e,"read from private field"),a?a.call(t):e.get(t)),p=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},L=(t,e,a,n)=>(y(t,e,"write to private field"),n?n.call(t,a):e.set(t,a),a);import{r as c,g as $,D as E,E as r,z as O,A as S}from"./entry.e6cf1318.js";var s;class P{constructor(){p(this,s,void 0);L(this,s,new EventTarget)}addListener(e,a){try{i(this,s).addEventListener(e,a)}catch{}}removeListener(e,a){try{i(this,s).removeEventListener(e,a)}catch{}}dispatchEvent(e){i(this,s).dispatchEvent(new Event(e))}}s=new WeakMap;const h=new P,g=c(""),v=c(""),d=c(0),o=c(!1),f=c(!1);function m(t){f.value=t}const b=async()=>{o.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"}),g.value="",v.value="",d.value=0,m(!1),h.dispatchEvent("logout"),r.success("Logged out.")}catch{r.error("Log out failed.")}finally{o.value=!1}};let T=0;const l=async(t=!1)=>{const e=Date.now();if(!t&&e-T<6e4)return f.value;o.value=!0;try{const{isLoggedIn:a,user:n}=await $fetch("/api/auth/check",{method:"POST"});return T=e,g.value=(n==null?void 0:n.email)||"",v.value=(n==null?void 0:n.username)||"",d.value=(n==null?void 0:n.authlvl)||0,o.value=!1,setTimeout(()=>m(a),0),a}catch{o.value=!1}};(async()=>{try{await l()}catch(t){console.error(t)}finally{}})();const k=async t=>{try{const{error:e}=await $fetch("/api/auth/username",{method:"PUT",body:{username:t}});if(e)throw e;return await l(!0),r.success("The username has been changed."),!0}catch(e){return r.error(typeof e=="string"?e:"Oops! Something went wrong."),!1}};function C(){const t=$().t;async function e(a,n){const I=O.service({text:t("auth.loggingIn")});o.value=!0;try{const u=await $fetch("/api/auth/login",{method:"POST",body:{usernameOrEmail:a,password:n}}),{error:w}=u;if(w)throw w;h.dispatchEvent("login"),await S("/"),await l(!0),r.success("Logged in.")}catch(u){r.error(typeof u=="string"?u:"Oops! Something went wrong.")}finally{I.close(),o.value=!1}}return{authEventTarget:h,authIsLoading:o,isLoggedIn:f,email:g,username:v,authlvl:d,login:e,logout:b,checkIsLoggedIn:l,setIsLoggedIn:m,changeUsername:k,goToHome(){E().$router.replace("/")},goToNewChat(){E().$router.replace("/c/")}}}export{C as u};
