import{E as A}from"./el-input.23271487.js";import{E as F,a as L}from"./el-form.4983e051.js";import{f as N,u as O,r as C,k as $,h as W,c as v,b as l,w as m,o as p,i as e,a as u,t as f,n as U,l as k,m as M,q as j,s as h,v as D,x as G,d as w,E as c,y as z,z as H,A as J}from"./entry.7ff9c0b1.js";import{E as K}from"./el-link.7d91bf95.js";import{E as Q}from"./el-text.3ef36c41.js";import{E as X}from"./el-button.876bfc64.js";import{_ as Y}from"./client-only.edaa2a69.js";/* empty css                */import{E as Z}from"./el-overlay.7aa5a00d.js";import{u as ee}from"./useTitle.c2257164.js";import"./castArray.410cd058.js";import"./_Uint8Array.20447739.js";import"./index.2b0e0968.js";import"./focus-trap.18047f53.js";import"./scroll.567b8a9a.js";import"./vue.f36acd1f.72fa94a4.js";const te={class:"mt-0 mb-6"},ae={key:0,class:"-mt-1 mb-2 w-full text-right"},se={key:3,class:"flex-center flex-col gap-1 w-full"},oe={class:"flex justify-end gap-1 w-full"},le=u("div",{class:"p-6"},null,-1),re={key:4,class:"flex-center"},ie={key:5,class:"flex-center"},ne=u("div",{class:"p-2"},null,-1),me={class:"flex-center flex-col gap-1"},ce={class:"flex-center flex-wrap gap-1",style:{"line-height":"1rem"}},de=u("div",{class:"p-8"},null,-1),Ie=N({__name:"reset-password",setup(pe){const a=O().t,E=C(!1),r=C(0),x=C(),o=$({email:"",password:"",veriCode:""}),S=()=>{history.back()},I=$({email:[{required:!0,message:a("auth.emailRequired"),trigger:"change"},{type:"email",message:a("auth.emailInvalid"),trigger:"change"}],password:[{required:!0,message:a("auth.passwdRequired"),trigger:"change"},{min:8,max:64,message:a("auth.passwdLength"),trigger:"change"}],veriCode:[{required:!0,message:a("auth.veriCodeRequired"),trigger:"change"},{min:6,max:6,message:a("auth.veriCodeRequired"),trigger:"change"}]}),B=()=>{Z.confirm(a("auth.confirmChangeEmail"),"",{confirmButtonText:a("message.ok"),cancelButtonText:a("message.cancel"),type:"warning"}).then(()=>{r.value=0,o.email="",o.veriCode="",c.success(a("action.opExecuted"))}).catch(()=>{c.info(a("action.opCanceled"))})},P=()=>{E.value=!0,b(x.value,!0)},b=async(s,t=!1)=>{await s.validate((g,_)=>{if(g||t){const y=z.service({text:a("auth.sendingVeriCode")});$fetch(t?"/api/auth/resendCode":"/api/auth/createVerification",{method:"POST",body:{email:o.email}}).then(i=>{const d=i;d!=null&&d.error?c.error(d==null?void 0:d.error):(c.success("Email sent, please check your inbox."),r.value=1)}).catch(()=>{c.error("Oops! Something went wrong.")}).finally(()=>{y.close()})}else c.error(a("auth.formIncomplete"))})},q=async s=>{await s.validate((t,g)=>{if(t){const _=z.service({text:a("action.submitting")+"..."});$fetch("/api/auth/resetPassword",{method:"POST",body:{email:o.email,password:o.password,code:o.veriCode}}).then(y=>{const i=y;i!=null&&i.error?c.error(i==null?void 0:i.error):(c.success("Password reset successful."),H("/acc/profile"))}).catch(()=>{c.error("Oops! Something went wrong.")}).finally(()=>{_.close()})}else c.error(a("auth.formIncomplete"))})};return ee(`${a("auth.resetPw")} - ${W("appName").value}`),(s,t)=>{const g=A,_=F,y=J,i=K,d=Q,V=X,T=L,R=Y;return p(),v("div",null,[l(R,null,{default:m(()=>[l(T,{ref_key:"ruleFormRef",ref:x,model:e(o),rules:e(I),"label-position":"top",class:"flex-col flex-center w-full max-w-xs px-4 m-auto",style:{height:"calc(100vh - 56px)"}},{default:m(()=>[u("h1",te,f(s.$t("auth.resetPw")),1),l(_,{label:s.$t("auth.email"),style:U(e(r)===1?"margin-bottom: 0;":""),prop:"email",class:"inputWrapper SignupInputAnim1"},{default:m(()=>[(p(),k(g,{key:e(r),modelValue:e(o).email,"onUpdate:modelValue":t[0]||(t[0]=n=>e(o).email=n),type:"email",size:"large","prefix-icon":e(M),readonly:e(r)>0,disabled:e(r)>0},null,8,["modelValue","prefix-icon","readonly","disabled"]))]),_:1},8,["label","style"]),e(r)===1?(p(),v("div",ae,[l(i,{type:"primary",onClick:B,style:{"font-size":"small"}},{default:m(()=>[l(y,{size:"small",class:"mr-1"},{default:m(()=>[l(e(j))]),_:1}),u("span",null,f(s.$t("action.change")),1)]),_:1})])):h("",!0),e(r)===1?(p(),k(_,{key:1,label:s.$t("auth.passwd"),prop:"password",class:"inputWrapper SignupInputAnim2 SignupPasswordInputWrapper"},{default:m(()=>[l(g,{modelValue:e(o).password,"onUpdate:modelValue":t[1]||(t[1]=n=>e(o).password=n),type:"password",size:"large","prefix-icon":e(D),formatter:n=>n.trim(),parser:n=>n.trim(),"show-password":""},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):h("",!0),e(r)===1?(p(),k(_,{key:2,label:s.$t("auth.veriCode"),prop:"veriCode",class:"inputWrapper SignupInputAnim2"},{default:m(()=>[l(g,{modelValue:e(o).veriCode,"onUpdate:modelValue":t[2]||(t[2]=n=>e(o).veriCode=n),type:"text",size:"large",maxLength:"6","prefix-icon":e(G)},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"])):h("",!0),e(r)===1&&!e(E)?(p(),v("div",se,[u("div",oe,[l(d,{type:"info",style:{"font-size":"small"}},{default:m(()=>[w(f(s.$t("auth.notReceiveVeriCode")),1)]),_:1}),l(i,{type:"primary",style:{"font-size":"small"},onClick:P},{default:m(()=>[w(f(s.$t("action.resend")),1)]),_:1})])])):h("",!0),le,e(r)===0?(p(),v("div",re,[l(V,{size:"large",type:"primary",onClick:t[3]||(t[3]=n=>b(e(x)))},{default:m(()=>[w(f(s.$t("auth.getVeriCode")),1)]),_:1})])):h("",!0),e(r)===1?(p(),v("div",ie,[l(V,{size:"large",type:"primary",onClick:t[4]||(t[4]=n=>q(e(x)))},{default:m(()=>[w(f(s.$t("action.submit")),1)]),_:1})])):h("",!0),ne,u("div",me,[u("div",ce,[l(i,{type:"primary",onClick:t[5]||(t[5]=n=>S())},{default:m(()=>[w(f(s.$t("action.back")),1)]),_:1})])]),de]),_:1},8,["model","rules"])]),_:1})])}}});export{Ie as default};
