import{E as A}from"./el-input.5697ae3f.js";import{E as F,a as L}from"./el-form.46baa21c.js";import{f as N,g as O,r as C,l as $,i as W,o as p,c as v,b as l,w as c,j as e,a as u,t as f,n as U,m as k,q as j,s as M,v as h,x as D,y as G,d as w,E as m,z,A as H,B as J}from"./entry.0bbf14a2.js";import{E as K}from"./el-link.c11e96a4.js";import{E as Q}from"./el-text.4a878b46.js";import{E as X}from"./el-button.71994530.js";import{_ as Y}from"./client-only.db448d76.js";/* empty css                */import{E as Z}from"./el-overlay.3dbf3adb.js";import{u as ee}from"./useTitle.555755d3.js";import"./castArray.2e8e2983.js";import"./_Uint8Array.a11e697a.js";import"./index.d5f69dcb.js";import"./focus-trap.69a3125b.js";import"./scroll.854aa195.js";const te={class:"mt-0 mb-6"},ae={key:0,class:"-mt-1 mb-2 w-full text-right"},se={key:3,class:"flex-center flex-col gap-1 w-full"},oe={class:"flex justify-end gap-1 w-full"},le=u("div",{class:"p-6"},null,-1),re={key:4,class:"flex-center"},ie={key:5,class:"flex-center"},ne=u("div",{class:"p-2"},null,-1),ce={class:"flex-center flex-col gap-1"},me={class:"flex-center flex-wrap gap-1",style:{"line-height":"1rem"}},de=u("div",{class:"p-8"},null,-1),Se=N({__name:"reset-password",setup(pe){const a=O().t,E=C(!1),r=C(0),x=C(),o=$({email:"",password:"",veriCode:""}),S=()=>{history.back()},B=$({email:[{required:!0,message:a("auth.emailRequired"),trigger:"change"},{type:"email",message:a("auth.emailInvalid"),trigger:"change"}],password:[{required:!0,message:a("auth.passwdRequired"),trigger:"change"},{min:8,max:64,message:a("auth.passwdLength"),trigger:"change"}],veriCode:[{required:!0,message:a("auth.veriCodeRequired"),trigger:"change"},{min:6,max:6,message:a("auth.veriCodeRequired"),trigger:"change"}]}),I=()=>{Z.confirm(a("auth.confirmChangeEmail"),"",{confirmButtonText:a("message.ok"),cancelButtonText:a("message.cancel"),type:"warning"}).then(()=>{r.value=0,o.email="",o.veriCode="",m.success(a("action.opExecuted"))}).catch(()=>{m.info(a("action.opCanceled"))})},P=()=>{E.value=!0,b(x.value,!0)},b=async(s,t=!1)=>{await s.validate((g,_)=>{if(g||t){const y=z.service({text:a("auth.sendingVeriCode")});$fetch(t?"/api/auth/resendCode":"/api/auth/createVerification",{method:"POST",body:{email:o.email}}).then(i=>{const d=i;d!=null&&d.error?m.error(d==null?void 0:d.error):(m.success("Email sent, please check your inbox."),r.value=1)}).catch(()=>{m.error("Oops! Something went wrong.")}).finally(()=>{y.close()})}else m.error(a("auth.formIncomplete"))})},q=async s=>{await s.validate((t,g)=>{if(t){const _=z.service({text:a("action.submitting")+"..."});$fetch("/api/auth/resetPassword",{method:"POST",body:{email:o.email,password:o.password,code:o.veriCode}}).then(y=>{const i=y;i!=null&&i.error?m.error(i==null?void 0:i.error):(m.success("Password reset successful."),H("/acc/profile"))}).catch(()=>{m.error("Oops! Something went wrong.")}).finally(()=>{_.close()})}else m.error(a("auth.formIncomplete"))})};return ee(`${a("auth.resetPw")} - ${W("appName").value}`),(s,t)=>{const g=A,_=F,y=J,i=K,d=Q,V=X,T=L,R=Y;return p(),v("div",null,[l(R,null,{default:c(()=>[l(T,{ref_key:"ruleFormRef",ref:x,model:e(o),rules:e(B),"label-position":"top",class:"flex-col flex-center w-full max-w-xs px-4 m-auto",style:{height:"calc(100vh - 56px)"}},{default:c(()=>[u("h1",te,f(s.$t("auth.resetPw")),1),l(_,{label:s.$t("auth.email"),style:U(e(r)===1?"margin-bottom: 0;":""),prop:"email",class:"inputWrapper SignupInputAnim1"},{default:c(()=>[(p(),k(g,{key:e(r),modelValue:e(o).email,"onUpdate:modelValue":t[0]||(t[0]=n=>e(o).email=n),type:"email",size:"large","prefix-icon":e(j),readonly:e(r)>0,disabled:e(r)>0},null,8,["modelValue","prefix-icon","readonly","disabled"]))]),_:1},8,["label","style"]),e(r)===1?(p(),v("div",ae,[l(i,{type:"primary",onClick:I,style:{"font-size":"small"}},{default:c(()=>[l(y,{size:"small",class:"mr-1"},{default:c(()=>[l(e(M))]),_:1}),u("span",null,f(s.$t("action.change")),1)]),_:1})])):h("",!0),e(r)===1?(p(),k(_,{key:1,label:s.$t("auth.passwd"),prop:"password",class:"inputWrapper SignupInputAnim2 SignupPasswordInputWrapper"},{default:c(()=>[l(g,{modelValue:e(o).password,"onUpdate:modelValue":t[1]||(t[1]=n=>e(o).password=n),type:"password",size:"large","prefix-icon":e(D),formatter:n=>n.trim(),parser:n=>n.trim(),"show-password":""},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):h("",!0),e(r)===1?(p(),k(_,{key:2,label:s.$t("auth.veriCode"),prop:"veriCode",class:"inputWrapper SignupInputAnim2"},{default:c(()=>[l(g,{modelValue:e(o).veriCode,"onUpdate:modelValue":t[2]||(t[2]=n=>e(o).veriCode=n),type:"text",size:"large",maxLength:"6","prefix-icon":e(G)},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"])):h("",!0),e(r)===1&&!e(E)?(p(),v("div",se,[u("div",oe,[l(d,{type:"info",style:{"font-size":"small"}},{default:c(()=>[w(f(s.$t("auth.notReceiveVeriCode")),1)]),_:1}),l(i,{type:"primary",style:{"font-size":"small"},onClick:P},{default:c(()=>[w(f(s.$t("action.resend")),1)]),_:1})])])):h("",!0),le,e(r)===0?(p(),v("div",re,[l(V,{size:"large",type:"primary",onClick:t[3]||(t[3]=n=>b(e(x)))},{default:c(()=>[w(f(s.$t("auth.getVeriCode")),1)]),_:1})])):h("",!0),e(r)===1?(p(),v("div",ie,[l(V,{size:"large",type:"primary",onClick:t[4]||(t[4]=n=>q(e(x)))},{default:c(()=>[w(f(s.$t("action.submit")),1)]),_:1})])):h("",!0),ne,u("div",ce,[u("div",me,[l(i,{type:"primary",onClick:t[5]||(t[5]=n=>S())},{default:c(()=>[w(f(s.$t("action.back")),1)]),_:1})])]),de]),_:1},8,["model","rules"])]),_:1})])}}});export{Se as default};
