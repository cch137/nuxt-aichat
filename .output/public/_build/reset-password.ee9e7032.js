import{E as A}from"./el-input.d87563b5.js";import{E as F,a as L}from"./el-form.6963fe73.js";import{f as N,u as O,r as C,k as $,h as W,c as v,b as r,w as m,o as d,i as e,a as u,t as f,n as U,l as k,m as M,q as j,s as h,v as D,x as G,d as w,E as c,y as z,z as H,A as J}from"./entry.337d13a0.js";import{E as K}from"./el-link.1d446c10.js";import{E as Q}from"./el-text.e1912579.js";import{E as X}from"./el-button.7a9f65de.js";import{_ as Y}from"./client-only.835fbdc1.js";/* empty css                */import{E as Z}from"./el-overlay.a3a68cda.js";import{u as ee}from"./useTitle.63034ec4.js";import"./use-form-item.2ef56732.js";import"./castArray.35969d15.js";import"./_Uint8Array.bc5fc3da.js";import"./index.fb7bb0f1.js";import"./focus-trap.adc928d3.js";import"./scroll.6e946eee.js";import"./vue.f36acd1f.c0857e96.js";const te={class:"mt-0 mb-6"},ae={key:0,class:"-mt-1 mb-2 w-full text-right"},se={key:3,class:"flex-center flex-col gap-1 w-full"},oe={class:"flex justify-end gap-1 w-full"},re=u("div",{class:"p-6"},null,-1),le={key:4,class:"flex-center"},ie={key:5,class:"flex-center"},ne=u("div",{class:"p-2"},null,-1),me={class:"flex-center flex-col gap-1"},ce={class:"flex-center flex-wrap gap-1",style:{"line-height":"1rem"}},pe=u("div",{class:"p-8"},null,-1),Be=N({__name:"reset-password",setup(de){const a=O().t,E=C(!1),l=C(0),x=C(),o=$({email:"",password:"",veriCode:""}),S=()=>{history.back()},I=$({email:[{required:!0,message:a("auth.emailRequired"),trigger:"change"},{type:"email",message:a("auth.emailInvalid"),trigger:"change"}],password:[{required:!0,message:a("auth.passwdRequired"),trigger:"change"},{min:8,max:64,message:a("auth.passwdLength"),trigger:"change"}],veriCode:[{required:!0,message:a("auth.veriCodeRequired"),trigger:"change"},{min:6,max:6,message:a("auth.veriCodeRequired"),trigger:"change"}]}),B=()=>{Z.confirm(a("auth.confirmChangeEmail"),"",{confirmButtonText:a("message.ok"),cancelButtonText:a("message.cancel"),type:"warning"}).then(()=>{l.value=0,o.email="",o.veriCode="",c.success(a("action.opExecuted"))}).catch(()=>{c.info(a("action.opCanceled"))})},P=()=>{E.value=!0,b(x.value,!0)},b=async(s,t=!1)=>{await s.validate((g,_)=>{if(g||t){const y=z.service({text:a("auth.sendingVeriCode")});$fetch(t?"/api/auth/resendCode":"/api/auth/createVerification",{method:"POST",body:{email:o.email}}).then(i=>{const p=i;p!=null&&p.error?c.error(p==null?void 0:p.error):(c.success("Email sent, please check your inbox."),l.value=1)}).catch(()=>{c.error("Oops! Something went wrong.")}).finally(()=>{y.close()})}else c.error(a("auth.formIncomplete"))})},q=async s=>{await s.validate((t,g)=>{if(t){const _=z.service({text:a("action.submitting")+"..."});$fetch("/api/auth/resetPassword",{method:"POST",body:{email:o.email,password:o.password,code:o.veriCode}}).then(y=>{const i=y;i!=null&&i.error?c.error(i==null?void 0:i.error):(c.success("Password reset successful."),H("/acc/profile"))}).catch(()=>{c.error("Oops! Something went wrong.")}).finally(()=>{_.close()})}else c.error(a("auth.formIncomplete"))})};return ee(`${a("auth.resetPw")} - ${W("appName").value}`),(s,t)=>{const g=A,_=F,y=J,i=K,p=Q,V=X,T=L,R=Y;return d(),v("div",null,[r(R,null,{default:m(()=>[r(T,{ref_key:"ruleFormRef",ref:x,model:e(o),rules:e(I),"label-position":"top",class:"flex-col flex-center w-full max-w-xs px-4 m-auto",style:{height:"calc(100vh - 56px)"}},{default:m(()=>[u("h1",te,f(s.$t("auth.resetPw")),1),r(_,{label:s.$t("auth.email"),style:U(e(l)===1?"margin-bottom: 0;":""),prop:"email",class:"inputWrapper SignupInputAnim1"},{default:m(()=>[(d(),k(g,{key:e(l),modelValue:e(o).email,"onUpdate:modelValue":t[0]||(t[0]=n=>e(o).email=n),type:"email",size:"large","prefix-icon":e(M),readonly:e(l)>0,disabled:e(l)>0},null,8,["modelValue","prefix-icon","readonly","disabled"]))]),_:1},8,["label","style"]),e(l)===1?(d(),v("div",ae,[r(i,{type:"primary",onClick:B,style:{"font-size":"small"}},{default:m(()=>[r(y,{size:"small",class:"mr-1"},{default:m(()=>[r(e(j))]),_:1}),u("span",null,f(s.$t("action.change")),1)]),_:1})])):h("",!0),e(l)===1?(d(),k(_,{key:1,label:s.$t("auth.passwd"),prop:"password",class:"inputWrapper SignupInputAnim2 SignupPasswordInputWrapper"},{default:m(()=>[r(g,{modelValue:e(o).password,"onUpdate:modelValue":t[1]||(t[1]=n=>e(o).password=n),type:"password",size:"large","prefix-icon":e(D),formatter:n=>n.trim(),parser:n=>n.trim(),"show-password":""},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):h("",!0),e(l)===1?(d(),k(_,{key:2,label:s.$t("auth.veriCode"),prop:"veriCode",class:"inputWrapper SignupInputAnim2"},{default:m(()=>[r(g,{modelValue:e(o).veriCode,"onUpdate:modelValue":t[2]||(t[2]=n=>e(o).veriCode=n),type:"text",size:"large",maxLength:"6","prefix-icon":e(G)},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"])):h("",!0),e(l)===1&&!e(E)?(d(),v("div",se,[u("div",oe,[r(p,{type:"info",style:{"font-size":"small"}},{default:m(()=>[w(f(s.$t("auth.notReceiveVeriCode")),1)]),_:1}),r(i,{type:"primary",style:{"font-size":"small"},onClick:P},{default:m(()=>[w(f(s.$t("action.resend")),1)]),_:1})])])):h("",!0),re,e(l)===0?(d(),v("div",le,[r(V,{size:"large",type:"primary",onClick:t[3]||(t[3]=n=>b(e(x)))},{default:m(()=>[w(f(s.$t("auth.getVeriCode")),1)]),_:1})])):h("",!0),e(l)===1?(d(),v("div",ie,[r(V,{size:"large",type:"primary",onClick:t[4]||(t[4]=n=>q(e(x)))},{default:m(()=>[w(f(s.$t("action.submit")),1)]),_:1})])):h("",!0),ne,u("div",me,[u("div",ce,[r(i,{type:"primary",onClick:t[5]||(t[5]=n=>S())},{default:m(()=>[w(f(s.$t("action.back")),1)]),_:1})])]),pe]),_:1},8,["model","rules"])]),_:1})])}}});export{Be as default};
