var m=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)};var l=(t,e,a)=>(m(t,e,"read from private field"),a?a.call(t):e.get(t)),p=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},L=(t,e,a,n)=>(m(t,e,"write to private field"),n?n.call(t,a):e.set(t,a),a);import{u as O,C as E,r as c,E as r,y as $,z as P}from"./entry.9ba5094b.js";var s;class S{constructor(){p(this,s,void 0);L(this,s,new EventTarget)}addListener(e,a){try{l(this,s).addEventListener(e,a)}catch{}}removeListener(e,a){try{l(this,s).removeEventListener(e,a)}catch{}}dispatchEvent(e){l(this,s).dispatchEvent(new Event(e))}}s=new WeakMap;const g=new S,v=c(""),d=c(""),h=c(0),o=c(!1),f=c(!1);function w(t){f.value=t}const b=async()=>{o.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"}),v.value="",d.value="",h.value=0,w(!1),g.dispatchEvent("logout"),r.success("Logged out.")}catch{r.error("Log out failed.")}finally{o.value=!1}};let T=0;const i=async(t=!1)=>{const e=Date.now();if(!t&&e-T<6e4)return f.value;o.value=!0;try{const{isLoggedIn:a,user:n}=await $fetch("/api/auth/check",{method:"POST"});return T=e,v.value=(n==null?void 0:n.email)||"",d.value=(n==null?void 0:n.username)||"",h.value=(n==null?void 0:n.authlvl)||0,o.value=!1,setTimeout(()=>w(a),0),a}catch{o.value=!1}};(async()=>{{try{await i()}catch(t){console.error(t)}finally{}try{Object.defineProperty(window,"authlvl",{get:()=>h.value})}catch{}}})();const C=async t=>{try{const{error:e}=await $fetch("/api/auth/username",{method:"PUT",body:{username:t}});if(e)throw e;return await i(!0),r.success("The username has been changed."),!0}catch(e){return r.error(typeof e=="string"?e:"Oops! Something went wrong."),!1}};function A(){const t=O().t;async function e(a,n){const I=$.service({text:t("auth.loggingIn")});o.value=!0;try{const u=await $fetch("/api/auth/login",{method:"POST",body:{usernameOrEmail:a,password:n}}),{error:y}=u;if(y)throw y;g.dispatchEvent("login"),await P("/"),await i(!0),r.success("Logged in.")}catch(u){r.error(typeof u=="string"?u:"Oops! Something went wrong.")}finally{I.close(),o.value=!1}}return{authEventTarget:g,authIsLoading:o,isLoggedIn:f,email:v,username:d,authlvl:h,login:e,logout:b,checkIsLoggedIn:i,setIsLoggedIn:w,changeUsername:C,goToHome(){E().$router.replace("/")},goToNewChat(){E().$router.replace("/c/")}}}export{A as u};
